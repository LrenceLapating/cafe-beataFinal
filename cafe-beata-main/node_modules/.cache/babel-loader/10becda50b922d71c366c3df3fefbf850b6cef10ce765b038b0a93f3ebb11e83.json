{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport ItemEditor from './ItemEditor.vue';\nexport default {\n  components: {\n    ItemEditor\n  },\n  data() {\n    return {\n      orders: [],\n      // Store pending orders\n      isLoading: true,\n      // For loading state\n      ws: null,\n      // WebSocket connection\n      wsConnected: false,\n      activeDeclineOrderId: null,\n      // Track the order for which decline message is being customized\n      customDeclineMessage: \"\",\n      // Store the custom decline message\n      notificationSent: false,\n      // To track if the notification has been sent\n      searchQuery: \"\",\n      // To hold the search query input\n      isCafeOpen: true,\n      notificationMessage: \"\",\n      notificationClass: \"\",\n      notificationVisible: false,\n      showMenuEditor: false,\n      // Control visibility of menu editor popup\n      isSidebarOpen: false,\n      orderReadyStatus: {},\n      // Track which orders are ready\n      confirmCompleteOrderId: null,\n      // Track which order is being confirmed for completion\n      showStockManager: false,\n      showStockUpdateModal: false,\n      stockItems: [],\n      stockSearchQuery: '',\n      selectedItem: null,\n      stockUpdateAction: 'add',\n      stockUpdateQuantity: 0,\n      stockUpdateReason: '',\n      selectedCategory: '',\n      uniqueCategories: [],\n      // New properties for decline modal\n      showDeclineModal: false,\n      selectedOrder: null,\n      editableItems: [],\n      refreshInterval: null,\n      // To store the interval ID for automatic refresh\n      isUpdating: false,\n      // New property for loading state\n      pingInterval: null,\n      // To store the interval ID for periodic ping\n      passwordForm: {\n        currentPassword: '',\n        newPassword: '',\n        confirmPassword: '',\n        error: '',\n        success: ''\n      },\n      currentPageSize: 10,\n      hasMoreOrders: false\n    };\n  },\n  computed: {\n    // Filter orders based on search query\n    filteredOrders() {\n      if (!this.searchQuery) {\n        return this.orders;\n      }\n      return this.orders.filter(order => {\n        const lowerCaseSearchQuery = this.searchQuery.toLowerCase();\n        return order.id.toString().includes(lowerCaseSearchQuery) ||\n        // Search by Order ID\n        order.customer_name.toLowerCase().includes(lowerCaseSearchQuery) // Search by Customer Name\n        ;\n      });\n    },\n    filteredStockItems() {\n      return this.stockItems.filter(item => {\n        if (!item || !item.name) return false;\n        const matchesSearch = item.name.toLowerCase().includes((this.stockSearchQuery || '').toLowerCase());\n        const matchesCategory = !this.selectedCategory || item.category === this.selectedCategory;\n        return matchesSearch && matchesCategory;\n      });\n    }\n  },\n  methods: {\n    toggleCafeStatus() {\n      this.isCafeOpen = !this.isCafeOpen; // Toggle the cafe status\n      localStorage.setItem('isCafeOpen', this.isCafeOpen); // Store cafe status\n\n      // Set the notification message and class based on the cafe status\n      if (this.isCafeOpen) {\n        this.notificationMessage = \"Cafe Be√†ta is now Open!\";\n        this.notificationClass = \"open-notification\"; // Set class for green when open\n      } else {\n        this.notificationMessage = \"Cafe Be√†ta is now Closed!\";\n        this.notificationClass = \"closed-notification\"; // Set class for red when closed\n      }\n      this.showNotification(); // Show the notification\n    },\n    showNotification() {\n      // Show the notification and reset visibility after a timeout\n      this.notificationVisible = true;\n      setTimeout(() => {\n        this.notificationVisible = false;\n      }, 3000); // Hide after 3 seconds\n    },\n    timeAgo(timestamp) {\n      // If timestamp is a string, ensure it's in ISO format by replacing space with \"T\"\n      if (typeof timestamp === \"string\") {\n        timestamp = timestamp.replace(\" \", \"T\"); // Convert to ISO format: \"YYYY-MM-DD HH:MM:SS\" -> \"YYYY-MM-DDTHH:MM:SS\"\n      }\n      const now = new Date();\n      const orderTime = new Date(timestamp); // Parse the timestamp\n\n      // Check if the timestamp is valid\n      if (isNaN(orderTime)) {\n        return \"Invalid time\"; // Return fallback message if timestamp is invalid\n      }\n      const differenceInSeconds = Math.floor((now - orderTime) / 1000);\n      if (differenceInSeconds < 60) {\n        return 'Just now';\n      } else if (differenceInSeconds < 3600) {\n        const minutes = Math.floor(differenceInSeconds / 60);\n        return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;\n      } else if (differenceInSeconds < 86400) {\n        const hours = Math.floor(differenceInSeconds / 3600);\n        return `${hours} hour${hours > 1 ? 's' : ''} ago`;\n      } else if (differenceInSeconds < 2592000) {\n        const days = Math.floor(differenceInSeconds / 86400);\n        return `${days} day${days > 1 ? 's' : ''} ago`;\n      } else if (differenceInSeconds < 31536000) {\n        const months = Math.floor(differenceInSeconds / 2592000);\n        return `${months} month${months > 1 ? 's' : ''} ago`;\n      } else {\n        const years = Math.floor(differenceInSeconds / 31536000);\n        return `${years} year${years > 1 ? 's' : ''} ago`;\n      }\n    },\n    // Method to format the order date in the required format\n    formatDate(dateString) {\n      const date = new Date(dateString);\n      const month = (date.getMonth() + 1).toString().padStart(2, '0');\n      const day = date.getDate().toString().padStart(2, '0');\n      const year = date.getFullYear();\n      const hours = date.getHours();\n      const minutes = date.getMinutes().toString().padStart(2, '0');\n      const period = hours >= 12 ? 'PM' : 'AM';\n      const hour12 = (hours % 12 || 12).toString().padStart(2, '0');\n\n      // Format: MM-DD-YYYY with highlighted time\n      const formattedDate = `${month}-${day}-${year} <span class=\"highlighted-time\">${hour12}:${minutes} ${period}</span>`;\n      return formattedDate;\n    },\n    cancelDecline() {\n      this.activeDeclineOrderId = null; // Hide decline input\n      this.customDeclineMessage = \"\"; // Clear text\n    },\n    // Navigate to the Order Record page\n    goToOrderRecord() {\n      this.$router.push({\n        name: \"OrderRecord\"\n      }); // Ensure this matches the name of the route\n    },\n    logout() {\n      this.$router.push({\n        name: \"Login\"\n      }); // Redirect the user to the Login page (adjust the route as needed)\n    },\n    // Fetch orders only once at initial load\n    async fetchOrders() {\n      if (this.isLoading) return;\n      this.isLoading = true;\n      try {\n        const response = await fetch(\"http://127.0.0.1:8000/orders\");\n        const data = await response.json();\n        if (data.orders && Array.isArray(data.orders)) {\n          // Filter pending orders and sort them by ID in ascending order\n          const pendingOrders = data.orders.filter(order => order.status === \"pending\").sort((a, b) => {\n            // Convert order IDs to numbers for proper numerical sorting\n            const idA = parseInt(a.id);\n            const idB = parseInt(b.id);\n            return idA - idB; // Sort in ascending order (lower IDs first)\n          });\n          console.log(`Fetched ${pendingOrders.length} pending orders`);\n\n          // Important: Create a new array reference to ensure Vue reactivity\n          this.orders = [...pendingOrders];\n\n          // Check if any of the fetched orders have ready notifications\n          // This ensures the \"Mark as Completed\" button is enabled for orders that are ready\n          this.orders.forEach(order => {\n            // If the order is already marked as ready in localStorage, keep that status\n            if (this.orderReadyStatus[order.id]) {\n              return;\n            }\n\n            // Check if there's a notification for this order\n            const userNotificationsKey = `user_notifications_${order.customer_name}`;\n            const notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n            const hasReadyNotification = notifications.some(n => n.orderId === order.id);\n            if (hasReadyNotification) {\n              this.orderReadyStatus[order.id] = true;\n            }\n          });\n\n          // Update localStorage with any changes\n          localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n\n          // Force the UI to update\n          this.$forceUpdate();\n        } else {\n          console.error(\"Invalid data format\", data);\n          this.orders = [];\n        }\n      } catch (error) {\n        console.error(\"Error fetching orders:\", error);\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    // Format ordered items for notification message\n    formatItems(items) {\n      if (!Array.isArray(items)) {\n        console.error(\"Invalid item format:\", items);\n        return \"Invalid item data\";\n      }\n      return items.map(item => `${item.name} x${item.quantity}`).join(\", \");\n    },\n    // Calculate the total price for a single order\n    calculateOrderTotal(items) {\n      if (!Array.isArray(items)) return \"‚Ç±0\";\n      return items.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n    },\n    // Mark an order as completed and send notification\n    markAsCompleted(orderId, customerName, items) {\n      // Log for debugging\n      console.log(`Marking order ${orderId} as completed...`);\n\n      // Ensure items is properly formatted\n      let processedItems = items;\n      if (typeof items === 'string') {\n        try {\n          processedItems = JSON.parse(items);\n        } catch (e) {\n          console.error(\"Failed to parse items:\", e);\n          alert(\"Error processing order items. Please try again.\");\n          return;\n        }\n      }\n      fetch(`http://127.0.0.1:8000/orders/${orderId}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          status: \"completed\"\n        })\n      }).then(response => {\n        // First check if the response is actually received\n        if (!response) {\n          throw new Error('No response received from server');\n        }\n\n        // Then check if it's OK\n        if (!response.ok) {\n          return response.text().then(text => {\n            try {\n              // Try to parse as JSON\n              const data = JSON.parse(text);\n              throw new Error(data.detail || `Server error: ${response.status}`);\n            } catch (e) {\n              // If parsing fails, use the raw text\n              throw new Error(`Server error: ${response.status} - ${text || 'Unknown error'}`);\n            }\n          });\n        }\n        return response.json();\n      }).then(data => {\n        console.log(\"Order completed successfully:\", data);\n\n        // Immediately remove from pending orders\n        this.orders = this.orders.filter(order => order.id !== orderId);\n\n        // Remove from orderReadyStatus\n        delete this.orderReadyStatus[orderId];\n        // Update localStorage\n        localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n\n        // Calculate the total price\n        const total = processedItems.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n\n        // Prepare the notification with highlighted order details\n        const notification = {\n          orderId,\n          customerName,\n          message: `Your order is completed! ‚úîÔ∏è Thank you for choosing Caf√© Beata. Enjoy your food and drinks! ü•∞. <span class=\"highlighted-order-details\">Order details: ${this.formatItems(processedItems)}. Total: ‚Ç±${total}</span>`,\n          timestamp: new Date().toISOString(),\n          items: processedItems,\n          total\n        };\n\n        // Save the notification in localStorage for the specific user\n        const userNotificationsKey = `user_notifications_${customerName}`;\n        let notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n        notifications.push(notification);\n        localStorage.setItem(userNotificationsKey, JSON.stringify(notifications));\n\n        // Send real-time notification via WebSocket if connected\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          this.ws.send(JSON.stringify({\n            type: 'user_notification',\n            action: 'order_completed',\n            notification: notification,\n            target_user: customerName\n          }));\n        }\n\n        // Emit an event to notify other components\n        window.dispatchEvent(new Event(\"notificationUpdated\"));\n        alert(\"Order marked as completed!\");\n      }).catch(error => {\n        console.error(\"Error marking order as completed:\", error);\n        alert(error.message || \"Error completing order. Please try again.\");\n        // Refresh orders to ensure UI is in sync\n        this.fetchOrders();\n      });\n    },\n    // Open the decline modal for a specific order\n    openDeclineDialog(order) {\n      this.activeDeclineOrderId = order.id;\n      this.selectedOrder = order;\n      this.customDeclineMessage = localStorage.getItem(`customDeclineMessage_${order.id}`) || \"We need to adjust your order due to availability issues.\";\n\n      // Clone the items array to make it editable\n      this.editableItems = JSON.parse(JSON.stringify(order.items));\n\n      // Show the modal\n      this.showDeclineModal = true;\n    },\n    // Close the decline modal\n    closeDeclineModal() {\n      this.showDeclineModal = false;\n      this.activeDeclineOrderId = null;\n      this.selectedOrder = null;\n    },\n    // Increment item quantity\n    incrementQuantity(index) {\n      this.editableItems[index].quantity++;\n    },\n    // Decrement item quantity\n    decrementQuantity(index) {\n      if (this.editableItems[index].quantity > 0) {\n        this.editableItems[index].quantity--;\n      }\n    },\n    // Calculate the total of adjusted items\n    calculateAdjustedTotal() {\n      return this.editableItems.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n    },\n    // Send order adjustment for customer approval\n    sendForApproval() {\n      if (!this.selectedOrder) return;\n      const orderId = this.selectedOrder.id;\n      const customerName = this.selectedOrder.customer_name;\n\n      // Calculate the total price\n      const total = this.calculateAdjustedTotal();\n\n      // Format items for display\n      const formattedItems = this.formatItems(this.editableItems);\n\n      // Build a more specific message about quantity adjustments\n      let adjustmentReasons = [];\n      this.editableItems.forEach(item => {\n        const originalItem = this.selectedOrder.items.find(i => i.name === item.name);\n        if (originalItem && originalItem.quantity !== item.quantity) {\n          adjustmentReasons.push(`${item.name} adjusted from ${originalItem.quantity} to ${item.quantity} due to limited availability`);\n        }\n      });\n\n      // Create the customized message with specific quantity adjustment reasons\n      const specificAdjustments = adjustmentReasons.length > 0 ? `The following adjustments were made: ${adjustmentReasons.join('; ')}. ` : '';\n\n      // Prepare notification message with approval buttons\n      const message = `${this.customDeclineMessage} ${specificAdjustments}Please review the adjusted order: ${formattedItems}. Total: ‚Ç±${total}`;\n\n      // Create adjustment notification with approval options\n      const notification = {\n        orderId,\n        customerName,\n        message,\n        timestamp: new Date().toISOString(),\n        items: this.editableItems,\n        total,\n        requiresApproval: true,\n        // Flag to indicate this needs user approval\n        originalItems: this.selectedOrder.items // Store original items for reference\n      };\n\n      // Set loading state\n      this.isUpdating = true;\n\n      // First update the order in the database with the adjusted quantities\n      fetch(`http://127.0.0.1:8000/orders/${orderId}/update-items`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          items: this.editableItems,\n          status: \"pending\",\n          // Keep status as pending\n          isPendingApproval: true // Add flag for pending approval\n        })\n      }).then(response => {\n        if (!response.ok) {\n          return response.text().then(text => {\n            console.error(`Error status: ${response.status}, details: ${text}`);\n            throw new Error(`Failed to update order (${response.status}): ${text}`);\n          });\n        }\n        return response.json();\n      }).then(data => {\n        console.log(\"Order items updated in database successfully\", data);\n\n        // Now save to user's notifications\n        const userNotificationsKey = `user_notifications_${customerName}`;\n        let notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n        notifications.push(notification);\n        localStorage.setItem(userNotificationsKey, JSON.stringify(notifications));\n\n        // Send WebSocket notification if connected\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          this.ws.send(JSON.stringify({\n            type: 'user_notification',\n            action: 'order_adjustment',\n            // Set specific action type for adjustment requests\n            notification: notification,\n            target_user: customerName\n          }));\n        }\n\n        // Update the order in the UI immediately to show adjusted quantities\n        const orderIndex = this.orders.findIndex(o => o.id === orderId);\n        if (orderIndex !== -1) {\n          // Create a copy with adjusted items\n          const updatedOrder = {\n            ...this.orders[orderIndex],\n            items: this.editableItems,\n            isPendingApproval: true // Add flag for styling\n          };\n\n          // Update the order in the list - using Vue 3 array mutation\n          this.orders = [...this.orders.slice(0, orderIndex), updatedOrder, ...this.orders.slice(orderIndex + 1)];\n        }\n\n        // Show confirmation\n        this.notificationMessage = \"Adjustment request sent to customer for approval!\";\n        this.notificationClass = \"success-notification\";\n        this.showNotification();\n\n        // Close the modal and reset loading state\n        this.isUpdating = false;\n        this.closeDeclineModal();\n      }).catch(error => {\n        console.error(\"Error updating order items:\", error);\n\n        // Reset loading state but keep modal open for retry\n        this.isUpdating = false;\n\n        // Show error notification\n        this.notificationMessage = `Error: ${error.message}`;\n        this.notificationClass = \"error-notification\";\n        this.showNotification();\n\n        // Ask user if they want to retry via modal or notification\n        if (confirm(`Failed to update order: ${error.message}. Do you want to retry?`)) {\n          // Retry the update\n          this.sendForApproval();\n        }\n      });\n    },\n    // Decline the order directly\n    confirmDecline() {\n      if (!this.selectedOrder) return;\n\n      // Show loading indicator\n      this.isUpdating = true;\n      const orderId = this.selectedOrder.id;\n      const customerName = this.selectedOrder.customer_name;\n      const items = this.selectedOrder.items;\n      const message = this.customDeclineMessage || \"Unfortunately, this item is temporarily out of stock. We apologize for the inconvenience and appreciate your patience. üôè\";\n      fetch(`http://127.0.0.1:8000/orders/${orderId}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          status: \"declined\"\n        })\n      }).then(response => {\n        if (!response.ok) {\n          throw new Error(`HTTP error! Status: ${response.status}`);\n        }\n        return response.json();\n      }).then(() => {\n        // Remove from pending orders immediately\n        this.orders = this.orders.filter(order => order.id !== orderId);\n\n        // Remove from orderReadyStatus if it exists\n        if (this.orderReadyStatus[orderId]) {\n          delete this.orderReadyStatus[orderId];\n          localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n        }\n\n        // Calculate total\n        const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n\n        // Prepare notification\n        const notification = {\n          orderId,\n          customerName,\n          message: `${message} Order details: ${this.formatItems(items)}. Total: ‚Ç±${total}`,\n          timestamp: new Date().toISOString(),\n          items,\n          total\n        };\n\n        // Save notification to localStorage\n        const userNotificationsKey = `user_notifications_${customerName}`;\n        let notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n        notifications.push(notification);\n        localStorage.setItem(userNotificationsKey, JSON.stringify(notifications));\n\n        // Send direct WebSocket notification for real-time updates\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          console.log('Sending WebSocket notification for declined order:', orderId);\n\n          // First send the standard notification\n          this.ws.send(JSON.stringify({\n            type: 'user_notification',\n            action: 'order_declined',\n            notification: notification,\n            target_user: customerName\n          }));\n\n          // Then send a special order_declined type message for real-time notification\n          this.ws.send(JSON.stringify({\n            type: 'order_declined',\n            order_id: orderId,\n            customer_name: customerName,\n            reason: message,\n            timestamp: new Date().toISOString()\n          }));\n        }\n\n        // Reset loading state\n        this.isUpdating = false;\n\n        // Close the modal\n        this.closeDeclineModal();\n\n        // Show success message\n        this.notificationMessage = `Order #${orderId} has been declined`;\n        this.notificationClass = \"closed-notification\";\n        this.showNotification();\n      }).catch(error => {\n        console.error(\"Error declining order:\", error);\n        this.isUpdating = false;\n        alert(\"Error declining order. Please try again.\");\n      });\n    },\n    // Original decline order function - unchanged\n    declineOrder(orderId, customerName, items) {\n      const message = this.customDeclineMessage || \"Unfortunately, this item is temporarily out of stock. We apologize for the inconvenience and appreciate your patience. üôè\";\n      fetch(`http://127.0.0.1:8000/orders/${orderId}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          status: \"declined\"\n        }) // Properly formatted JSON\n      }).then(response => {\n        if (!response.ok) {\n          throw new Error(`HTTP error! Status: ${response.status}`);\n        }\n        return response.json();\n      }).then(() => {\n        // Immediately remove from pending orders\n        this.orders = this.orders.filter(order => order.id !== orderId);\n\n        // Remove from orderReadyStatus if it exists\n        if (this.orderReadyStatus[orderId]) {\n          delete this.orderReadyStatus[orderId];\n          // Update localStorage\n          localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n        }\n\n        // Calculate the total price\n        const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n\n        // Prepare the notification with the custom message and order details\n        const notification = {\n          orderId,\n          customerName,\n          message: `${message} Order details: ${this.formatItems(items)}. Total: ‚Ç±${total}`,\n          timestamp: new Date().toISOString(),\n          items,\n          // Include items in the notification\n          total // Include total in the notification\n        };\n\n        // Save the notification in localStorage for the specific user\n        const userNotificationsKey = `user_notifications_${customerName}`;\n        let notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n        notifications.push(notification);\n        localStorage.setItem(userNotificationsKey, JSON.stringify(notifications));\n\n        // Send direct WebSocket notification for real-time updates\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          console.log('Sending WebSocket notification for declined order:', orderId);\n\n          // First send the standard notification\n          this.ws.send(JSON.stringify({\n            type: 'user_notification',\n            action: 'order_declined',\n            notification: notification,\n            target_user: customerName\n          }));\n\n          // Then send a special order_declined type message for real-time notification\n          this.ws.send(JSON.stringify({\n            type: 'order_declined',\n            order_id: orderId,\n            customer_name: customerName,\n            reason: message,\n            timestamp: new Date().toISOString()\n          }));\n        }\n\n        // Emit an event to notify other components (optional)\n        window.dispatchEvent(new Event(\"orderDeclined\"));\n\n        // Show success message\n        this.notificationMessage = `Order #${orderId} has been declined`;\n        this.notificationClass = \"closed-notification\";\n        this.showNotification();\n      }).catch(error => {\n        console.error(\"Error declining order:\", error);\n        this.isUpdating = false;\n        alert(\"Error declining order. Please try again.\");\n      });\n    },\n    // Save the decline message to localStorage whenever it's updated\n    updateDeclineMessage() {\n      if (this.activeDeclineOrderId !== null) {\n        localStorage.setItem(`customDeclineMessage_${this.activeDeclineOrderId}`, this.customDeclineMessage);\n      }\n    },\n    // New method to handle the \"Order Ready\" button click and show pop-up notification\n    sendOrderReadyNotification(orderId, customerName, items) {\n      const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n      const notification = {\n        orderId,\n        customerName,\n        message: `Your order is now ready! Proceed to the cashier for payment and pickup. ‚ò∫Ô∏è Order details: ${this.formatItems(items)}. Total: ‚Ç±${total}`,\n        timestamp: new Date().toISOString(),\n        items,\n        total\n      };\n\n      // Save the notification in localStorage for the specific user\n      const userNotificationsKey = `user_notifications_${customerName}`;\n      let notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n\n      // Add the notification without replacing existing ones\n      notifications.push(notification);\n\n      // Sort notifications by timestamp (newest first)\n      notifications.sort((a, b) => {\n        const dateA = new Date(a.timestamp);\n        const dateB = new Date(b.timestamp);\n        return dateB - dateA;\n      });\n      localStorage.setItem(userNotificationsKey, JSON.stringify(notifications));\n\n      // Set order as ready using direct assignment\n      this.orderReadyStatus[orderId] = true;\n      // Force reactivity update\n      this.orderReadyStatus = {\n        ...this.orderReadyStatus\n      };\n\n      // Save orderReadyStatus to localStorage\n      localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n\n      // Send real-time notification via WebSocket if connected\n      if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n        this.ws.send(JSON.stringify({\n          type: 'user_notification',\n          action: 'order_ready',\n          notification: notification,\n          target_user: customerName\n        }));\n      }\n\n      // Show success notification to admin\n      this.notificationSent = true;\n      setTimeout(() => {\n        this.notificationSent = false;\n      }, 3000);\n    },\n    // Toggle menu editor popup visibility\n    toggleMenuEditor() {\n      this.showMenuEditor = !this.showMenuEditor;\n    },\n    // Toggle sidebar visibility\n    toggleSidebar() {\n      this.isSidebarOpen = !this.isSidebarOpen;\n      // When opening the sidebar, prevent scrolling on the body\n      if (this.isSidebarOpen) {\n        document.body.style.overflow = 'hidden';\n      } else {\n        document.body.style.overflow = '';\n      }\n    },\n    // Close sidebar - only called when X button is clicked\n    closeSidebar() {\n      this.isSidebarOpen = false;\n      document.body.style.overflow = '';\n    },\n    // Handle clicks outside sidebar - removed to prevent auto-closing when clicking outside\n    handleOutsideClick() {\n      // Do nothing - sidebar should stay open\n    },\n    // Add new methods for completion confirmation\n    showCompletionConfirmation(orderId) {\n      this.confirmCompleteOrderId = orderId;\n    },\n    confirmCompletion() {\n      const order = this.orders.find(o => o.id === this.confirmCompleteOrderId);\n      if (order) {\n        this.markAsCompleted(order.id, order.customer_name, order.items);\n      }\n      this.confirmCompleteOrderId = null;\n    },\n    cancelCompletion() {\n      this.confirmCompleteOrderId = null;\n    },\n    toggleStockManager() {\n      this.showStockManager = !this.showStockManager;\n    },\n    toggleSettings() {\n      this.showSettings = !this.showSettings;\n      // Reset form when opening/closing\n      if (this.showSettings) {\n        this.passwordForm = {\n          currentPassword: '',\n          newPassword: '',\n          confirmPassword: '',\n          error: '',\n          success: ''\n        };\n      }\n    },\n    changeAdminPassword() {\n      // Reset previous messages\n      this.passwordForm.error = '';\n      this.passwordForm.success = '';\n\n      // Check if current password is correct\n      const storedPassword = \"admin123\"; // The default password\n\n      if (this.passwordForm.currentPassword !== storedPassword) {\n        this.passwordForm.error = \"Current password is incorrect\";\n        return;\n      }\n\n      // Validate new password\n      if (this.passwordForm.newPassword.length < 6) {\n        this.passwordForm.error = \"New password must be at least 6 characters\";\n        return;\n      }\n\n      // Check if passwords match\n      if (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {\n        this.passwordForm.error = \"New passwords do not match\";\n        return;\n      }\n\n      // Update the password in localStorage (in a real app, you would call an API)\n      localStorage.setItem(\"adminPassword\", this.passwordForm.newPassword);\n\n      // Show success message\n      this.passwordForm.success = \"Password changed successfully!\";\n\n      // Reset form after successful change\n      setTimeout(() => {\n        this.passwordForm.currentPassword = '';\n        this.passwordForm.newPassword = '';\n        this.passwordForm.confirmPassword = '';\n      }, 1000);\n    },\n    async fetchStockItems() {\n      try {\n        const response = await fetch('http://localhost:8000/api/stocks');\n        const data = await response.json();\n        console.log('Fetched stock data:', data); // Debug log\n\n        if (data.success && Array.isArray(data.items)) {\n          // Map the items to include name and category from item_name\n          this.stockItems = data.items.map(item => ({\n            id: item.item_id,\n            // Use item_id from the API response\n            name: item.item_name,\n            category: item.category,\n            quantity: item.quantity,\n            min_stock_level: item.min_stock_level\n          }));\n\n          // Update unique categories\n          this.uniqueCategories = [...new Set(this.stockItems.map(item => item.category))];\n          console.log('Processed stock items:', this.stockItems); // Debug log\n        } else {\n          console.error('Invalid data format received:', data);\n        }\n      } catch (error) {\n        console.error('Error fetching stock items:', error);\n      }\n    },\n    getStockStatus(item) {\n      if (item.quantity === 0) return 'Disabled (Out of Stock)';\n      if (item.quantity >= 999999) return 'Enabled (Unlimited)';\n      if (item.quantity <= item.min_stock_level) return 'Low Stock';\n      return 'In Stock';\n    },\n    getStockStatusClass(item) {\n      if (item.quantity === 0) return 'status-disabled';\n      if (item.quantity >= 999999) return 'status-enabled';\n      if (item.quantity <= item.min_stock_level) return 'status-low';\n      return 'status-ok';\n    },\n    openStockUpdateModal(item) {\n      console.log('Opening modal for item:', item); // Debug log\n      this.selectedItem = item;\n      this.showStockUpdateModal = true;\n      this.stockUpdateQuantity = 0;\n      this.stockUpdateAction = 'add';\n      this.stockUpdateReason = '';\n    },\n    closeStockUpdateModal() {\n      this.showStockUpdateModal = false;\n      this.selectedItem = null;\n      this.stockUpdateQuantity = 0;\n      this.stockUpdateReason = '';\n    },\n    async submitStockUpdate() {\n      // Validate required fields\n      if (!this.selectedItem || !this.selectedItem.id) {\n        alert('No item selected');\n        return;\n      }\n      if (!this.stockUpdateAction) {\n        alert('Please select an action');\n        return;\n      }\n      try {\n        let requestBody = {};\n\n        // Handle different action types\n        if (this.stockUpdateAction === 'disabled') {\n          // For disabled, set quantity to 0 and use 'set' action\n          requestBody = {\n            action: 'set',\n            quantity: 0,\n            reason: this.stockUpdateReason || 'Disabled - Out of Stock'\n          };\n        } else if (this.stockUpdateAction === 'enabled') {\n          // For enabled, set a special value to indicate unlimited\n          requestBody = {\n            action: 'set',\n            quantity: 999999,\n            // Very large number to represent unlimited\n            reason: this.stockUpdateReason || 'Enabled - Unlimited Orders'\n          };\n        } else {\n          // For regular actions (add, subtract, set)\n          if (!this.stockUpdateQuantity || this.stockUpdateQuantity <= 0) {\n            alert('Please enter a valid quantity (greater than 0)');\n            return;\n          }\n\n          // Additional validation for subtract action\n          if (this.stockUpdateAction === 'subtract' && this.stockUpdateQuantity > this.selectedItem.quantity) {\n            alert('Cannot remove more than current stock');\n            return;\n          }\n          requestBody = {\n            action: this.stockUpdateAction,\n            quantity: parseInt(this.stockUpdateQuantity),\n            reason: this.stockUpdateReason || 'Stock update'\n          };\n        }\n        console.log('Sending request:', requestBody);\n        const response = await fetch(`http://localhost:8000/api/stocks/${this.selectedItem.id}/update`, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(requestBody)\n        });\n        const data = await response.json();\n        if (!response.ok) {\n          throw new Error(data.detail || 'Failed to update stock');\n        }\n        if (data.success) {\n          alert('Stock updated successfully!');\n          this.closeStockUpdateModal();\n          await this.fetchStockItems(); // Refresh the stock list\n        } else {\n          throw new Error(data.message || 'Failed to update stock');\n        }\n      } catch (error) {\n        console.error('Error updating stock:', error);\n        alert(error.message || 'Failed to update stock. Please try again.');\n      }\n    },\n    initWebSocket() {\n      // Use the same host as the API\n      const wsUrl = `ws://${window.location.hostname}:8000/ws/orders`;\n\n      // Close existing connection if it exists\n      if (this.ws) {\n        try {\n          this.ws.close();\n        } catch (e) {\n          console.error(\"Error closing existing WebSocket:\", e);\n        }\n      }\n      console.log('Initializing WebSocket connection...');\n      this.ws = new WebSocket(wsUrl);\n      this.ws.onopen = () => {\n        console.log('WebSocket connected');\n        this.wsConnected = true;\n\n        // Set up a periodic ping to keep the connection alive\n        if (this.pingInterval) clearInterval(this.pingInterval);\n        this.pingInterval = setInterval(() => {\n          if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n            this.ws.send(JSON.stringify({\n              type: 'ping'\n            }));\n          }\n        }, 30000); // ping every 30 seconds\n      };\n      this.ws.onmessage = async event => {\n        try {\n          const data = JSON.parse(event.data);\n          console.log('WebSocket message received:', data);\n          if (data.type === 'new_order') {\n            // Handle new order\n            if (data.order.status === 'pending') {\n              // Add the new order to the orders array\n              this.orders.push(data.order);\n\n              // Re-sort the orders array by ID in ascending order\n              this.orders.sort((a, b) => {\n                const idA = parseInt(a.id);\n                const idB = parseInt(b.id);\n                return idA - idB; // Sort in ascending order (lower IDs first)\n              });\n            }\n          } else if (data.type === 'order_status_update') {\n            // Handle order status update\n            if (data.status !== 'pending') {\n              this.orders = this.orders.filter(order => order.id !== data.order_id);\n\n              // Remove from orderReadyStatus if it exists\n              if (this.orderReadyStatus[data.order_id]) {\n                delete this.orderReadyStatus[data.order_id];\n                // Update localStorage\n                localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n              }\n            }\n          } else if (data.type === 'admin_notification') {\n            // Handle customer responses to order adjustments\n            if (data.action === 'adjustment_response') {\n              // Process the customer's response to an order adjustment\n              const notification = data.notification;\n              const orderId = notification.orderId;\n              if (notification.message.includes('APPROVED')) {\n                // Find the order and update it with adjusted items\n                const orderIndex = this.orders.findIndex(o => o.id === orderId);\n                if (orderIndex !== -1) {\n                  // Update the order with the adjusted items and remove pending approval flag\n                  const updatedOrder = {\n                    ...this.orders[orderIndex],\n                    items: notification.items,\n                    isPendingApproval: false // Remove the pending approval flag\n                  };\n\n                  // Update using Vue 3 reactivity \n                  this.orders = [...this.orders.slice(0, orderIndex), updatedOrder, ...this.orders.slice(orderIndex + 1)];\n\n                  // Show success notification\n                  this.notificationMessage = `Customer has approved order adjustments for Order #${orderId}`;\n                  this.notificationClass = \"open-notification\";\n                  this.showNotification();\n                }\n              } else if (notification.message.includes('DECLINED')) {\n                // Remove the order from the list if customer declined\n                this.orders = this.orders.filter(o => o.id !== orderId);\n\n                // Show declined notification\n                this.notificationMessage = `Customer has declined order adjustments for Order #${orderId}`;\n                this.notificationClass = \"closed-notification\";\n                this.showNotification();\n              }\n\n              // Mark the notification as processed\n              notification.processed = true;\n\n              // Update the notification in localStorage\n              const adminNotificationsKey = 'user_notifications_Admin';\n              let adminNotifications = JSON.parse(localStorage.getItem(adminNotificationsKey)) || [];\n\n              // Find and update the processed notification\n              const notificationIndex = adminNotifications.findIndex(n => n.isAdminNotification && n.orderId === orderId && !n.processed);\n              if (notificationIndex !== -1) {\n                adminNotifications[notificationIndex].processed = true;\n                localStorage.setItem(adminNotificationsKey, JSON.stringify(adminNotifications));\n              }\n            }\n          } else if (data.type === 'customer_approval') {\n            // Direct customer approval handling for real-time updates\n            const {\n              orderId,\n              approved\n            } = data;\n            if (approved) {\n              console.log(`CRITICAL FIX: Customer approved order #${orderId} - handling the single-order case specially`);\n\n              // Check if this is the single-order case (the problematic case)\n              const isSingleOrder = this.orders.length === 1;\n\n              // Always try direct DOM manipulation first\n              try {\n                const orderElement = document.querySelector(`.order-item[data-order-id=\"${orderId}\"]`);\n                if (orderElement) {\n                  console.log(\"Found order element in DOM, applying direct DOM updates\");\n\n                  // Remove the pending approval class and add all styling inline\n                  orderElement.classList.remove('order-pending-approval');\n                  orderElement.style.backgroundColor = \"#ffffff\";\n                  orderElement.style.border = \"2px solid #ddd\";\n                  orderElement.style.boxShadow = \"0 2px 5px rgba(0, 0, 0, 0.1)\";\n\n                  // Hide the PENDING APPROVAL label\n                  const style = document.createElement('style');\n                  style.id = `fix-order-${orderId}`;\n                  style.textContent = `\n                    .order-item[data-order-id=\"${orderId}\"]::before {\n                      display: none !important;\n                    }\n                    .order-item[data-order-id=\"${orderId}\"] h3 {\n                      color: #333 !important;\n                    }\n                    .order-item[data-order-id=\"${orderId}\"] .order-total {\n                      color: #333 !important;\n                    }\n                  `;\n                  document.head.appendChild(style);\n\n                  // Update the status text\n                  const statusParagraphs = orderElement.querySelectorAll('p');\n                  for (const paragraph of statusParagraphs) {\n                    if (paragraph.innerHTML.includes('Status:')) {\n                      paragraph.innerHTML = '<strong>Status:</strong> pending';\n                      break;\n                    }\n                  }\n                }\n\n                // For the single-order case, recreate the entire orders container\n                if (isSingleOrder) {\n                  console.log(\"Single order detected - using special handling\");\n\n                  // 1. Get the order container\n                  const ordersContainer = document.querySelector('.orders-container');\n                  if (!ordersContainer) {\n                    console.error(\"Orders container not found\");\n                    return;\n                  }\n\n                  // 2. Find the order in our data\n                  const order = this.orders.find(o => o.id === orderId);\n                  if (!order) {\n                    console.error(\"Order not found in data\");\n                    return;\n                  }\n\n                  // 3. Create an updated version of the order without pending approval\n                  const updatedOrder = {\n                    ...order,\n                    isPendingApproval: false\n                  };\n\n                  // 4. Replace the entire orders list HTML\n                  const ordersList = ordersContainer.querySelector('.orders-list');\n                  if (!ordersList) {\n                    console.error(\"Orders list not found\");\n                    return;\n                  }\n\n                  // Create a new order item element \n                  const newOrderItemHTML = `\n                    <div class=\"order-item\" data-order-id=\"${updatedOrder.id}\">\n                      <div class=\"order-details\">\n                        <h3>Order ID: ${updatedOrder.id}</h3>\n                        <p><strong>Customer:</strong> ${updatedOrder.customer_name}</p>\n                        <p><strong>Status:</strong> ${updatedOrder.status}</p>\n                        <p><strong>Time Order:</strong> ${this.timeAgo(updatedOrder.created_at)}</p>\n                        \n                        <div class=\"items-section\">\n                          <strong>Items:</strong>\n                          <ul>\n                            ${updatedOrder.items.map(item => `<li>${item.name} - ‚Ç±${item.price} x ${item.quantity}</li>`).join('')}\n                          </ul>\n                        </div>\n                        \n                        <div class=\"order-total\">\n                          <p><strong>Total Amount: ‚Ç±${this.calculateOrderTotal(updatedOrder.items)}</strong></p>\n                        </div>\n                      </div>\n                      \n                      <div class=\"order-actions\">\n                        <button \n                          onclick=\"document.dispatchEvent(new CustomEvent('completion-confirmation', {detail: {orderId: ${updatedOrder.id}}}))\"\n                          class=\"mark-completed-btn small-btn ${!this.orderReadyStatus[updatedOrder.id] ? 'disabled' : ''}\"\n                          ${!this.orderReadyStatus[updatedOrder.id] ? 'disabled' : ''}\n                        >\n                          Mark as Completed\n                        </button>\n                        \n                        <button \n                          onclick=\"document.dispatchEvent(new CustomEvent('order-ready', {detail: {orderId: ${updatedOrder.id}, customerName: '${updatedOrder.customer_name}'}}))\"\n                          class=\"order-ready-btn small-btn\"\n                        >\n                          Order Ready üîî\n                        </button>\n                        \n                        <button \n                          onclick=\"document.dispatchEvent(new CustomEvent('decline-dialog', {detail: {orderId: ${updatedOrder.id}}}))\"\n                          class=\"decline-btn\"\n                        >\n                          Decline\n                        </button>\n                      </div>\n                    </div>\n                  `;\n\n                  // Replace the content\n                  ordersList.innerHTML = newOrderItemHTML;\n\n                  // Setup event listeners for our custom events\n                  if (!this._customListenersAdded) {\n                    document.addEventListener('completion-confirmation', e => {\n                      this.showCompletionConfirmation(e.detail.orderId);\n                    });\n                    document.addEventListener('order-ready', e => {\n                      this.sendOrderReadyNotification(e.detail.orderId, e.detail.customerName, updatedOrder.items);\n                    });\n                    document.addEventListener('decline-dialog', e => {\n                      // Find the order again since we need the full object\n                      const order = this.orders.find(o => o.id === e.detail.orderId);\n                      if (order) {\n                        this.openDeclineDialog(order);\n                      }\n                    });\n                    this._customListenersAdded = true;\n                  }\n\n                  // Also update our Vue data model\n                  this.orders = [updatedOrder];\n                }\n              } catch (error) {\n                console.error(\"Error during direct DOM manipulation:\", error);\n              }\n\n              // Always show notification to admin\n              this.notificationMessage = `The customer has APPROVED the order adjustments. Order ID: ${orderId}`;\n              this.notificationClass = \"open-notification\";\n              this.showNotification();\n\n              // Update the database in the background\n              fetch(`http://127.0.0.1:8000/orders/${orderId}/update-items`, {\n                method: \"PUT\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                  status: \"pending\",\n                  isPendingApproval: false\n                })\n              }).then(response => response.json()).then(data => {\n                console.log(\"Database updated to reflect customer approval:\", data);\n\n                // Always fetch all orders as a fallback\n                setTimeout(() => {\n                  this.fetchPendingOrders();\n                }, 1000);\n              }).catch(err => {\n                console.error(\"Error updating database after customer approval:\", err);\n\n                // Force reload as last resort for error cases\n                if (isSingleOrder) {\n                  setTimeout(() => location.reload(), 1000);\n                }\n              });\n            } else {\n              // If declined, handle in Vue since that part seems to work\n              this.orders = this.orders.filter(o => o.id !== orderId);\n\n              // Show notification about the decline\n              this.notificationMessage = `Customer has declined order adjustments for Order #${orderId}`;\n              this.notificationClass = \"closed-notification\";\n              this.showNotification();\n            }\n          } else if (data.type === 'stock_update') {\n            // Handle stock update\n            const stockItem = this.stockItems.find(item => item.id === data.item_id);\n            if (stockItem) {\n              stockItem.quantity = data.new_quantity;\n              stockItem.min_stock_level = data.min_stock_level;\n\n              // Update unique categories if needed\n              if (!this.uniqueCategories.includes(data.category)) {\n                this.uniqueCategories.push(data.category);\n              }\n            }\n            // Refresh stock items to ensure all data is up to date\n            await this.fetchStockItems();\n          } else if (data.type === 'menu_update') {\n            // Handle menu updates (new items, edited items, or deleted items)\n            await this.fetchStockItems(); // Refresh stock items when menu changes\n          } else if (data.type === 'category_update') {\n            // Handle category updates\n            await this.fetchStockItems(); // Refresh stock items when categories change\n\n            // Update unique categories list\n            if (data.action === 'add' && data.category && data.category.name) {\n              if (!this.uniqueCategories.includes(data.category.name)) {\n                this.uniqueCategories.push(data.category.name);\n              }\n            } else if (data.action === 'update' && data.category) {\n              // Replace old category name with new one\n              const index = this.uniqueCategories.indexOf(data.category.old_name);\n              if (index !== -1) {\n                this.uniqueCategories[index] = data.category.name;\n              } else if (!this.uniqueCategories.includes(data.category.name)) {\n                this.uniqueCategories.push(data.category.name);\n              }\n\n              // Update selected category if it was renamed\n              if (this.selectedCategory === data.category.old_name) {\n                this.selectedCategory = data.category.name;\n              }\n            } else if (data.action === 'delete' && data.category_name) {\n              // Remove deleted category\n              this.uniqueCategories = this.uniqueCategories.filter(cat => cat !== data.category_name);\n\n              // Reset selected category if it was deleted\n              if (this.selectedCategory === data.category_name) {\n                this.selectedCategory = '';\n              }\n            }\n          }\n        } catch (error) {\n          console.error('Error processing WebSocket message:', error);\n        }\n      };\n      this.ws.onclose = () => {\n        console.log('WebSocket disconnected');\n        this.wsConnected = false;\n        // Try to reconnect after 5 seconds\n        setTimeout(() => {\n          this.initWebSocket();\n        }, 5000);\n      };\n      this.ws.onerror = error => {\n        console.error('WebSocket error:', error);\n        this.wsConnected = false;\n      };\n    },\n    // Handle localStorage changes for admin notifications\n    handleStorageEvent(event) {\n      // Check if the storage event is for admin notifications\n      if (event.key === 'user_notifications_Admin') {\n        // Process new admin notifications\n        this.processAdminNotifications();\n      }\n    },\n    // Process admin notifications from localStorage\n    processAdminNotifications() {\n      // Get admin notifications \n      const adminNotificationsKey = 'user_notifications_Admin';\n      const adminNotifications = JSON.parse(localStorage.getItem(adminNotificationsKey)) || [];\n\n      // Check for unprocessed customer response notifications\n      const unprocessedNotifications = adminNotifications.filter(n => n.isAdminNotification && (n.message.includes('APPROVED') || n.message.includes('DECLINED')) && !n.processed);\n\n      // Process each notification\n      unprocessedNotifications.forEach(notification => {\n        const orderId = notification.orderId;\n        if (notification.message.includes('APPROVED')) {\n          // If customer approved adjustments\n          // Find the order and update it\n          const orderIndex = this.orders.findIndex(o => o.id === orderId);\n          if (orderIndex !== -1) {\n            // Update the order with adjusted items\n            this.orders[orderIndex].items = notification.items;\n\n            // Mark the notification as processed\n            notification.processed = true;\n          }\n        } else if (notification.message.includes('DECLINED')) {\n          // If customer declined, remove the order\n          this.orders = this.orders.filter(o => o.id !== orderId);\n\n          // Mark the notification as processed\n          notification.processed = true;\n        }\n      });\n\n      // Update the processed notifications in localStorage\n      localStorage.setItem(adminNotificationsKey, JSON.stringify(adminNotifications));\n\n      // Show notification to admin about the response\n      if (unprocessedNotifications.length > 0) {\n        const lastNotification = unprocessedNotifications[unprocessedNotifications.length - 1];\n        this.notificationMessage = lastNotification.message;\n        this.notificationClass = lastNotification.message.includes('APPROVED') ? 'open-notification' : 'closed-notification';\n        this.showNotification();\n      }\n    },\n    // Fetch pending orders - wrapper for fetchOrders for consistency\n    fetchPendingOrders() {\n      this.fetchOrders();\n    },\n    // Connect to WebSocket - renamed from initWebSocket for consistency\n    connectWebSocket() {\n      this.initWebSocket();\n    },\n    // Add this method to force refresh orders after WebSocket updates\n    forceRefreshOrder(orderId) {\n      console.log(`Forcing refresh for order #${orderId}, current orders count: ${this.orders.length}`);\n\n      // Find the order that needs refreshing\n      const orderIndex = this.orders.findIndex(o => o.id === orderId);\n      if (orderIndex !== -1) {\n        // Fetch the latest order data from the server to ensure it's up to date\n        fetch(`http://127.0.0.1:8000/orders/${orderId}`).then(response => response.json()).then(data => {\n          if (data) {\n            console.log('Fetched fresh order data for real-time update:', data);\n\n            // Create a fresh order object with the latest data\n            const updatedOrder = {\n              ...data,\n              isPendingApproval: data.isPendingApproval || false // Ensure the flag is set correctly\n            };\n\n            // Special handling for single order\n            if (this.orders.length === 1) {\n              this.orders = [updatedOrder];\n            } else {\n              // Replace the order in the array using Vue reactivity\n              this.orders = [...this.orders.slice(0, orderIndex), updatedOrder, ...this.orders.slice(orderIndex + 1)];\n            }\n\n            // Force the component to re-render\n            this.$forceUpdate();\n            console.log('Order updated successfully in UI:', updatedOrder);\n\n            // If order is approved but UI doesn't update, try refreshing all orders\n            if (!updatedOrder.isPendingApproval) {\n              setTimeout(() => {\n                this.fetchPendingOrders();\n              }, 300);\n            }\n          }\n        }).catch(error => {\n          console.error('Error refreshing order:', error);\n          // Fallback to refreshing all orders on error\n          this.fetchPendingOrders();\n        });\n      } else {\n        console.log(`Order #${orderId} not found in current orders, refreshing all orders`);\n        // If the order isn't found in the current array, refresh all orders\n        this.fetchPendingOrders();\n      }\n    },\n    // Add direct DOM manipulation method to fix pending approval status when reactivity fails\n    forceFixPendingUI(orderId) {\n      console.log(`CRITICAL FIX: Using direct DOM manipulation to fix UI for order #${orderId}`);\n      try {\n        // Find the order element\n        const orderElement = document.querySelector(`.order-item[data-order-id=\"${orderId}\"]`);\n        if (!orderElement) {\n          console.log(\"Order element not found for direct fix\");\n          return false;\n        }\n\n        // Remove the critical class that causes the red border\n        orderElement.classList.remove('order-pending-approval');\n\n        // Add a success indicator class\n        orderElement.classList.add('order-approved-success');\n\n        // Find and update status text\n        const statusParagraphs = orderElement.querySelectorAll('p');\n        for (const paragraph of statusParagraphs) {\n          if (paragraph.textContent.includes(\"Status:\")) {\n            paragraph.innerHTML = '<strong>Status:</strong> pending';\n            console.log('Updated status text');\n          }\n        }\n\n        // Remove the \"PENDING APPROVAL\" label\n        // Create a specific style for this order element\n        const styleId = `order-${orderId}-fix`;\n        let styleElement = document.getElementById(styleId);\n        if (!styleElement) {\n          styleElement = document.createElement('style');\n          styleElement.id = styleId;\n          document.head.appendChild(styleElement);\n        }\n        styleElement.textContent = `\n          .order-item[data-order-id=\"${orderId}\"]::before {\n            display: none !important;\n          }\n          .order-item[data-order-id=\"${orderId}\"].order-pending-approval {\n            background-color: #ffffff !important;\n            border: 2px solid #ddd !important;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1) !important;\n          }\n          .order-item[data-order-id=\"${orderId}\"] h3 {\n            color: #333 !important;\n          }\n          .order-item[data-order-id=\"${orderId}\"] .order-total {\n            color: #333 !important;\n          }\n          .order-approved-success {\n            animation: successPulse 1s;\n          }\n          @keyframes successPulse {\n            0% { background-color: #e6ffe6; }\n            50% { background-color: #ccffcc; }\n            100% { background-color: #ffffff; }\n          }\n        `;\n        console.log(\"Direct DOM manipulation complete - critical CSS override applied\");\n        return true;\n      } catch (error) {\n        console.error(\"Error during direct DOM manipulation:\", error);\n        return false;\n      }\n    },\n    // Completely bypass Vue for this critical update\n    handleApprovalBypassVue(orderId) {\n      // Force a direct manipulation of the DOM \n      const fixed = this.forceFixPendingUI(orderId);\n\n      // If direct manipulation succeeded, set a flag to prevent further attempts\n      if (fixed) {\n        // Store fixed orders in localStorage to avoid repeated fixes\n        const fixedOrders = JSON.parse(localStorage.getItem('fixedApprovedOrders') || '[]');\n        if (!fixedOrders.includes(orderId)) {\n          fixedOrders.push(orderId);\n          localStorage.setItem('fixedApprovedOrders', JSON.stringify(fixedOrders));\n        }\n\n        // Show feedback to admin\n        this.notificationMessage = `The customer has APPROVED the order adjustments. Order ID: ${orderId}`;\n        this.notificationClass = \"open-notification\";\n        this.showNotification();\n      }\n\n      // Force refresh orders after a short delay\n      setTimeout(() => {\n        this.fetchPendingOrders();\n      }, 1000);\n    }\n  },\n  mounted() {\n    this.fetchPendingOrders();\n    // Set up automatic refresh every 60 seconds\n    this.refreshInterval = setInterval(() => {\n      this.fetchPendingOrders();\n    }, 60000);\n\n    // Check localStorage for cafe status\n    const storedCafeStatus = localStorage.getItem('isCafeOpen');\n    if (storedCafeStatus !== null) {\n      this.isCafeOpen = storedCafeStatus === 'true';\n    }\n\n    // Load orderReadyStatus from localStorage if available\n    const savedOrderReadyStatus = localStorage.getItem('orderReadyStatus');\n    if (savedOrderReadyStatus) {\n      this.orderReadyStatus = JSON.parse(savedOrderReadyStatus);\n    }\n\n    // Event listener for customer approval/decline responses\n    window.addEventListener('storage', this.handleStorageEvent);\n\n    // Connect to WebSocket\n    this.connectWebSocket();\n\n    // Add a global document event listener for a custom event we'll dispatch on customer approval\n    document.addEventListener('customer-approval', event => {\n      if (event.detail && event.detail.orderId) {\n        console.log('Got customer-approval event at document level:', event.detail);\n        this.handleApprovalBypassVue(event.detail.orderId);\n      }\n    });\n\n    // Dispatch a custom approval event if we have any approvals stored in localStorage\n    // This helps sync UI state on page load\n    const fixedOrders = JSON.parse(localStorage.getItem('fixedApprovedOrders') || '[]');\n    fixedOrders.forEach(orderId => {\n      setTimeout(() => {\n        const orderElement = document.querySelector(`.order-item[data-order-id=\"${orderId}\"].order-pending-approval`);\n        if (orderElement) {\n          console.log(`Found previously fixed order #${orderId} still showing pending, re-fixing`);\n          this.forceFixPendingUI(orderId);\n        }\n      }, 1000);\n    });\n  },\n  beforeUnmount() {\n    if (this.refreshInterval) {\n      clearInterval(this.refreshInterval);\n    }\n    if (this.pingInterval) {\n      clearInterval(this.pingInterval);\n    }\n    if (this.ws) {\n      this.ws.close();\n    }\n\n    // Remove event listeners\n    window.removeEventListener('storage', this.handleStorageEvent);\n    document.removeEventListener('customer-approval', this.handleApprovalBypassVue);\n  }\n};","map":{"version":3,"names":["ItemEditor","components","data","orders","isLoading","ws","wsConnected","activeDeclineOrderId","customDeclineMessage","notificationSent","searchQuery","isCafeOpen","notificationMessage","notificationClass","notificationVisible","showMenuEditor","isSidebarOpen","orderReadyStatus","confirmCompleteOrderId","showStockManager","showStockUpdateModal","stockItems","stockSearchQuery","selectedItem","stockUpdateAction","stockUpdateQuantity","stockUpdateReason","selectedCategory","uniqueCategories","showDeclineModal","selectedOrder","editableItems","refreshInterval","isUpdating","pingInterval","passwordForm","currentPassword","newPassword","confirmPassword","error","success","currentPageSize","hasMoreOrders","computed","filteredOrders","filter","order","lowerCaseSearchQuery","toLowerCase","id","toString","includes","customer_name","filteredStockItems","item","name","matchesSearch","matchesCategory","category","methods","toggleCafeStatus","localStorage","setItem","showNotification","setTimeout","timeAgo","timestamp","replace","now","Date","orderTime","isNaN","differenceInSeconds","Math","floor","minutes","hours","days","months","years","formatDate","dateString","date","month","getMonth","padStart","day","getDate","year","getFullYear","getHours","getMinutes","period","hour12","formattedDate","cancelDecline","goToOrderRecord","$router","push","logout","fetchOrders","response","fetch","json","Array","isArray","pendingOrders","status","sort","a","b","idA","parseInt","idB","console","log","length","forEach","userNotificationsKey","notifications","JSON","parse","getItem","hasReadyNotification","some","n","orderId","stringify","$forceUpdate","formatItems","items","map","quantity","join","calculateOrderTotal","reduce","sum","price","toFixed","markAsCompleted","customerName","processedItems","e","alert","method","headers","body","then","Error","ok","text","detail","total","notification","message","toISOString","readyState","WebSocket","OPEN","send","type","action","target_user","window","dispatchEvent","Event","catch","openDeclineDialog","closeDeclineModal","incrementQuantity","index","decrementQuantity","calculateAdjustedTotal","sendForApproval","formattedItems","adjustmentReasons","originalItem","find","i","specificAdjustments","requiresApproval","originalItems","isPendingApproval","orderIndex","findIndex","o","updatedOrder","slice","confirm","confirmDecline","order_id","reason","declineOrder","updateDeclineMessage","sendOrderReadyNotification","dateA","dateB","toggleMenuEditor","toggleSidebar","document","style","overflow","closeSidebar","handleOutsideClick","showCompletionConfirmation","confirmCompletion","cancelCompletion","toggleStockManager","toggleSettings","showSettings","changeAdminPassword","storedPassword","fetchStockItems","item_id","item_name","min_stock_level","Set","getStockStatus","getStockStatusClass","openStockUpdateModal","closeStockUpdateModal","submitStockUpdate","requestBody","initWebSocket","wsUrl","location","hostname","close","onopen","clearInterval","setInterval","onmessage","event","processed","adminNotificationsKey","adminNotifications","notificationIndex","isAdminNotification","approved","isSingleOrder","orderElement","querySelector","classList","remove","backgroundColor","border","boxShadow","createElement","textContent","head","appendChild","statusParagraphs","querySelectorAll","paragraph","innerHTML","ordersContainer","ordersList","newOrderItemHTML","created_at","_customListenersAdded","addEventListener","fetchPendingOrders","err","reload","stockItem","new_quantity","indexOf","old_name","category_name","cat","onclose","onerror","handleStorageEvent","key","processAdminNotifications","unprocessedNotifications","lastNotification","connectWebSocket","forceRefreshOrder","forceFixPendingUI","add","styleId","styleElement","getElementById","handleApprovalBypassVue","fixed","fixedOrders","mounted","storedCafeStatus","savedOrderReadyStatus","beforeUnmount","removeEventListener"],"sources":["D:\\cafe-beata-Inventory-Preorder-main\\cafe-beata-main\\src\\admin\\NotificationsPage.vue"],"sourcesContent":["<template>\n  <div class=\"notifications-page\">\n    <!-- Sidebar Toggle Button (For Mobile) -->\n    <button class=\"menu-button\" @click=\"toggleSidebar\">\n      <div class=\"menu-icon-container\">\n        <i class=\"fa fa-bars\"></i>\n      </div>\n    </button>\n\n    <div v-if=\"isSidebarOpen\" class=\"overlay\"></div>\n    \n    <!-- Sidebar -->\n    <div :class=\"['sidebar', { 'open': isSidebarOpen }]\" @click.stop>\n      <button class=\"close-sidebar\" @click=\"toggleSidebar\">\n        <i class=\"fa fa-times\"></i>\n      </button>\n      \n      <!-- Admin Profile Section -->\n      <div class=\"user-profile-section\">\n        <h3><i class=\"fa fa-user-circle\"></i> Admin Dashboard</h3>\n      </div>\n\n      <hr class=\"utility-divider\">\n\n      <!-- Utility Buttons -->\n      <div class=\"utility-section\">\n        <button @click=\"goToOrderRecord\" class=\"utility-button\">\n          <i class=\"fa fa-history\"></i>\n          <span>View Order Record</span>\n        </button>\n\n        <button @click=\"toggleMenuEditor\" class=\"utility-button\">\n          <i class=\"fa fa-utensils\"></i>\n          <span>Menu Editor</span>\n        </button>\n\n        <button @click=\"toggleStockManager\" class=\"utility-button\">\n          <i class=\"fa fa-boxes\"></i>\n          <span>Stock Management</span>\n        </button>\n\n        <button @click=\"toggleSettings\" class=\"utility-button\">\n          <i class=\"fa fa-cog\"></i>\n          <span>Settings</span>\n        </button>\n\n        <button @click=\"logout\" class=\"utility-button logout\">\n          <i class=\"fa fa-sign-out\"></i>\n          <span>Logout</span>\n        </button>\n      </div>\n\n      <!-- Cafe Status Section -->\n      <div class=\"cafe-status-section\">\n        <button @click=\"toggleCafeStatus\" :class=\"{'open-btn': isCafeOpen, 'closed-btn': !isCafeOpen}\" class=\"cafe-toggle-btn\">\n          <i :class=\"isCafeOpen ? 'fa fa-check-circle' : 'fa fa-times-circle'\"></i>\n          {{ isCafeOpen ? 'Set Cafe Closed' : 'Set Cafe Open' }}\n        </button>\n      </div>\n    </div>\n\n    <!-- Main Content -->\n    <div :class=\"['content', { 'shifted': isSidebarOpen }]\">\n      <!-- Add the top bar with pink gradient at the very top -->\n      <div class=\"top-bar\">\n        <div class=\"centered-content\">\n          <!-- Add sidebar button to the top bar -->\n          <button class=\"menu-button-header\" @click=\"toggleSidebar\">\n            <div class=\"menu-icon-container\">\n              <i class=\"fa fa-bars\"></i>\n            </div>\n          </button>\n          <div class=\"logo-container\">\n            <div class=\"cafe-title\">Cafe Preorder Admin Dashboard</div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"content-below-top-bar\">\n        <div v-if=\"notificationVisible\" :class=\"['notification-popup', notificationClass]\">\n          <p>{{ notificationMessage }}</p>\n        </div>\n\n        <!-- Search Bar -->\n        <div class=\"search-bar\">\n          <input \n            type=\"text\" \n            v-model=\"searchQuery\" \n            placeholder=\"Search orders by ID, customer name...\" \n            class=\"search-input\"\n          />\n        </div>\n\n        <div v-if=\"isLoading\" class=\"loading\">Loading...</div>\n\n        <div v-if=\"filteredOrders.length && !isLoading\" class=\"orders-container\">\n          <h2>Pending Orders</h2>\n          <div class=\"orders-list\">\n            <div class=\"order-item\" \n              v-for=\"order in filteredOrders\" \n              :key=\"order.id\" \n              :data-order-id=\"order.id\"\n              :class=\"{\n                'order-declined-state': activeDeclineOrderId === order.id,\n                'order-pending-approval': order.isPendingApproval\n              }\">\n              <div class=\"order-details\">\n                <h3>Order ID: {{ order.id }}</h3>\n                <p><strong>Customer:</strong> {{ order.customer_name }}</p>\n                <p><strong>Status:</strong> {{ order.status }}{{ order.isPendingApproval ? ' (Pending Approval)' : '' }}</p>\n                <p><strong>Time Order: </strong> {{ timeAgo(order.created_at) }}</p> <!-- Time Ago Display -->\n\n                <div class=\"items-section\">\n                  <strong>Items:</strong>\n                  <ul>\n                    <li v-for=\"item in order.items\" :key=\"item.name\">\n                      {{ item.name }} - ‚Ç±{{ item.price }} x {{ item.quantity }}\n                    </li>\n                  </ul>\n                </div>\n\n                <!-- Total Amount below items -->\n                <div class=\"order-total\">\n                  <p><strong>Total Amount: ‚Ç±{{ calculateOrderTotal(order.items) }}</strong></p>\n                </div>\n              </div>\n\n              <div class=\"order-actions\">\n                <!-- Mark as Completed Buttons -->\n                <button \n                  @click=\"showCompletionConfirmation(order.id)\" \n                  class=\"mark-completed-btn small-btn\"\n                  :disabled=\"!orderReadyStatus[order.id]\"\n                  :class=\"{ 'disabled': !orderReadyStatus[order.id] }\"\n                >\n                  Mark as Completed\n                </button>\n\n                <!-- Order Ready button -->\n                <button \n                  @click=\"sendOrderReadyNotification(order.id, order.customer_name, order.items)\" \n                  class=\"order-ready-btn small-btn\"\n                >\n                  Order Ready  üîî\n                </button>\n\n                <!-- Decline button -->\n                <button @click=\"openDeclineDialog(order)\" class=\"decline-btn\">\n                  Decline\n                </button>\n              </div>\n            </div>\n          </div>\n          \n          <!-- Completion Confirmation Popup -->\n          <div v-if=\"confirmCompleteOrderId\" class=\"completion-confirmation-popup\">\n            <div class=\"completion-confirmation-content\">\n              <h3>Confirm Completion</h3>\n              <p>Are you sure Order ID: {{ confirmCompleteOrderId }} is completed?</p>\n              <div class=\"confirmation-buttons\">\n                <button @click=\"confirmCompletion\" class=\"confirm-yes-btn\">Yes</button>\n                <button @click=\"cancelCompletion\" class=\"confirm-no-btn\">No</button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div v-else-if=\"!isLoading\" class=\"no-orders\">\n          <p>No pending orders at the moment.</p>\n        </div>\n\n        <!-- Popup Notification Sent -->\n        <div v-if=\"notificationSent\" class=\"notification-sent-popup\">\n          <p>Notification Sent!</p>\n          <button @click=\"notificationSent = false\" class=\"close-popup-btn\">Close</button>\n        </div>\n\n        <!-- Menu Editor Popup Modal -->\n        <div v-if=\"showMenuEditor\" class=\"menu-editor-modal\">\n          <div class=\"menu-editor-content\">\n            <div class=\"menu-editor-header\">\n              <h2>Menu Editor</h2>\n              <button @click=\"toggleMenuEditor\" class=\"close-modal-btn\">\n                <i class=\"fa-solid fa-times\"></i>\n              </button>\n            </div>\n            <div class=\"menu-editor-body\">\n              <ItemEditor />\n            </div>\n          </div>\n        </div>\n\n        <!-- Stock Management Modal -->\n        <div v-if=\"showStockManager\" class=\"stock-manager-modal\">\n          <div class=\"stock-manager-content\">\n            <div class=\"stock-manager-header\">\n              <h2>Stock Management</h2>\n              <button @click=\"toggleStockManager\" class=\"close-modal-btn\">\n                <i class=\"fa-solid fa-times\"></i>\n              </button>\n            </div>\n            <div class=\"stock-manager-body\">\n              <!-- Search Bar -->\n              <div class=\"stock-search-bar\">\n                <div class=\"stock-filters\">\n                  <input \n                    type=\"text\" \n                    v-model=\"stockSearchQuery\" \n                    placeholder=\"Search items...\" \n                    class=\"search-input\"\n                  />\n                  <select v-model=\"selectedCategory\" class=\"category-filter\">\n                    <option value=\"\">All Categories</option>\n                    <option v-for=\"category in uniqueCategories\" :key=\"category\" :value=\"category\">\n                      {{ category }}\n                    </option>\n                  </select>\n                </div>\n              </div>\n\n              <!-- Stock Items Table -->\n              <div class=\"stock-table-container\">\n                <table class=\"stock-table\">\n                  <thead>\n                    <tr>\n                      <th>Item Name</th>\n                      <th>Category</th>\n                      <th>Current Stock</th>\n                      <th>Status</th>\n                      <th>Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    <tr v-for=\"item in filteredStockItems\" :key=\"item.id\">\n                      <td>{{ item.name }}</td>\n                      <td>{{ item.category }}</td>\n                      <td>{{ item.quantity >= 999999 ? 'Unlimited' : item.quantity }}</td>\n                      <td :class=\"getStockStatusClass(item)\">{{ getStockStatus(item) }}</td>\n                      <td>\n                        <button @click=\"openStockUpdateModal(item)\" class=\"update-stock-btn\">\n                          Update Stock\n                        </button>\n                      </td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Stock Update Modal -->\n        <div v-if=\"showStockUpdateModal\" class=\"stock-update-modal\">\n          <div class=\"stock-update-content\">\n            <h3>Update Stock: {{ selectedItem?.name }}</h3>\n            <div class=\"stock-update-form\">\n              <div class=\"form-group\">\n                <label>Current Stock: {{ selectedItem?.quantity >= 999999 ? 'Unlimited' : selectedItem?.quantity }}</label>\n              </div>\n              <div class=\"form-group\">\n                <label>Action:</label>\n                <select v-model=\"stockUpdateAction\">\n                  <option value=\"add\">Add Stock</option>\n                  <option value=\"subtract\">Remove Stock</option>\n                  <option value=\"set\">Set Stock</option>\n                  <option value=\"disabled\">Disabled (Out of Stock)</option>\n                  <option value=\"enabled\">Enabled (Unlimited Orders)</option>\n                </select>\n              </div>\n              <div class=\"form-group\">\n                <label>Quantity:</label>\n                <input \n                  v-if=\"stockUpdateAction !== 'disabled' && stockUpdateAction !== 'enabled'\"\n                  type=\"number\" \n                  v-model.number=\"stockUpdateQuantity\" \n                  min=\"0\"\n                  :max=\"stockUpdateAction === 'subtract' ? selectedItem?.quantity : 999999\"\n                />\n                <span v-else-if=\"stockUpdateAction === 'disabled'\">\n                  Item will be marked as out of stock and cannot be ordered.\n                </span>\n                <span v-else-if=\"stockUpdateAction === 'enabled'\">\n                  Item will be available for unlimited orders regardless of quantity.\n                </span>\n              </div>\n              <div class=\"form-group\">\n                <label>Reason:</label>\n                <input type=\"text\" v-model=\"stockUpdateReason\" placeholder=\"Enter reason for update\"/>\n              </div>\n              <div class=\"update-buttons\">\n                <button @click=\"submitStockUpdate\" class=\"confirm-btn\">Update Stock</button>\n                <button @click=\"closeStockUpdateModal\" class=\"cancel-btn\">Cancel</button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Decline Modal -->\n        <div v-if=\"showDeclineModal\" class=\"decline-modal-overlay\">\n          <div class=\"decline-modal-content\">\n            <div class=\"decline-modal-header\">\n              <h3>Order Adjustment</h3>\n              <button @click=\"closeDeclineModal\" class=\"close-modal-btn\">‚úï</button>\n      </div>\n            <div class=\"decline-modal-body\">\n              <p><strong>Order ID:</strong> {{ selectedOrder?.id }}</p>\n              <p><strong>Customer:</strong> {{ selectedOrder?.customer_name }}</p>\n              \n              <!-- Customized Message -->\n              <div class=\"form-group\">\n                <label>Message to Customer:</label>\n                <textarea \n                  v-model=\"customDeclineMessage\" \n                  placeholder=\"Enter a message explaining the changes...\" \n                  rows=\"3\"\n                ></textarea>\n              </div>\n              \n              <!-- Edit Item Quantities -->\n              <div class=\"form-group\">\n                <label>Adjust Item Quantities:</label>\n                <div class=\"items-adjustment\">\n                  <div v-for=\"(item, index) in editableItems\" :key=\"index\" class=\"item-adjust-row\">\n                    <span class=\"item-name\">{{ item.name }}</span>\n                    <div class=\"quantity-controls\">\n                      <button @click=\"decrementQuantity(index)\" :disabled=\"item.quantity <= 0\">-</button>\n                      <input type=\"number\" v-model.number=\"item.quantity\" min=\"0\">\n                      <button @click=\"incrementQuantity(index)\">+</button>\n                    </div>\n                    <span class=\"item-price\">‚Ç±{{ (item.price * item.quantity).toFixed(2) }}</span>\n                  </div>\n                </div>\n                <p class=\"adjusted-total\"><strong>Adjusted Total:</strong> ‚Ç±{{ calculateAdjustedTotal() }}</p>\n              </div>\n              \n              <!-- Action Buttons -->\n              <div class=\"decline-modal-actions\">\n                <button \n                  @click=\"sendForApproval\" \n                  class=\"send-approval-btn\"\n                  :disabled=\"isUpdating\"\n                >\n                  <span v-if=\"isUpdating\">\n                    <i class=\"fas fa-spinner fa-spin\"></i> Updating...\n                  </span>\n                  <span v-else>Send for Approval</span>\n                </button>\n                <button \n                  @click=\"confirmDecline\" \n                  class=\"confirm-decline-btn\"\n                  :disabled=\"isUpdating\"\n                >\n                  <span v-if=\"isUpdating\">\n                    <i class=\"fas fa-spinner fa-spin\"></i> Declining...\n                  </span>\n                  <span v-else>Declined</span>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Settings Modal -->\n  <div v-if=\"showSettings\" class=\"settings-modal\">\n    <div class=\"settings-content\">\n      <div class=\"settings-header\">\n        <h2>Settings</h2>\n        <button @click=\"toggleSettings\" class=\"close-modal-btn\">\n          <i class=\"fa-solid fa-times\"></i>\n        </button>\n      </div>\n      <div class=\"settings-body\">\n        <div class=\"settings-section\">\n          <h3>Change Password</h3>\n          <form @submit.prevent=\"changeAdminPassword\" class=\"password-form\">\n            <div class=\"form-group\">\n              <label for=\"currentPassword\">Current Password</label>\n              <input \n                type=\"password\" \n                id=\"currentPassword\" \n                v-model=\"passwordForm.currentPassword\"\n                placeholder=\"Enter current password\" \n                required\n              />\n            </div>\n            <div class=\"form-group\">\n              <label for=\"newPassword\">New Password</label>\n              <input \n                type=\"password\" \n                id=\"newPassword\" \n                v-model=\"passwordForm.newPassword\"\n                placeholder=\"Enter new password\" \n                required\n              />\n            </div>\n            <div class=\"form-group\">\n              <label for=\"confirmPassword\">Confirm New Password</label>\n              <input \n                type=\"password\" \n                id=\"confirmPassword\" \n                v-model=\"passwordForm.confirmPassword\"\n                placeholder=\"Confirm new password\" \n                required\n              />\n            </div>\n            <div v-if=\"passwordForm.error\" class=\"error-message\">\n              {{ passwordForm.error }}\n            </div>\n            <div v-if=\"passwordForm.success\" class=\"success-message\">\n              {{ passwordForm.success }}\n            </div>\n            <button type=\"submit\" class=\"change-password-btn\">Change Password</button>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport ItemEditor from './ItemEditor.vue'\n\nexport default {\n  components: {\n    ItemEditor\n  },\n  data() {\n    return {\n      orders: [], // Store pending orders\n      isLoading: true, // For loading state\n      ws: null, // WebSocket connection\n      wsConnected: false,\n      activeDeclineOrderId: null, // Track the order for which decline message is being customized\n      customDeclineMessage: \"\", // Store the custom decline message\n      notificationSent: false, // To track if the notification has been sent\n      searchQuery: \"\", // To hold the search query input\n      isCafeOpen: true,\n      notificationMessage: \"\",\n      notificationClass: \"\", \n      notificationVisible: false,\n      showMenuEditor: false, // Control visibility of menu editor popup\n      isSidebarOpen: false,\n      orderReadyStatus: {}, // Track which orders are ready\n      confirmCompleteOrderId: null, // Track which order is being confirmed for completion\n      showStockManager: false,\n      showStockUpdateModal: false,\n      stockItems: [],\n      stockSearchQuery: '',\n      selectedItem: null,\n      stockUpdateAction: 'add',\n      stockUpdateQuantity: 0,\n      stockUpdateReason: '',\n      selectedCategory: '',\n      uniqueCategories: [],\n      // New properties for decline modal\n      showDeclineModal: false,\n      selectedOrder: null,\n      editableItems: [],\n      refreshInterval: null, // To store the interval ID for automatic refresh\n      isUpdating: false, // New property for loading state\n      pingInterval: null, // To store the interval ID for periodic ping\n      passwordForm: {\n        currentPassword: '',\n        newPassword: '',\n        confirmPassword: '',\n        error: '',\n        success: ''\n      },\n      currentPageSize: 10,\n      hasMoreOrders: false,\n    };\n  },\n  computed: {\n    // Filter orders based on search query\n    filteredOrders() {\n      if (!this.searchQuery) {\n        return this.orders;\n      }\n      return this.orders.filter(order => {\n        const lowerCaseSearchQuery = this.searchQuery.toLowerCase();\n        return (\n          order.id.toString().includes(lowerCaseSearchQuery) || // Search by Order ID\n          order.customer_name.toLowerCase().includes(lowerCaseSearchQuery) // Search by Customer Name\n        );\n      });\n    },\n    filteredStockItems() {\n      return this.stockItems.filter(item => {\n        if (!item || !item.name) return false;\n        const matchesSearch = item.name.toLowerCase().includes((this.stockSearchQuery || '').toLowerCase());\n        const matchesCategory = !this.selectedCategory || item.category === this.selectedCategory;\n        return matchesSearch && matchesCategory;\n      });\n    }\n  },\n\n  methods: {\n    toggleCafeStatus() {\n    this.isCafeOpen = !this.isCafeOpen; // Toggle the cafe status\n    localStorage.setItem('isCafeOpen', this.isCafeOpen); // Store cafe status\n\n    // Set the notification message and class based on the cafe status\n    if (this.isCafeOpen) {\n      this.notificationMessage = \"Cafe Be√†ta is now Open!\";\n      this.notificationClass = \"open-notification\"; // Set class for green when open\n    } else {\n      this.notificationMessage = \"Cafe Be√†ta is now Closed!\";\n      this.notificationClass = \"closed-notification\"; // Set class for red when closed\n    }\n\n    this.showNotification();  // Show the notification\n  },\n  \n   showNotification() {\n    // Show the notification and reset visibility after a timeout\n    this.notificationVisible = true;\n\n    setTimeout(() => {\n      this.notificationVisible = false;\n    }, 3000);  // Hide after 3 seconds\n  },\n\n\n    timeAgo(timestamp) {\n    // If timestamp is a string, ensure it's in ISO format by replacing space with \"T\"\n    if (typeof timestamp === \"string\") {\n      timestamp = timestamp.replace(\" \", \"T\"); // Convert to ISO format: \"YYYY-MM-DD HH:MM:SS\" -> \"YYYY-MM-DDTHH:MM:SS\"\n    }\n\n    const now = new Date();\n    const orderTime = new Date(timestamp); // Parse the timestamp\n\n    // Check if the timestamp is valid\n    if (isNaN(orderTime)) {\n      return \"Invalid time\"; // Return fallback message if timestamp is invalid\n    }\n\n    const differenceInSeconds = Math.floor((now - orderTime) / 1000);\n\n    if (differenceInSeconds < 60) {\n      return 'Just now';\n    } else if (differenceInSeconds < 3600) {\n      const minutes = Math.floor(differenceInSeconds / 60);\n      return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;\n    } else if (differenceInSeconds < 86400) {\n      const hours = Math.floor(differenceInSeconds / 3600);\n      return `${hours} hour${hours > 1 ? 's' : ''} ago`;\n    } else if (differenceInSeconds < 2592000) {\n      const days = Math.floor(differenceInSeconds / 86400);\n      return `${days} day${days > 1 ? 's' : ''} ago`;\n    } else if (differenceInSeconds < 31536000) {\n      const months = Math.floor(differenceInSeconds / 2592000);\n      return `${months} month${months > 1 ? 's' : ''} ago`;\n    } else {\n      const years = Math.floor(differenceInSeconds / 31536000);\n      return `${years} year${years > 1 ? 's' : ''} ago`;\n    }\n  },\n\n\n\n    // Method to format the order date in the required format\n    formatDate(dateString) {\n      const date = new Date(dateString);\n      const month = (date.getMonth() + 1).toString().padStart(2, '0');\n      const day = date.getDate().toString().padStart(2, '0');\n      const year = date.getFullYear();\n      const hours = date.getHours();\n      const minutes = date.getMinutes().toString().padStart(2, '0');\n      const period = hours >= 12 ? 'PM' : 'AM';\n      const hour12 = (hours % 12 || 12).toString().padStart(2, '0');\n      \n      // Format: MM-DD-YYYY with highlighted time\n      const formattedDate = `${month}-${day}-${year} <span class=\"highlighted-time\">${hour12}:${minutes} ${period}</span>`;\n      return formattedDate;\n    },\n\n    cancelDecline() {\n      this.activeDeclineOrderId = null; // Hide decline input\n      this.customDeclineMessage = \"\"; // Clear text\n    },\n\n    // Navigate to the Order Record page\n    goToOrderRecord() {\n      this.$router.push({ name: \"OrderRecord\" });  // Ensure this matches the name of the route\n    },\n\n    logout() {\n      this.$router.push({ name: \"Login\" });  // Redirect the user to the Login page (adjust the route as needed)\n    },\n\n    // Fetch orders only once at initial load\n    async fetchOrders() {\n      if (this.isLoading) return;\n      this.isLoading = true;\n      \n      try {\n        const response = await fetch(\"http://127.0.0.1:8000/orders\");\n        const data = await response.json();\n        if (data.orders && Array.isArray(data.orders)) {\n          // Filter pending orders and sort them by ID in ascending order\n          const pendingOrders = data.orders\n            .filter(order => order.status === \"pending\")\n            .sort((a, b) => {\n              // Convert order IDs to numbers for proper numerical sorting\n              const idA = parseInt(a.id);\n              const idB = parseInt(b.id);\n              return idA - idB; // Sort in ascending order (lower IDs first)\n            });\n          \n          console.log(`Fetched ${pendingOrders.length} pending orders`);\n          \n          // Important: Create a new array reference to ensure Vue reactivity\n          this.orders = [...pendingOrders];\n          \n          // Check if any of the fetched orders have ready notifications\n          // This ensures the \"Mark as Completed\" button is enabled for orders that are ready\n          this.orders.forEach(order => {\n            // If the order is already marked as ready in localStorage, keep that status\n            if (this.orderReadyStatus[order.id]) {\n              return;\n            }\n            \n            // Check if there's a notification for this order\n            const userNotificationsKey = `user_notifications_${order.customer_name}`;\n            const notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n            const hasReadyNotification = notifications.some(n => n.orderId === order.id);\n            \n            if (hasReadyNotification) {\n              this.orderReadyStatus[order.id] = true;\n            }\n          });\n          \n          // Update localStorage with any changes\n          localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n          \n          // Force the UI to update\n          this.$forceUpdate();\n        } else {\n          console.error(\"Invalid data format\", data);\n          this.orders = [];\n        }\n      } catch (error) {\n        console.error(\"Error fetching orders:\", error);\n      } finally {\n        this.isLoading = false;\n      }\n    },\n\n    // Format ordered items for notification message\n    formatItems(items) {\n      if (!Array.isArray(items)) {\n        console.error(\"Invalid item format:\", items);\n        return \"Invalid item data\";\n      }\n      return items.map(item => `${item.name} x${item.quantity}`).join(\", \");\n    },\n\n    // Calculate the total price for a single order\n    calculateOrderTotal(items) {\n      if (!Array.isArray(items)) return \"‚Ç±0\";\n      return items.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n    },\n\n    // Mark an order as completed and send notification\n    markAsCompleted(orderId, customerName, items) {\n      // Log for debugging\n      console.log(`Marking order ${orderId} as completed...`);\n      \n      // Ensure items is properly formatted\n      let processedItems = items;\n      if (typeof items === 'string') {\n        try {\n          processedItems = JSON.parse(items);\n        } catch (e) {\n          console.error(\"Failed to parse items:\", e);\n          alert(\"Error processing order items. Please try again.\");\n          return;\n        }\n      }\n      \n      fetch(`http://127.0.0.1:8000/orders/${orderId}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ status: \"completed\" })\n      })\n        .then(response => {\n          // First check if the response is actually received\n          if (!response) {\n            throw new Error('No response received from server');\n          }\n          \n          // Then check if it's OK\n          if (!response.ok) {\n            return response.text().then(text => {\n              try {\n                // Try to parse as JSON\n                const data = JSON.parse(text);\n                throw new Error(data.detail || `Server error: ${response.status}`);\n              } catch (e) {\n                // If parsing fails, use the raw text\n                throw new Error(`Server error: ${response.status} - ${text || 'Unknown error'}`);\n              }\n            });\n          }\n          return response.json();\n        })\n        .then((data) => {\n          console.log(\"Order completed successfully:\", data);\n          \n          // Immediately remove from pending orders\n          this.orders = this.orders.filter(order => order.id !== orderId);\n\n          // Remove from orderReadyStatus\n          delete this.orderReadyStatus[orderId];\n          // Update localStorage\n          localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n\n          // Calculate the total price\n          const total = processedItems.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n\n          // Prepare the notification with highlighted order details\n          const notification = {\n            orderId,\n            customerName,\n            message: `Your order is completed! ‚úîÔ∏è Thank you for choosing Caf√© Beata. Enjoy your food and drinks! ü•∞. <span class=\"highlighted-order-details\">Order details: ${this.formatItems(processedItems)}. Total: ‚Ç±${total}</span>`,\n            timestamp: new Date().toISOString(),\n            items: processedItems,\n            total,\n          };\n\n          // Save the notification in localStorage for the specific user\n          const userNotificationsKey = `user_notifications_${customerName}`;\n          let notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n          notifications.push(notification);\n          localStorage.setItem(userNotificationsKey, JSON.stringify(notifications));\n\n          // Send real-time notification via WebSocket if connected\n          if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n            this.ws.send(JSON.stringify({\n              type: 'user_notification',\n              action: 'order_completed',\n              notification: notification,\n              target_user: customerName\n            }));\n          }\n\n          // Emit an event to notify other components\n          window.dispatchEvent(new Event(\"notificationUpdated\"));\n\n          alert(\"Order marked as completed!\");\n        })\n        .catch(error => {\n          console.error(\"Error marking order as completed:\", error);\n          alert(error.message || \"Error completing order. Please try again.\");\n          // Refresh orders to ensure UI is in sync\n          this.fetchOrders();\n        });\n    },\n\n    // Open the decline modal for a specific order\n    openDeclineDialog(order) {\n      this.activeDeclineOrderId = order.id;\n      this.selectedOrder = order;\n      this.customDeclineMessage = localStorage.getItem(`customDeclineMessage_${order.id}`) || \"We need to adjust your order due to availability issues.\";\n      \n      // Clone the items array to make it editable\n      this.editableItems = JSON.parse(JSON.stringify(order.items));\n      \n      // Show the modal\n      this.showDeclineModal = true;\n    },\n\n    // Close the decline modal\n    closeDeclineModal() {\n      this.showDeclineModal = false;\n      this.activeDeclineOrderId = null;\n      this.selectedOrder = null;\n    },\n\n    // Increment item quantity\n    incrementQuantity(index) {\n      this.editableItems[index].quantity++;\n    },\n\n    // Decrement item quantity\n    decrementQuantity(index) {\n      if (this.editableItems[index].quantity > 0) {\n        this.editableItems[index].quantity--;\n      }\n    },\n\n    // Calculate the total of adjusted items\n    calculateAdjustedTotal() {\n      return this.editableItems.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2);\n    },\n\n    // Send order adjustment for customer approval\n    sendForApproval() {\n      if (!this.selectedOrder) return;\n      \n      const orderId = this.selectedOrder.id;\n      const customerName = this.selectedOrder.customer_name;\n      \n      // Calculate the total price\n      const total = this.calculateAdjustedTotal();\n      \n      // Format items for display\n      const formattedItems = this.formatItems(this.editableItems);\n      \n      // Build a more specific message about quantity adjustments\n      let adjustmentReasons = [];\n      this.editableItems.forEach((item) => {\n        const originalItem = this.selectedOrder.items.find(i => i.name === item.name);\n        if (originalItem && originalItem.quantity !== item.quantity) {\n          adjustmentReasons.push(`${item.name} adjusted from ${originalItem.quantity} to ${item.quantity} due to limited availability`);\n        }\n      });\n      \n      // Create the customized message with specific quantity adjustment reasons\n      const specificAdjustments = adjustmentReasons.length > 0 \n        ? `The following adjustments were made: ${adjustmentReasons.join('; ')}. ` \n        : '';\n        \n      // Prepare notification message with approval buttons\n      const message = `${this.customDeclineMessage} ${specificAdjustments}Please review the adjusted order: ${formattedItems}. Total: ‚Ç±${total}`;\n      \n      // Create adjustment notification with approval options\n      const notification = {\n        orderId,\n        customerName,\n        message,\n        timestamp: new Date().toISOString(),\n        items: this.editableItems,\n        total,\n        requiresApproval: true,  // Flag to indicate this needs user approval\n        originalItems: this.selectedOrder.items  // Store original items for reference\n      };\n      \n      // Set loading state\n      this.isUpdating = true;\n      \n      // First update the order in the database with the adjusted quantities\n      fetch(`http://127.0.0.1:8000/orders/${orderId}/update-items`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          items: this.editableItems,\n          status: \"pending\",  // Keep status as pending\n          isPendingApproval: true // Add flag for pending approval\n        })\n      })\n      .then(response => {\n        if (!response.ok) {\n          return response.text().then(text => {\n            console.error(`Error status: ${response.status}, details: ${text}`);\n            throw new Error(`Failed to update order (${response.status}): ${text}`);\n          });\n        }\n        return response.json();\n      })\n      .then((data) => {\n        console.log(\"Order items updated in database successfully\", data);\n        \n        // Now save to user's notifications\n        const userNotificationsKey = `user_notifications_${customerName}`;\n        let notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n        notifications.push(notification);\n        localStorage.setItem(userNotificationsKey, JSON.stringify(notifications));\n        \n        // Send WebSocket notification if connected\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          this.ws.send(JSON.stringify({\n            type: 'user_notification',\n            action: 'order_adjustment',  // Set specific action type for adjustment requests\n            notification: notification,\n            target_user: customerName\n          }));\n        }\n        \n        // Update the order in the UI immediately to show adjusted quantities\n        const orderIndex = this.orders.findIndex(o => o.id === orderId);\n        if (orderIndex !== -1) {\n          // Create a copy with adjusted items\n          const updatedOrder = {\n            ...this.orders[orderIndex],\n            items: this.editableItems,\n            isPendingApproval: true // Add flag for styling\n          };\n          \n          // Update the order in the list - using Vue 3 array mutation\n          this.orders = [\n            ...this.orders.slice(0, orderIndex),\n            updatedOrder,\n            ...this.orders.slice(orderIndex + 1)\n          ];\n        }\n        \n        // Show confirmation\n        this.notificationMessage = \"Adjustment request sent to customer for approval!\";\n        this.notificationClass = \"success-notification\";\n        this.showNotification();\n        \n        // Close the modal and reset loading state\n        this.isUpdating = false;\n        this.closeDeclineModal();\n      })\n      .catch(error => {\n        console.error(\"Error updating order items:\", error);\n        \n        // Reset loading state but keep modal open for retry\n        this.isUpdating = false;\n        \n        // Show error notification\n        this.notificationMessage = `Error: ${error.message}`;\n        this.notificationClass = \"error-notification\";\n        this.showNotification();\n        \n        // Ask user if they want to retry via modal or notification\n        if (confirm(`Failed to update order: ${error.message}. Do you want to retry?`)) {\n          // Retry the update\n          this.sendForApproval();\n        }\n      });\n    },\n\n    // Decline the order directly\n    confirmDecline() {\n      if (!this.selectedOrder) return;\n      \n      // Show loading indicator\n      this.isUpdating = true;\n      \n      const orderId = this.selectedOrder.id;\n      const customerName = this.selectedOrder.customer_name;\n      const items = this.selectedOrder.items;\n      const message = this.customDeclineMessage || \"Unfortunately, this item is temporarily out of stock. We apologize for the inconvenience and appreciate your patience. üôè\";\n      \n      fetch(`http://127.0.0.1:8000/orders/${orderId}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ status: \"declined\" })\n      })\n      .then(response => {\n        if (!response.ok) {\n          throw new Error(`HTTP error! Status: ${response.status}`);\n        }\n        return response.json();\n      })\n      .then(() => {\n        // Remove from pending orders immediately\n        this.orders = this.orders.filter(order => order.id !== orderId);\n        \n        // Remove from orderReadyStatus if it exists\n        if (this.orderReadyStatus[orderId]) {\n          delete this.orderReadyStatus[orderId];\n          localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n        }\n        \n        // Calculate total\n        const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n        \n        // Prepare notification\n        const notification = {\n          orderId,\n          customerName,\n          message: `${message} Order details: ${this.formatItems(items)}. Total: ‚Ç±${total}`,\n          timestamp: new Date().toISOString(),\n          items, \n          total,\n        };\n        \n        // Save notification to localStorage\n        const userNotificationsKey = `user_notifications_${customerName}`;\n        let notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n        notifications.push(notification);\n        localStorage.setItem(userNotificationsKey, JSON.stringify(notifications));\n        \n        // Send direct WebSocket notification for real-time updates\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          console.log('Sending WebSocket notification for declined order:', orderId);\n          \n          // First send the standard notification\n          this.ws.send(JSON.stringify({\n            type: 'user_notification',\n            action: 'order_declined',\n            notification: notification,\n            target_user: customerName\n          }));\n          \n          // Then send a special order_declined type message for real-time notification\n          this.ws.send(JSON.stringify({\n            type: 'order_declined',\n            order_id: orderId,\n            customer_name: customerName,\n            reason: message,\n            timestamp: new Date().toISOString()\n          }));\n        }\n        \n        // Reset loading state\n        this.isUpdating = false;\n        \n        // Close the modal\n        this.closeDeclineModal();\n        \n        // Show success message\n        this.notificationMessage = `Order #${orderId} has been declined`;\n        this.notificationClass = \"closed-notification\";\n        this.showNotification();\n        \n      })\n      .catch(error => {\n        console.error(\"Error declining order:\", error);\n        this.isUpdating = false;\n        alert(\"Error declining order. Please try again.\");\n      });\n    },\n\n    // Original decline order function - unchanged\n    declineOrder(orderId, customerName, items) {\n      const message = this.customDeclineMessage || \"Unfortunately, this item is temporarily out of stock. We apologize for the inconvenience and appreciate your patience. üôè\";\n\n      fetch(`http://127.0.0.1:8000/orders/${orderId}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ status: \"declined\" }) // Properly formatted JSON\n      })\n        .then(response => {\n          if (!response.ok) {\n            throw new Error(`HTTP error! Status: ${response.status}`);\n          }\n          return response.json();\n        })\n        .then(() => {\n          // Immediately remove from pending orders\n          this.orders = this.orders.filter(order => order.id !== orderId);\n\n          // Remove from orderReadyStatus if it exists\n          if (this.orderReadyStatus[orderId]) {\n            delete this.orderReadyStatus[orderId];\n            // Update localStorage\n            localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n          }\n\n          // Calculate the total price\n          const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n\n          // Prepare the notification with the custom message and order details\n          const notification = {\n            orderId,\n            customerName,\n            message: `${message} Order details: ${this.formatItems(items)}. Total: ‚Ç±${total}`,\n            timestamp: new Date().toISOString(),\n            items,  // Include items in the notification\n            total,  // Include total in the notification\n          };\n\n          // Save the notification in localStorage for the specific user\n          const userNotificationsKey = `user_notifications_${customerName}`;\n          let notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n          notifications.push(notification);\n          localStorage.setItem(userNotificationsKey, JSON.stringify(notifications));\n\n          // Send direct WebSocket notification for real-time updates\n          if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n            console.log('Sending WebSocket notification for declined order:', orderId);\n            \n            // First send the standard notification\n            this.ws.send(JSON.stringify({\n              type: 'user_notification',\n              action: 'order_declined',\n              notification: notification,\n              target_user: customerName\n            }));\n            \n            // Then send a special order_declined type message for real-time notification\n            this.ws.send(JSON.stringify({\n              type: 'order_declined',\n              order_id: orderId,\n              customer_name: customerName,\n              reason: message,\n              timestamp: new Date().toISOString()\n            }));\n          }\n\n          // Emit an event to notify other components (optional)\n          window.dispatchEvent(new Event(\"orderDeclined\"));\n\n          // Show success message\n          this.notificationMessage = `Order #${orderId} has been declined`;\n          this.notificationClass = \"closed-notification\";\n          this.showNotification();\n        })\n        .catch(error => {\n          console.error(\"Error declining order:\", error);\n          this.isUpdating = false;\n          alert(\"Error declining order. Please try again.\");\n        });\n    },\n\n    // Save the decline message to localStorage whenever it's updated\n    updateDeclineMessage() {\n      if (this.activeDeclineOrderId !== null) {\n        localStorage.setItem(`customDeclineMessage_${this.activeDeclineOrderId}`, this.customDeclineMessage);\n      }\n    },\n\n    // New method to handle the \"Order Ready\" button click and show pop-up notification\n    sendOrderReadyNotification(orderId, customerName, items) {\n      const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);\n\n      const notification = {\n        orderId,\n        customerName,\n        message: `Your order is now ready! Proceed to the cashier for payment and pickup. ‚ò∫Ô∏è Order details: ${this.formatItems(items)}. Total: ‚Ç±${total}`,\n        timestamp: new Date().toISOString(),\n        items,\n        total,\n      };\n\n      // Save the notification in localStorage for the specific user\n      const userNotificationsKey = `user_notifications_${customerName}`;\n      let notifications = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];\n      \n      // Add the notification without replacing existing ones\n      notifications.push(notification);\n      \n      // Sort notifications by timestamp (newest first)\n      notifications.sort((a, b) => {\n        const dateA = new Date(a.timestamp);\n        const dateB = new Date(b.timestamp);\n        return dateB - dateA;\n      });\n      \n      localStorage.setItem(userNotificationsKey, JSON.stringify(notifications));\n\n      // Set order as ready using direct assignment\n      this.orderReadyStatus[orderId] = true;\n      // Force reactivity update\n      this.orderReadyStatus = { ...this.orderReadyStatus };\n      \n      // Save orderReadyStatus to localStorage\n      localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n\n      // Send real-time notification via WebSocket if connected\n      if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n        this.ws.send(JSON.stringify({\n          type: 'user_notification',\n          action: 'order_ready',\n          notification: notification,\n          target_user: customerName\n        }));\n      }\n\n      // Show success notification to admin\n      this.notificationSent = true;\n      setTimeout(() => {\n        this.notificationSent = false;\n      }, 3000);\n    },\n\n    // Toggle menu editor popup visibility\n    toggleMenuEditor() {\n      this.showMenuEditor = !this.showMenuEditor;\n    },\n\n    // Toggle sidebar visibility\n    toggleSidebar() {\n      this.isSidebarOpen = !this.isSidebarOpen;\n      // When opening the sidebar, prevent scrolling on the body\n      if (this.isSidebarOpen) {\n        document.body.style.overflow = 'hidden';\n      } else {\n        document.body.style.overflow = '';\n      }\n    },\n\n    // Close sidebar - only called when X button is clicked\n    closeSidebar() {\n      this.isSidebarOpen = false;\n      document.body.style.overflow = '';\n    },\n\n    // Handle clicks outside sidebar - removed to prevent auto-closing when clicking outside\n    handleOutsideClick() {\n      // Do nothing - sidebar should stay open\n    },\n\n    // Add new methods for completion confirmation\n    showCompletionConfirmation(orderId) {\n      this.confirmCompleteOrderId = orderId;\n    },\n\n    confirmCompletion() {\n      const order = this.orders.find(o => o.id === this.confirmCompleteOrderId);\n      if (order) {\n        this.markAsCompleted(order.id, order.customer_name, order.items);\n      }\n      this.confirmCompleteOrderId = null;\n    },\n\n    cancelCompletion() {\n      this.confirmCompleteOrderId = null;\n    },\n\n    toggleStockManager() {\n      this.showStockManager = !this.showStockManager;\n    },\n\n    toggleSettings() {\n      this.showSettings = !this.showSettings;\n      // Reset form when opening/closing\n      if (this.showSettings) {\n        this.passwordForm = {\n          currentPassword: '',\n          newPassword: '',\n          confirmPassword: '',\n          error: '',\n          success: ''\n        };\n      }\n    },\n\n    changeAdminPassword() {\n      // Reset previous messages\n      this.passwordForm.error = '';\n      this.passwordForm.success = '';\n      \n      // Check if current password is correct\n      const storedPassword = \"admin123\"; // The default password\n      \n      if (this.passwordForm.currentPassword !== storedPassword) {\n        this.passwordForm.error = \"Current password is incorrect\";\n        return;\n      }\n      \n      // Validate new password\n      if (this.passwordForm.newPassword.length < 6) {\n        this.passwordForm.error = \"New password must be at least 6 characters\";\n        return;\n      }\n      \n      // Check if passwords match\n      if (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {\n        this.passwordForm.error = \"New passwords do not match\";\n        return;\n      }\n      \n      // Update the password in localStorage (in a real app, you would call an API)\n      localStorage.setItem(\"adminPassword\", this.passwordForm.newPassword);\n      \n      // Show success message\n      this.passwordForm.success = \"Password changed successfully!\";\n      \n      // Reset form after successful change\n      setTimeout(() => {\n        this.passwordForm.currentPassword = '';\n        this.passwordForm.newPassword = '';\n        this.passwordForm.confirmPassword = '';\n      }, 1000);\n    },\n\n    async fetchStockItems() {\n      try {\n        const response = await fetch('http://localhost:8000/api/stocks');\n        const data = await response.json();\n        console.log('Fetched stock data:', data); // Debug log\n        \n        if (data.success && Array.isArray(data.items)) {\n          // Map the items to include name and category from item_name\n          this.stockItems = data.items.map(item => ({\n            id: item.item_id, // Use item_id from the API response\n            name: item.item_name,\n            category: item.category,\n            quantity: item.quantity,\n            min_stock_level: item.min_stock_level\n          }));\n          \n          // Update unique categories\n          this.uniqueCategories = [...new Set(this.stockItems.map(item => item.category))];\n          console.log('Processed stock items:', this.stockItems); // Debug log\n        } else {\n          console.error('Invalid data format received:', data);\n        }\n      } catch (error) {\n        console.error('Error fetching stock items:', error);\n      }\n    },\n\n    getStockStatus(item) {\n      if (item.quantity === 0) return 'Disabled (Out of Stock)';\n      if (item.quantity >= 999999) return 'Enabled (Unlimited)';\n      if (item.quantity <= item.min_stock_level) return 'Low Stock';\n      return 'In Stock';\n    },\n\n    getStockStatusClass(item) {\n      if (item.quantity === 0) return 'status-disabled';\n      if (item.quantity >= 999999) return 'status-enabled';\n      if (item.quantity <= item.min_stock_level) return 'status-low';\n      return 'status-ok';\n    },\n\n    openStockUpdateModal(item) {\n      console.log('Opening modal for item:', item); // Debug log\n      this.selectedItem = item;\n      this.showStockUpdateModal = true;\n      this.stockUpdateQuantity = 0;\n      this.stockUpdateAction = 'add';\n      this.stockUpdateReason = '';\n    },\n\n    closeStockUpdateModal() {\n      this.showStockUpdateModal = false;\n      this.selectedItem = null;\n      this.stockUpdateQuantity = 0;\n      this.stockUpdateReason = '';\n    },\n\n    async submitStockUpdate() {\n      // Validate required fields\n      if (!this.selectedItem || !this.selectedItem.id) {\n        alert('No item selected');\n        return;\n      }\n\n      if (!this.stockUpdateAction) {\n        alert('Please select an action');\n        return;\n      }\n\n      try {\n        let requestBody = {};\n        \n        // Handle different action types\n        if (this.stockUpdateAction === 'disabled') {\n          // For disabled, set quantity to 0 and use 'set' action\n          requestBody = {\n            action: 'set',\n            quantity: 0,\n            reason: this.stockUpdateReason || 'Disabled - Out of Stock'\n          };\n        } else if (this.stockUpdateAction === 'enabled') {\n          // For enabled, set a special value to indicate unlimited\n          requestBody = {\n            action: 'set',\n            quantity: 999999, // Very large number to represent unlimited\n            reason: this.stockUpdateReason || 'Enabled - Unlimited Orders'\n          };\n        } else {\n          // For regular actions (add, subtract, set)\n          if (!this.stockUpdateQuantity || this.stockUpdateQuantity <= 0) {\n            alert('Please enter a valid quantity (greater than 0)');\n            return;\n          }\n\n          // Additional validation for subtract action\n          if (this.stockUpdateAction === 'subtract' && this.stockUpdateQuantity > this.selectedItem.quantity) {\n            alert('Cannot remove more than current stock');\n            return;\n          }\n          \n          requestBody = {\n            action: this.stockUpdateAction,\n            quantity: parseInt(this.stockUpdateQuantity),\n            reason: this.stockUpdateReason || 'Stock update'\n          };\n        }\n\n        console.log('Sending request:', requestBody);\n\n        const response = await fetch(`http://localhost:8000/api/stocks/${this.selectedItem.id}/update`, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(requestBody)\n        });\n\n        const data = await response.json();\n        \n        if (!response.ok) {\n          throw new Error(data.detail || 'Failed to update stock');\n        }\n\n        if (data.success) {\n          alert('Stock updated successfully!');\n          this.closeStockUpdateModal();\n          await this.fetchStockItems(); // Refresh the stock list\n        } else {\n          throw new Error(data.message || 'Failed to update stock');\n        }\n      } catch (error) {\n        console.error('Error updating stock:', error);\n        alert(error.message || 'Failed to update stock. Please try again.');\n      }\n    },\n\n    initWebSocket() {\n      // Use the same host as the API\n      const wsUrl = `ws://${window.location.hostname}:8000/ws/orders`;\n      \n      // Close existing connection if it exists\n      if (this.ws) {\n        try {\n          this.ws.close();\n        } catch (e) {\n          console.error(\"Error closing existing WebSocket:\", e);\n        }\n      }\n      \n      console.log('Initializing WebSocket connection...');\n      this.ws = new WebSocket(wsUrl);\n      \n      this.ws.onopen = () => {\n        console.log('WebSocket connected');\n        this.wsConnected = true;\n        \n        // Set up a periodic ping to keep the connection alive\n        if (this.pingInterval) clearInterval(this.pingInterval);\n        this.pingInterval = setInterval(() => {\n          if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n            this.ws.send(JSON.stringify({ type: 'ping' }));\n          }\n        }, 30000); // ping every 30 seconds\n      };\n      \n      this.ws.onmessage = async (event) => {\n        try {\n          const data = JSON.parse(event.data);\n          console.log('WebSocket message received:', data);\n\n          if (data.type === 'new_order') {\n            // Handle new order\n            if (data.order.status === 'pending') {\n              // Add the new order to the orders array\n              this.orders.push(data.order);\n              \n              // Re-sort the orders array by ID in ascending order\n              this.orders.sort((a, b) => {\n                const idA = parseInt(a.id);\n                const idB = parseInt(b.id);\n                return idA - idB; // Sort in ascending order (lower IDs first)\n              });\n            }\n          } else if (data.type === 'order_status_update') {\n            // Handle order status update\n            if (data.status !== 'pending') {\n              this.orders = this.orders.filter(order => order.id !== data.order_id);\n              \n              // Remove from orderReadyStatus if it exists\n              if (this.orderReadyStatus[data.order_id]) {\n                delete this.orderReadyStatus[data.order_id];\n                // Update localStorage\n                localStorage.setItem('orderReadyStatus', JSON.stringify(this.orderReadyStatus));\n              }\n            }\n          } else if (data.type === 'admin_notification') {\n            // Handle customer responses to order adjustments\n            if (data.action === 'adjustment_response') {\n              // Process the customer's response to an order adjustment\n              const notification = data.notification;\n              const orderId = notification.orderId;\n              \n              if (notification.message.includes('APPROVED')) {\n                // Find the order and update it with adjusted items\n                const orderIndex = this.orders.findIndex(o => o.id === orderId);\n                if (orderIndex !== -1) {\n                  // Update the order with the adjusted items and remove pending approval flag\n                  const updatedOrder = {\n                    ...this.orders[orderIndex],\n                    items: notification.items,\n                    isPendingApproval: false // Remove the pending approval flag\n                  };\n                  \n                  // Update using Vue 3 reactivity \n                  this.orders = [\n                    ...this.orders.slice(0, orderIndex),\n                    updatedOrder,\n                    ...this.orders.slice(orderIndex + 1)\n                  ];\n                  \n                  // Show success notification\n                  this.notificationMessage = `Customer has approved order adjustments for Order #${orderId}`;\n                  this.notificationClass = \"open-notification\";\n                  this.showNotification();\n                }\n              } else if (notification.message.includes('DECLINED')) {\n                // Remove the order from the list if customer declined\n                this.orders = this.orders.filter(o => o.id !== orderId);\n                \n                // Show declined notification\n                this.notificationMessage = `Customer has declined order adjustments for Order #${orderId}`;\n                this.notificationClass = \"closed-notification\";\n                this.showNotification();\n              }\n              \n              // Mark the notification as processed\n              notification.processed = true;\n              \n              // Update the notification in localStorage\n              const adminNotificationsKey = 'user_notifications_Admin';\n              let adminNotifications = JSON.parse(localStorage.getItem(adminNotificationsKey)) || [];\n              \n              // Find and update the processed notification\n              const notificationIndex = adminNotifications.findIndex(n => \n                n.isAdminNotification && n.orderId === orderId && !n.processed\n              );\n              \n              if (notificationIndex !== -1) {\n                adminNotifications[notificationIndex].processed = true;\n                localStorage.setItem(adminNotificationsKey, JSON.stringify(adminNotifications));\n              }\n            }\n          } else if (data.type === 'customer_approval') {\n            // Direct customer approval handling for real-time updates\n            const { orderId, approved } = data;\n            \n            if (approved) {\n              console.log(`CRITICAL FIX: Customer approved order #${orderId} - handling the single-order case specially`);\n              \n              // Check if this is the single-order case (the problematic case)\n              const isSingleOrder = this.orders.length === 1;\n              \n              // Always try direct DOM manipulation first\n              try {\n                const orderElement = document.querySelector(`.order-item[data-order-id=\"${orderId}\"]`);\n                if (orderElement) {\n                  console.log(\"Found order element in DOM, applying direct DOM updates\");\n                  \n                  // Remove the pending approval class and add all styling inline\n                  orderElement.classList.remove('order-pending-approval');\n                  orderElement.style.backgroundColor = \"#ffffff\";\n                  orderElement.style.border = \"2px solid #ddd\";\n                  orderElement.style.boxShadow = \"0 2px 5px rgba(0, 0, 0, 0.1)\";\n                  \n                  // Hide the PENDING APPROVAL label\n                  const style = document.createElement('style');\n                  style.id = `fix-order-${orderId}`;\n                  style.textContent = `\n                    .order-item[data-order-id=\"${orderId}\"]::before {\n                      display: none !important;\n                    }\n                    .order-item[data-order-id=\"${orderId}\"] h3 {\n                      color: #333 !important;\n                    }\n                    .order-item[data-order-id=\"${orderId}\"] .order-total {\n                      color: #333 !important;\n                    }\n                  `;\n                  document.head.appendChild(style);\n                  \n                  // Update the status text\n                  const statusParagraphs = orderElement.querySelectorAll('p');\n                  for (const paragraph of statusParagraphs) {\n                    if (paragraph.innerHTML.includes('Status:')) {\n                      paragraph.innerHTML = '<strong>Status:</strong> pending';\n                      break;\n                    }\n                  }\n                }\n                \n                // For the single-order case, recreate the entire orders container\n                if (isSingleOrder) {\n                  console.log(\"Single order detected - using special handling\");\n                  \n                  // 1. Get the order container\n                  const ordersContainer = document.querySelector('.orders-container');\n                  if (!ordersContainer) {\n                    console.error(\"Orders container not found\");\n                    return;\n                  }\n                  \n                  // 2. Find the order in our data\n                  const order = this.orders.find(o => o.id === orderId);\n                  if (!order) {\n                    console.error(\"Order not found in data\");\n                    return;\n                  }\n                  \n                  // 3. Create an updated version of the order without pending approval\n                  const updatedOrder = { ...order, isPendingApproval: false };\n                  \n                  // 4. Replace the entire orders list HTML\n                  const ordersList = ordersContainer.querySelector('.orders-list');\n                  if (!ordersList) {\n                    console.error(\"Orders list not found\");\n                    return;\n                  }\n                  \n                  // Create a new order item element \n                  const newOrderItemHTML = `\n                    <div class=\"order-item\" data-order-id=\"${updatedOrder.id}\">\n                      <div class=\"order-details\">\n                        <h3>Order ID: ${updatedOrder.id}</h3>\n                        <p><strong>Customer:</strong> ${updatedOrder.customer_name}</p>\n                        <p><strong>Status:</strong> ${updatedOrder.status}</p>\n                        <p><strong>Time Order:</strong> ${this.timeAgo(updatedOrder.created_at)}</p>\n                        \n                        <div class=\"items-section\">\n                          <strong>Items:</strong>\n                          <ul>\n                            ${updatedOrder.items.map(item => \n                              `<li>${item.name} - ‚Ç±${item.price} x ${item.quantity}</li>`\n                            ).join('')}\n                          </ul>\n                        </div>\n                        \n                        <div class=\"order-total\">\n                          <p><strong>Total Amount: ‚Ç±${this.calculateOrderTotal(updatedOrder.items)}</strong></p>\n                        </div>\n                      </div>\n                      \n                      <div class=\"order-actions\">\n                        <button \n                          onclick=\"document.dispatchEvent(new CustomEvent('completion-confirmation', {detail: {orderId: ${updatedOrder.id}}}))\"\n                          class=\"mark-completed-btn small-btn ${!this.orderReadyStatus[updatedOrder.id] ? 'disabled' : ''}\"\n                          ${!this.orderReadyStatus[updatedOrder.id] ? 'disabled' : ''}\n                        >\n                          Mark as Completed\n                        </button>\n                        \n                        <button \n                          onclick=\"document.dispatchEvent(new CustomEvent('order-ready', {detail: {orderId: ${updatedOrder.id}, customerName: '${updatedOrder.customer_name}'}}))\"\n                          class=\"order-ready-btn small-btn\"\n                        >\n                          Order Ready üîî\n                        </button>\n                        \n                        <button \n                          onclick=\"document.dispatchEvent(new CustomEvent('decline-dialog', {detail: {orderId: ${updatedOrder.id}}}))\"\n                          class=\"decline-btn\"\n                        >\n                          Decline\n                        </button>\n                      </div>\n                    </div>\n                  `;\n                  \n                  // Replace the content\n                  ordersList.innerHTML = newOrderItemHTML;\n                  \n                  // Setup event listeners for our custom events\n                  if (!this._customListenersAdded) {\n                    document.addEventListener('completion-confirmation', (e) => {\n                      this.showCompletionConfirmation(e.detail.orderId);\n                    });\n                    \n                    document.addEventListener('order-ready', (e) => {\n                      this.sendOrderReadyNotification(e.detail.orderId, e.detail.customerName, updatedOrder.items);\n                    });\n                    \n                    document.addEventListener('decline-dialog', (e) => {\n                      // Find the order again since we need the full object\n                      const order = this.orders.find(o => o.id === e.detail.orderId);\n                      if (order) {\n                        this.openDeclineDialog(order);\n                      }\n                    });\n                    \n                    this._customListenersAdded = true;\n                  }\n                  \n                  // Also update our Vue data model\n                  this.orders = [updatedOrder];\n                }\n              } catch (error) {\n                console.error(\"Error during direct DOM manipulation:\", error);\n              }\n              \n              // Always show notification to admin\n              this.notificationMessage = `The customer has APPROVED the order adjustments. Order ID: ${orderId}`;\n              this.notificationClass = \"open-notification\";\n              this.showNotification();\n              \n              // Update the database in the background\n              fetch(`http://127.0.0.1:8000/orders/${orderId}/update-items`, {\n                method: \"PUT\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({\n                  status: \"pending\",\n                  isPendingApproval: false\n                })\n              })\n              .then(response => response.json())\n              .then(data => {\n                console.log(\"Database updated to reflect customer approval:\", data);\n                \n                // Always fetch all orders as a fallback\n                setTimeout(() => {\n                  this.fetchPendingOrders();\n                }, 1000);\n              })\n              .catch(err => {\n                console.error(\"Error updating database after customer approval:\", err);\n                \n                // Force reload as last resort for error cases\n                if (isSingleOrder) {\n                  setTimeout(() => location.reload(), 1000);\n                }\n              });\n            } else {\n              // If declined, handle in Vue since that part seems to work\n              this.orders = this.orders.filter(o => o.id !== orderId);\n              \n              // Show notification about the decline\n              this.notificationMessage = `Customer has declined order adjustments for Order #${orderId}`;\n              this.notificationClass = \"closed-notification\";\n              this.showNotification();\n            }\n          } else if (data.type === 'stock_update') {\n            // Handle stock update\n            const stockItem = this.stockItems.find(item => item.id === data.item_id);\n            if (stockItem) {\n              stockItem.quantity = data.new_quantity;\n              stockItem.min_stock_level = data.min_stock_level;\n              \n              // Update unique categories if needed\n              if (!this.uniqueCategories.includes(data.category)) {\n                this.uniqueCategories.push(data.category);\n              }\n            }\n            // Refresh stock items to ensure all data is up to date\n            await this.fetchStockItems();\n          } else if (data.type === 'menu_update') {\n            // Handle menu updates (new items, edited items, or deleted items)\n            await this.fetchStockItems(); // Refresh stock items when menu changes\n          } else if (data.type === 'category_update') {\n            // Handle category updates\n            await this.fetchStockItems(); // Refresh stock items when categories change\n            \n            // Update unique categories list\n            if (data.action === 'add' && data.category && data.category.name) {\n              if (!this.uniqueCategories.includes(data.category.name)) {\n                this.uniqueCategories.push(data.category.name);\n              }\n            } else if (data.action === 'update' && data.category) {\n              // Replace old category name with new one\n              const index = this.uniqueCategories.indexOf(data.category.old_name);\n              if (index !== -1) {\n                this.uniqueCategories[index] = data.category.name;\n              } else if (!this.uniqueCategories.includes(data.category.name)) {\n                this.uniqueCategories.push(data.category.name);\n              }\n              \n              // Update selected category if it was renamed\n              if (this.selectedCategory === data.category.old_name) {\n                this.selectedCategory = data.category.name;\n              }\n            } else if (data.action === 'delete' && data.category_name) {\n              // Remove deleted category\n              this.uniqueCategories = this.uniqueCategories.filter(cat => cat !== data.category_name);\n              \n              // Reset selected category if it was deleted\n              if (this.selectedCategory === data.category_name) {\n                this.selectedCategory = '';\n              }\n            }\n          }\n        } catch (error) {\n          console.error('Error processing WebSocket message:', error);\n        }\n      };\n      \n      this.ws.onclose = () => {\n        console.log('WebSocket disconnected');\n        this.wsConnected = false;\n        // Try to reconnect after 5 seconds\n        setTimeout(() => {\n          this.initWebSocket();\n        }, 5000);\n      };\n      \n      this.ws.onerror = (error) => {\n        console.error('WebSocket error:', error);\n        this.wsConnected = false;\n      };\n    },\n\n    // Handle localStorage changes for admin notifications\n    handleStorageEvent(event) {\n      // Check if the storage event is for admin notifications\n      if (event.key === 'user_notifications_Admin') {\n        // Process new admin notifications\n        this.processAdminNotifications();\n      }\n    },\n    \n    // Process admin notifications from localStorage\n    processAdminNotifications() {\n      // Get admin notifications \n      const adminNotificationsKey = 'user_notifications_Admin';\n      const adminNotifications = JSON.parse(localStorage.getItem(adminNotificationsKey)) || [];\n      \n      // Check for unprocessed customer response notifications\n      const unprocessedNotifications = adminNotifications.filter(n => \n        n.isAdminNotification && \n        (n.message.includes('APPROVED') || n.message.includes('DECLINED')) && \n        !n.processed\n      );\n      \n      // Process each notification\n      unprocessedNotifications.forEach(notification => {\n        const orderId = notification.orderId;\n        \n        if (notification.message.includes('APPROVED')) {\n          // If customer approved adjustments\n          // Find the order and update it\n          const orderIndex = this.orders.findIndex(o => o.id === orderId);\n          \n          if (orderIndex !== -1) {\n            // Update the order with adjusted items\n            this.orders[orderIndex].items = notification.items;\n            \n            // Mark the notification as processed\n            notification.processed = true;\n          }\n        } else if (notification.message.includes('DECLINED')) {\n          // If customer declined, remove the order\n          this.orders = this.orders.filter(o => o.id !== orderId);\n          \n          // Mark the notification as processed\n          notification.processed = true;\n        }\n      });\n      \n      // Update the processed notifications in localStorage\n      localStorage.setItem(adminNotificationsKey, JSON.stringify(adminNotifications));\n      \n      // Show notification to admin about the response\n      if (unprocessedNotifications.length > 0) {\n        const lastNotification = unprocessedNotifications[unprocessedNotifications.length - 1];\n        this.notificationMessage = lastNotification.message;\n        this.notificationClass = lastNotification.message.includes('APPROVED') ? \n          'open-notification' : 'closed-notification';\n        this.showNotification();\n      }\n    },\n    \n    // Fetch pending orders - wrapper for fetchOrders for consistency\n    fetchPendingOrders() {\n      this.fetchOrders();\n    },\n    \n    // Connect to WebSocket - renamed from initWebSocket for consistency\n    connectWebSocket() {\n      this.initWebSocket();\n    },\n\n    // Add this method to force refresh orders after WebSocket updates\n    forceRefreshOrder(orderId) {\n      console.log(`Forcing refresh for order #${orderId}, current orders count: ${this.orders.length}`);\n      \n      // Find the order that needs refreshing\n      const orderIndex = this.orders.findIndex(o => o.id === orderId);\n      \n      if (orderIndex !== -1) {\n        // Fetch the latest order data from the server to ensure it's up to date\n        fetch(`http://127.0.0.1:8000/orders/${orderId}`)\n          .then(response => response.json())\n          .then(data => {\n            if (data) {\n              console.log('Fetched fresh order data for real-time update:', data);\n              \n              // Create a fresh order object with the latest data\n              const updatedOrder = {\n                ...data,\n                isPendingApproval: data.isPendingApproval || false // Ensure the flag is set correctly\n              };\n              \n              // Special handling for single order\n              if (this.orders.length === 1) {\n                this.orders = [updatedOrder];\n              } else {\n                // Replace the order in the array using Vue reactivity\n                this.orders = [\n                  ...this.orders.slice(0, orderIndex),\n                  updatedOrder,\n                  ...this.orders.slice(orderIndex + 1)\n                ];\n              }\n              \n              // Force the component to re-render\n              this.$forceUpdate();\n              \n              console.log('Order updated successfully in UI:', updatedOrder);\n              \n              // If order is approved but UI doesn't update, try refreshing all orders\n              if (!updatedOrder.isPendingApproval) {\n                setTimeout(() => {\n                  this.fetchPendingOrders();\n                }, 300);\n              }\n            }\n          })\n          .catch(error => {\n            console.error('Error refreshing order:', error);\n            // Fallback to refreshing all orders on error\n            this.fetchPendingOrders();\n          });\n      } else {\n        console.log(`Order #${orderId} not found in current orders, refreshing all orders`);\n        // If the order isn't found in the current array, refresh all orders\n        this.fetchPendingOrders();\n      }\n    },\n\n    // Add direct DOM manipulation method to fix pending approval status when reactivity fails\n    forceFixPendingUI(orderId) {\n      console.log(`CRITICAL FIX: Using direct DOM manipulation to fix UI for order #${orderId}`);\n      \n      try {\n        // Find the order element\n        const orderElement = document.querySelector(`.order-item[data-order-id=\"${orderId}\"]`);\n        if (!orderElement) {\n          console.log(\"Order element not found for direct fix\");\n          return false;\n        }\n        \n        // Remove the critical class that causes the red border\n        orderElement.classList.remove('order-pending-approval');\n        \n        // Add a success indicator class\n        orderElement.classList.add('order-approved-success');\n        \n        // Find and update status text\n        const statusParagraphs = orderElement.querySelectorAll('p');\n        for (const paragraph of statusParagraphs) {\n          if (paragraph.textContent.includes(\"Status:\")) {\n            paragraph.innerHTML = '<strong>Status:</strong> pending';\n            console.log('Updated status text');\n          }\n        }\n        \n        // Remove the \"PENDING APPROVAL\" label\n        // Create a specific style for this order element\n        const styleId = `order-${orderId}-fix`;\n        let styleElement = document.getElementById(styleId);\n        \n        if (!styleElement) {\n          styleElement = document.createElement('style');\n          styleElement.id = styleId;\n          document.head.appendChild(styleElement);\n        }\n        \n        styleElement.textContent = `\n          .order-item[data-order-id=\"${orderId}\"]::before {\n            display: none !important;\n          }\n          .order-item[data-order-id=\"${orderId}\"].order-pending-approval {\n            background-color: #ffffff !important;\n            border: 2px solid #ddd !important;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1) !important;\n          }\n          .order-item[data-order-id=\"${orderId}\"] h3 {\n            color: #333 !important;\n          }\n          .order-item[data-order-id=\"${orderId}\"] .order-total {\n            color: #333 !important;\n          }\n          .order-approved-success {\n            animation: successPulse 1s;\n          }\n          @keyframes successPulse {\n            0% { background-color: #e6ffe6; }\n            50% { background-color: #ccffcc; }\n            100% { background-color: #ffffff; }\n          }\n        `;\n        \n        console.log(\"Direct DOM manipulation complete - critical CSS override applied\");\n        return true;\n      } catch (error) {\n        console.error(\"Error during direct DOM manipulation:\", error);\n        return false;\n      }\n    },\n\n    // Completely bypass Vue for this critical update\n    handleApprovalBypassVue(orderId) {\n      // Force a direct manipulation of the DOM \n      const fixed = this.forceFixPendingUI(orderId);\n      \n      // If direct manipulation succeeded, set a flag to prevent further attempts\n      if (fixed) {\n        // Store fixed orders in localStorage to avoid repeated fixes\n        const fixedOrders = JSON.parse(localStorage.getItem('fixedApprovedOrders') || '[]');\n        if (!fixedOrders.includes(orderId)) {\n          fixedOrders.push(orderId);\n          localStorage.setItem('fixedApprovedOrders', JSON.stringify(fixedOrders));\n        }\n        \n        // Show feedback to admin\n        this.notificationMessage = `The customer has APPROVED the order adjustments. Order ID: ${orderId}`;\n        this.notificationClass = \"open-notification\";\n        this.showNotification();\n      }\n      \n      // Force refresh orders after a short delay\n      setTimeout(() => {\n        this.fetchPendingOrders();\n      }, 1000);\n    },\n  },\n\n  mounted() {\n    this.fetchPendingOrders();\n    // Set up automatic refresh every 60 seconds\n    this.refreshInterval = setInterval(() => {\n      this.fetchPendingOrders();\n    }, 60000);\n    \n    // Check localStorage for cafe status\n    const storedCafeStatus = localStorage.getItem('isCafeOpen');\n    if (storedCafeStatus !== null) {\n      this.isCafeOpen = storedCafeStatus === 'true';\n    }\n    \n    // Load orderReadyStatus from localStorage if available\n    const savedOrderReadyStatus = localStorage.getItem('orderReadyStatus');\n    if (savedOrderReadyStatus) {\n      this.orderReadyStatus = JSON.parse(savedOrderReadyStatus);\n    }\n    \n    // Event listener for customer approval/decline responses\n    window.addEventListener('storage', this.handleStorageEvent);\n    \n    // Connect to WebSocket\n    this.connectWebSocket();\n    \n    // Add a global document event listener for a custom event we'll dispatch on customer approval\n    document.addEventListener('customer-approval', (event) => {\n      if (event.detail && event.detail.orderId) {\n        console.log('Got customer-approval event at document level:', event.detail);\n        this.handleApprovalBypassVue(event.detail.orderId);\n      }\n    });\n    \n    // Dispatch a custom approval event if we have any approvals stored in localStorage\n    // This helps sync UI state on page load\n    const fixedOrders = JSON.parse(localStorage.getItem('fixedApprovedOrders') || '[]');\n    fixedOrders.forEach(orderId => {\n      setTimeout(() => {\n        const orderElement = document.querySelector(`.order-item[data-order-id=\"${orderId}\"].order-pending-approval`);\n        if (orderElement) {\n          console.log(`Found previously fixed order #${orderId} still showing pending, re-fixing`);\n          this.forceFixPendingUI(orderId);\n        }\n      }, 1000);\n    });\n  },\n\n  beforeUnmount() {\n    if (this.refreshInterval) {\n      clearInterval(this.refreshInterval);\n    }\n    \n    if (this.pingInterval) {\n      clearInterval(this.pingInterval);\n    }\n    \n    if (this.ws) {\n      this.ws.close();\n    }\n    \n    // Remove event listeners\n    window.removeEventListener('storage', this.handleStorageEvent);\n    document.removeEventListener('customer-approval', this.handleApprovalBypassVue);\n  }\n};\n</script>\n\n<style scoped>\n/* Base styles for all screen sizes */\n.notifications-page {\n  height: 100vh;\n  display: flex;\n  background-color: #ffffff;\n}\n\n/* Top Bar Styles to match dashboard */\n.top-bar {\n  display: flex;\n  align-items: center;\n  background-image: linear-gradient(to right, #E54F70, #ed9598);\n  padding: 0 15px;\n  height: 60px;\n  width: 100%;\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  z-index: 100;\n}\n\n.content.shifted .top-bar {\n  left: 300px; /* Adjust left position when sidebar is open */\n  width: calc(100% - 300px); /* Adjust width when sidebar is open */\n}\n\n.content-below-top-bar {\n  margin-top: 70px; /* Add margin to account for the fixed top bar */\n  padding: 10px 20px;\n}\n\n.centered-content {\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  padding: 0 0 0 5px; /* Reduce left padding to move button closer to edge */\n  height: 100%;\n}\n\n.logo-container {\n  display: flex;\n  align-items: center;\n}\n\n.cafe-title {\n  color: white;\n  font-weight: bold;\n  font-size: 20px;\n  white-space: nowrap;\n}\n\n/* Menu Button */\n.menu-button {\n  position: fixed;\n  top: 15px;\n  left: 15px;\n  z-index: 300;\n  background: #d12f7a;\n  color: white;\n  padding: 12px 15px;\n  font-size: 20px;\n  border: none;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.3s ease-in-out;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n  display: none; /* Hide the floating button */\n}\n\n.menu-button:hover {\n  background: #b82d67;\n  transform: translateY(-2px);\n  box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);\n}\n\n.menu-icon-container {\n  position: relative;\n  display: inline-block;\n  font-size: 24px;\n}\n\n/* Sidebar */\n.sidebar {\n  position: fixed;\n  top: 0;\n  left: -300px;\n  height: 100vh;\n  width: 300px;\n  background: #f5f5f5;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  z-index: 1000;\n  display: flex;\n  flex-direction: column;\n  padding: 20px 0;\n  box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);\n  color: #333;\n}\n\n.sidebar.open {\n  left: 0;\n}\n\n.close-sidebar {\n  position: absolute;\n  top: 15px;\n  right: 15px;\n  background: rgba(209, 47, 122, 0.1);\n  border: none;\n  font-size: 20px;\n  cursor: pointer;\n  color: #d12f7a;\n  padding: 8px 12px;\n  border-radius: 50%;\n  transition: all 0.3s ease;\n}\n\n.close-sidebar:hover {\n  background: rgba(209, 47, 122, 0.2);\n  transform: rotate(90deg);\n}\n\n/* User Profile Section */\n.user-profile-section {\n  padding: 30px 20px;\n  text-align: center;\n  margin-bottom: 20px;\n  background: rgba(209, 47, 122, 0.1);\n  border-radius: 15px;\n  margin: 0 15px 20px;\n}\n\n.user-profile-section h3 {\n  color: #d12f7a;\n  margin: 0;\n  font-size: 28px;\n  font-weight: 600;\n  text-shadow: none;\n}\n\n/* Utility Section */\n.utility-section {\n  padding: 15px;\n  margin: 0 15px;\n  background: white;\n  border-radius: 15px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n}\n\n.utility-button {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 14px 20px;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  color: #333;\n  font-size: 16px;\n  text-decoration: none;\n  transition: all 0.3s ease;\n  border-radius: 10px;\n  margin-bottom: 8px;\n  position: relative;\n  overflow: hidden;\n}\n\n.utility-button:last-child {\n  margin-bottom: 0;\n}\n\n.utility-button:hover {\n  background: rgba(209, 47, 122, 0.1);\n  transform: translateX(5px);\n}\n\n.utility-button i {\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #d12f7a;\n  border-radius: 8px;\n  font-size: 16px;\n  color: white;\n  transition: all 0.3s ease;\n}\n\n.utility-button:hover i {\n  transform: rotate(10deg);\n}\n\n.utility-button span {\n  font-weight: 500;\n}\n\n.utility-button.logout {\n  background: rgba(244, 67, 54, 0.1);\n  color: #f44336;\n  margin-top: 8px;\n  border-top: 1px solid rgba(0, 0, 0, 0.05);\n}\n\n.utility-button.logout i {\n  background: #f44336;\n}\n\n.utility-button.logout:hover {\n  background: rgba(244, 67, 54, 0.15);\n}\n\n/* Cafe Status Section */\n.cafe-status-section {\n  padding: 20px;\n  display: flex;\n  justify-content: center;\n  margin-top: 20px;\n}\n\n.cafe-toggle-btn {\n  font-size: 16px;\n  padding: 12px 24px;\n  border: 2px solid #d12f7a;\n  cursor: pointer;\n  border-radius: 30px;\n  transition: all 0.3s ease;\n  font-weight: 600;\n  width: 100%;\n  background: white;\n  color: #d12f7a;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n}\n\n.cafe-toggle-btn::before {\n  content: 'üè™';\n  font-size: 20px;\n}\n\n.cafe-toggle-btn:hover {\n  background: rgba(209, 47, 122, 0.1);\n  transform: translateY(-2px);\n}\n\n.cafe-toggle-btn.open-btn {\n  border-color: #4CAF50;\n  color: #4CAF50;\n}\n\n.cafe-toggle-btn.open-btn::before {\n  content: '‚úÖ';\n}\n\n.cafe-toggle-btn.closed-btn {\n  border-color: #f44336;\n  color: #f44336;\n}\n\n.cafe-toggle-btn.closed-btn::before {\n  content: 'üö´';\n}\n\n/* Utility Divider */\n.utility-divider {\n  border: none;\n  height: 1px;\n  background: rgba(0, 0, 0, 0.1);\n  margin: 15px;\n  border-radius: 1px;\n}\n\n/* Main Content Area */\n.content {\n  flex: 1;\n  margin-left: 0;\n  padding: 20px;\n  transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.content.shifted {\n  margin-left: 300px;\n}\n\n/* Overlay */\n.overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  z-index: 999;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n\n.overlay.visible {\n  opacity: 1;\n}\n\n/* Search Bar */\n.search-bar {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 20px auto;\n  width: 90%;\n  max-width: 400px;\n  background-color: transparent;\n  border-radius: 30px;\n  border: 2px solid #d12f7a;\n}\n\n.search-input {\n  width: 100%;\n  padding: 10px 15px;\n  font-size: 16px;\n  border: none;\n  outline: none;\n  background-color: transparent;\n  color: #333;\n  border-radius: 30px;\n}\n\n/* Orders Container */\n.orders-container {\n  width: 100%;\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\n.orders-container h2 {\n  text-align: center;\n  color: #d12f7a;\n  margin-bottom: 20px;\n}\n\n.orders-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n  gap: 20px;\n  width: 100%;\n}\n\n/* Order Item */\n.order-item {\n  background-color: #f8d2e4;\n  padding: 15px;\n  border-radius: 8px;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  height: auto;\n  transition: all 0.3s ease-in-out;\n}\n\n.order-item:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);\n}\n\n.order-details h3 {\n  color: #d12f7a;\n  margin-top: 0;\n}\n\n.order-details p {\n  margin: 5px 0;\n}\n\n.items-section {\n  margin-top: 15px; \n  flex-grow: 1; /* Allow the items section to expand and adapt */\n}\n\n.order-actions {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  margin-top: 15px;\n}\n\nul {\n  list-style-type: none;\n  padding-left: 20px;\n  margin: 0;\n}\n\n.order-total {\n  margin-top: 10px;\n  font-weight: bold;\n  color: #d12f7a;\n  text-align: center; /* Ensure it aligns nicely with the rest of the content */\n}\n\n/* Button styles */\nbutton.mark-completed-btn {\n  background-color: #d12f7a;\n  color: white;\n  border: none;\n  padding: 8px 10px;\n  border-radius: 5px;\n  cursor: pointer;\n  width: 100%;\n  transition: all 0.3s ease;\n}\n\nbutton.mark-completed-btn:disabled,\nbutton.mark-completed-btn.disabled {\n  background-color: #cccccc;\n  cursor: not-allowed;\n  opacity: 0.7;\n}\n\nbutton.mark-completed-btn:not(:disabled):hover {\n  background-color: #b82d67;\n}\n\n.order-ready-btn {\n  background-color: #4caf50; /* Green background for success */\n  color: white; /* White text */\n  padding: 8px 10px;\n  font-size: 14px;\n  border: none;\n  border-radius: 5px; /* Rounded corners */\n  cursor: pointer;\n  width: 100%;\n  transition: background-color 0.3s ease, transform 0.3s ease;\n}\n\n.order-ready-btn:hover {\n  background-color: #45a049; /* Slightly darker green when hovered */\n  transform: translateY(-2px); /* Slight upward movement on hover */\n}\n\n.order-ready-btn:active {\n  background-color: #388e3c; /* Even darker green when clicked */\n  transform: translateY(0); /* Reset the movement after click */\n}\n\nbutton.decline-btn {\n  background-color: #f5a5a5;\n  color: white;\n  border: none;\n  padding: 8px 10px;\n  border-radius: 5px;\n  cursor: pointer;\n  width: 100%;\n}\n\nbutton.decline-btn:hover {\n  background-color: #f17b7b;\n}\n\n/* Notification styles */\n.notification-popup,\n.notification-sent-popup {\n  position: fixed;\n  top: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  padding: 15px 30px;\n  border-radius: 8px;\n  box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);\n  font-size: 18px;\n  min-width: 200px;\n  max-width: 90%;\n  z-index: 1000;\n  transition: opacity 0.3s ease, transform 0.3s ease;\n  opacity: 1;\n  text-align: center;\n}\n\n.notification-sent-popup {\n  background-color: rgb(82, 13, 45);\n  color: white;\n}\n\n.notification-popup.hide {\n  opacity: 0;\n  transform: translateX(-50%) translateY(-20px);\n}\n\n.notification-popup button,\n.notification-sent-popup button {\n  background-color: #fff;\n  color: #007bff;\n  border: none;\n  padding: 5px 10px;\n  border-radius: 3px;\n  cursor: pointer;\n  margin-left: 10px;\n  font-size: 14px;\n}\n\n.notification-popup button:hover,\n.notification-sent-popup button:hover {\n  background-color: #f1f1f1;\n}\n\n.notification-popup.open-notification {\n  background-color: #4caf50;\n  color: white;\n}\n\n.notification-popup.closed-notification {\n  background-color: red;\n  color: white;\n}\n\n.highlighted-order-details {\n  display: inline-block;\n  background-color: #f8d2e4;\n  color: #d12f7a;\n  padding: 10px;\n  border-radius: 5px;\n  margin-top: 10px;\n  font-weight: bold;\n  border: 2px solid #d12f7a;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n  width: 100%;\n  text-align: center;\n  box-sizing: border-box;\n}\n\n.highlighted-order-details::before {\n  content: \"‚Äî‚Äî‚Äî \";\n  font-size: 24px;\n  font-weight: bold;\n  color: #d12f7a;\n}\n\n.loading {\n  text-align: center;\n  color: #d12f7a;\n  font-size: 20px;\n  margin-top: 20px;\n}\n\n.no-orders {\n  text-align: center;\n  margin: 30px 0;\n}\n\n.highlighted-time {\n  color: #d12f7a;\n  font-weight: bold;\n}\n\n.dark-mode .highlighted-time {\n  color: #f8d2e4;\n}\n\n.section-divider {\n  border-top: 1px solid #ddd;\n  margin: 30px 0;\n}\n\n/* Media Queries for Responsive Design */\n@media (max-width: 768px) {\n  .header {\n    flex-direction: column;\n    align-items: center;\n    gap: 15px;\n  }\n  \n  .header-buttons {\n    order: 3;\n    width: 100%;\n    justify-content: center;\n  }\n  \n  h1 {\n    order: 1;\n    width: 100%;\n  }\n  \n  .order-record-button {\n    order: 2;\n    width: 100%;\n    max-width: 200px;\n  }\n  \n  .logout-button {\n    order: 4;\n    width: 100%;\n    max-width: 200px;\n  }\n  \n  .orders-list {\n    grid-template-columns: 1fr;\n  }\n}\n\n@media (max-width: 480px) {\n  .notifications-page {\n    padding: 10px;\n  }\n  \n  .cafe-toggle-btn {\n    width: 180px;\n    font-size: 14px;\n  }\n  \n  .notification-popup,\n  .notification-sent-popup {\n    font-size: 16px;\n    padding: 10px 20px;\n  }\n  \n  .order-item {\n    padding: 12px;\n  }\n  \n  .decline-container {\n    padding: 10px;\n  }\n  \n  .decline-buttons {\n    flex-direction: column;\n  }\n  \n  .decline-submit-btn,\n  .decline-cancel-btn {\n    width: 100%;\n  }\n}\n\n/* Menu Editor Modal Styles */\n.menu-editor-modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1001;\n  overflow-y: auto;\n}\n\n.menu-editor-content {\n  background-color: white;\n  width: 90%;\n  max-width: 800px;\n  max-height: 90vh;\n  border-radius: 10px;\n  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.menu-editor-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px 20px;\n  background-color: #f8d2e4;\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.menu-editor-header h2 {\n  color: #d12f7a;\n  margin: 0;\n}\n\n.close-modal-btn {\n  background: none;\n  border: none;\n  color: #d12f7a;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 5px;\n}\n\n.close-modal-btn:hover {\n  color: #b82d67;\n}\n\n.menu-editor-body {\n  padding: 20px;\n  overflow-y: auto;\n  max-height: calc(90vh - 70px); /* Subtract header height */\n}\n\n/* Media query adjustments for the modal */\n@media (max-width: 768px) {\n  .menu-editor-content {\n    width: 95%;\n    max-height: 95vh;\n  }\n}\n\n@media (max-width: 480px) {\n  .menu-editor-header {\n    padding: 10px 15px;\n  }\n  \n  .menu-editor-body {\n    padding: 15px;\n  }\n}\n\n/* Completion Confirmation Popup Styles */\n.completion-confirmation-popup {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1002;\n}\n\n.completion-confirmation-content {\n  background-color: white;\n  padding: 25px;\n  border-radius: 10px;\n  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);\n  text-align: center;\n  max-width: 400px;\n  width: 90%;\n}\n\n.completion-confirmation-content h3 {\n  color: #d12f7a;\n  margin-top: 0;\n  margin-bottom: 15px;\n  font-size: 1.5em;\n}\n\n.completion-confirmation-content p {\n  margin-bottom: 20px;\n  font-size: 1.1em;\n  color: #333;\n}\n\n.confirmation-buttons {\n  display: flex;\n  justify-content: center;\n  gap: 15px;\n}\n\n.confirm-yes-btn,\n.confirm-no-btn {\n  padding: 10px 25px;\n  border: none;\n  border-radius: 5px;\n  font-size: 1.1em;\n  cursor: pointer;\n  transition: all 0.3s ease;\n}\n\n.confirm-yes-btn {\n  background-color: #d12f7a;\n  color: white;\n}\n\n.confirm-yes-btn:hover {\n  background-color: #b82d67;\n  transform: translateY(-2px);\n}\n\n.confirm-no-btn {\n  background-color: #f5a5a5;\n  color: white;\n}\n\n.confirm-no-btn:hover {\n  background-color: #f17b7b;\n  transform: translateY(-2px);\n}\n\n/* Media query adjustments for the confirmation popup */\n@media (max-width: 480px) {\n  .completion-confirmation-content {\n    padding: 20px;\n    width: 85%;\n  }\n\n  .confirmation-buttons {\n    flex-direction: column;\n    gap: 10px;\n  }\n\n  .confirm-yes-btn,\n  .confirm-no-btn {\n    width: 100%;\n    padding: 12px;\n  }\n}\n\n/* Stock Management Modal Styles */\n.stock-manager-modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1001;\n}\n\n.stock-manager-content {\n  background-color: white;\n  width: 90%;\n  max-width: 1000px;\n  max-height: 90vh;\n  border-radius: 10px;\n  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);\n  display: flex;\n  flex-direction: column;\n}\n\n.stock-manager-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px 20px;\n  background-color: #f8d2e4;\n  border-top-left-radius: 10px;\n  border-top-right-radius: 10px;\n}\n\n.stock-manager-header h2 {\n  color: #d12f7a;\n  margin: 0;\n}\n\n.stock-manager-body {\n  padding: 20px;\n  overflow-y: auto;\n}\n\n.stock-search-bar {\n  margin-bottom: 20px;\n}\n\n.stock-table-container {\n  overflow-x: auto;\n}\n\n.stock-table {\n  width: 100%;\n  border-collapse: collapse;\n  margin-top: 20px;\n}\n\n.stock-table th,\n.stock-table td {\n  padding: 12px;\n  text-align: left;\n  border-bottom: 1px solid #ddd;\n}\n\n.stock-table th {\n  background-color: #f8d2e4;\n  color: #d12f7a;\n}\n\n.status-out {\n  color: #f44336;\n  font-weight: bold;\n}\n\n.status-low {\n  color: #ff9800;\n  font-weight: bold;\n}\n\n.status-ok {\n  color: #4caf50;\n  font-weight: bold;\n}\n\n.status-disabled {\n  color: #9e9e9e;\n  font-weight: bold;\n}\n\n.status-enabled {\n  color: #2196f3;\n  font-weight: bold;\n}\n\n.action-buttons {\n  display: flex;\n  gap: 10px;\n}\n\n.update-stock-btn {\n  background-color: #d12f7a;\n  color: white;\n  border: none;\n  padding: 8px 16px;\n  border-radius: 20px;\n  cursor: pointer;\n  font-weight: 500;\n  transition: all 0.3s ease;\n  box-shadow: 0 2px 4px rgba(209, 47, 122, 0.2);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n}\n\n.update-stock-btn::before {\n  content: 'üì¶';\n  font-size: 16px;\n}\n\n.update-stock-btn:hover {\n  background-color: #b82d67;\n  transform: translateY(-2px);\n  box-shadow: 0 4px 8px rgba(209, 47, 122, 0.3);\n}\n\n.update-stock-btn:active {\n  transform: translateY(0);\n  box-shadow: 0 2px 4px rgba(209, 47, 122, 0.2);\n}\n\n.stock-update-modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1002;\n}\n\n.stock-update-content {\n  background-color: white;\n  padding: 20px;\n  border-radius: 10px;\n  width: 90%;\n  max-width: 400px;\n}\n\n.stock-update-form {\n  display: flex;\n  flex-direction: column;\n  gap: 15px;\n}\n\n.form-group {\n  display: flex;\n  flex-direction: column;\n  gap: 5px;\n}\n\n.form-group label {\n  font-weight: bold;\n}\n\n.form-group input,\n.form-group select {\n  padding: 8px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n}\n\n.update-buttons {\n  display: flex;\n  gap: 10px;\n  justify-content: flex-end;\n  margin-top: 20px;\n}\n\n.confirm-btn,\n.cancel-btn {\n  padding: 8px 16px;\n  border: none;\n  border-radius: 5px;\n  cursor: pointer;\n}\n\n.confirm-btn {\n  background-color: #d12f7a;\n  color: white;\n}\n\n.cancel-btn {\n  background-color: #f5a5a5;\n  color: white;\n}\n\n.low-stock {\n  color: #ff9800;\n  font-weight: bold;\n}\n\n.out-of-stock {\n  color: #f44336;\n  font-weight: bold;\n}\n\n.stock-filters {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n}\n\n.category-filter {\n  padding: 8px 12px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  font-size: 14px;\n  min-width: 150px;\n  background-color: white;\n  cursor: pointer;\n}\n\n.category-filter:hover {\n  border-color: #d12f7a;\n}\n\n.dark-mode .category-filter {\n  background-color: #333;\n  color: white;\n  border-color: #555;\n}\n\n.dark-mode .category-filter:hover {\n  border-color: #f8c6d0;\n}\n\n/* Add styles for the new header menu button */\n.menu-button-header {\n  background: #d12f7a;\n  color: white;\n  padding: 8px 12px;\n  font-size: 18px;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.3s ease-in-out;\n  margin-right: 15px;\n  margin-left: 0; /* Ensure no left margin */\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.menu-button-header:hover {\n  background: #b82d67;\n}\n\n/* New styles for decline modal and order highlighting */\n.order-declined-state {\n  background-color: #ffe6e6 !important;\n  border: 2px solid #ff0000 !important;\n}\n\n.order-pending-approval {\n  background-color: #ffe6e6 !important;\n  border: 2px solid #ff0000 !important;\n  box-shadow: 0 4px 10px rgba(255, 0, 0, 0.2) !important;\n  position: relative;\n  transition: all 0.5s ease-in-out;\n}\n\n.order-pending-approval::before {\n  content: 'PENDING APPROVAL';\n  position: absolute;\n  top: 0;\n  right: 0;\n  background-color: #ff0000;\n  color: white;\n  font-size: 12px;\n  font-weight: bold;\n  padding: 4px 8px;\n  border-bottom-left-radius: 8px;\n}\n\n.order-pending-approval h3 {\n  color: #ff0000 !important;\n}\n\n.order-pending-approval .order-details p {\n  color: #333 !important;\n}\n\n.order-pending-approval .order-total {\n  color: #ff0000 !important;\n  font-weight: bold;\n}\n\n.decline-modal-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n}\n\n.decline-modal-content {\n  background-color: white;\n  border-radius: 8px;\n  width: 90%;\n  max-width: 600px;\n  max-height: 90vh;\n  overflow-y: auto;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);\n}\n\n.decline-modal-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px 20px;\n  border-bottom: 1px solid #eee;\n  background-color: #f8d2e4;\n}\n\n.decline-modal-header h3 {\n  margin: 0;\n  color: #d12f7a;\n}\n\n.decline-modal-body {\n  padding: 20px;\n}\n\n.form-group {\n  margin-bottom: 20px;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: bold;\n  color: #333;\n}\n\n.form-group textarea {\n  width: 100%;\n  padding: 10px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  resize: vertical;\n}\n\n.items-adjustment {\n  max-height: 200px;\n  overflow-y: auto;\n  border: 1px solid #eee;\n  border-radius: 4px;\n  margin-bottom: 10px;\n}\n\n.item-adjust-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px;\n  border-bottom: 1px solid #eee;\n}\n\n.item-adjust-row:last-child {\n  border-bottom: none;\n}\n\n.item-name {\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.quantity-controls {\n  display: flex;\n  align-items: center;\n  margin: 0 10px;\n}\n\n.quantity-controls button {\n  width: 30px;\n  height: 30px;\n  border: 1px solid #ddd;\n  background-color: #f0f0f0;\n  border-radius: 4px;\n  font-size: 16px;\n  cursor: pointer;\n}\n\n.quantity-controls button:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.quantity-controls input {\n  width: 50px;\n  text-align: center;\n  margin: 0 5px;\n  padding: 5px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n}\n\n.item-price {\n  min-width: 80px;\n  text-align: right;\n  font-weight: bold;\n}\n\n.adjusted-total {\n  text-align: right;\n  font-size: 16px;\n  margin-top: 10px;\n  color: #d12f7a;\n}\n\n.decline-modal-actions {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 20px;\n}\n\n.send-approval-btn {\n  background-color: #4caf50;\n  color: white;\n  border: none;\n  padding: 10px 20px;\n  border-radius: 4px;\n  cursor: pointer;\n  font-weight: bold;\n}\n\n.confirm-decline-btn {\n  background-color: #f44336;\n  color: white;\n  border: none;\n  padding: 10px 20px;\n  border-radius: 4px;\n  cursor: pointer;\n  font-weight: bold;\n}\n\n/* Animation for order approval transition */\n@keyframes orderApproved {\n  0% {\n    background-color: #ffe6e6;\n    border-color: #ff0000;\n    box-shadow: 0 4px 10px rgba(255, 0, 0, 0.2);\n  }\n  50% {\n    background-color: #e6ffe6;\n    border-color: #4caf50;\n    box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);\n  }\n  100% {\n    background-color: white;\n    border-color: #ddd;\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n  }\n}\n\n.order-approved-animation {\n  animation: orderApproved 1.5s ease-in-out forwards;\n}\n\n/* Add the success animation styles */\n@keyframes successPulse {\n  0% { background-color: #fff; }\n  25% { background-color: #e6ffe6; }\n  50% { background-color: #ccffcc; }\n  75% { background-color: #e6ffe6; }\n  100% { background-color: #fff; }\n}\n\n.order-approved-success {\n  animation: successPulse 2s ease;\n  border: 2px solid #4CAF50 !important;\n  box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3) !important;\n}\n\n/* Settings Modal Styles */\n.settings-modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1003;\n}\n\n.settings-content {\n  background-color: white;\n  padding: 25px;\n  border-radius: 10px;\n  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);\n  text-align: center;\n  max-width: 400px;\n  width: 90%;\n}\n\n.settings-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px 20px;\n  background-color: #f8d2e4;\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.settings-header h2 {\n  color: #d12f7a;\n  margin: 0;\n}\n\n.close-modal-btn {\n  background: none;\n  border: none;\n  color: #d12f7a;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 5px;\n}\n\n.close-modal-btn:hover {\n  color: #b82d67;\n}\n\n.settings-body {\n  padding: 20px;\n  overflow-y: auto;\n  max-height: calc(90vh - 70px); /* Subtract header height */\n}\n\n.settings-section {\n  margin-bottom: 20px;\n}\n\n.settings-section h3 {\n  color: #d12f7a;\n  margin-top: 0;\n  margin-bottom: 15px;\n  font-size: 1.5em;\n}\n\n.password-form {\n  display: flex;\n  flex-direction: column;\n  gap: 15px;\n}\n\n.form-group {\n  display: flex;\n  flex-direction: column;\n  gap: 5px;\n}\n\n.form-group label {\n  font-weight: bold;\n}\n\n.form-group input {\n  padding: 8px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n}\n\n.error-message,\n.success-message {\n  color: #f44336;\n  font-size: 14px;\n  margin-top: 5px;\n}\n\n.change-password-btn {\n  background-color: #d12f7a;\n  color: white;\n  border: none;\n  padding: 10px 20px;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: background-color 0.3s ease;\n}\n\n.change-password-btn:hover {\n  background-color: #b82d67;\n}\n\n/* Media query adjustments for the settings modal */\n@media (max-width: 768px) {\n  .settings-content {\n    width: 95%;\n    max-height: 95vh;\n  }\n}\n\n@media (max-width: 480px) {\n  .settings-header {\n    padding: 10px 15px;\n  }\n  \n  .settings-body {\n    padding: 15px;\n  }\n}\n\n</style>"],"mappings":";;;;;;;;;;;;;;;AAuaA,OAAOA,UAAS,MAAO,kBAAiB;AAExC,eAAe;EACbC,UAAU,EAAE;IACVD;EACF,CAAC;EACDE,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,MAAM,EAAE,EAAE;MAAE;MACZC,SAAS,EAAE,IAAI;MAAE;MACjBC,EAAE,EAAE,IAAI;MAAE;MACVC,WAAW,EAAE,KAAK;MAClBC,oBAAoB,EAAE,IAAI;MAAE;MAC5BC,oBAAoB,EAAE,EAAE;MAAE;MAC1BC,gBAAgB,EAAE,KAAK;MAAE;MACzBC,WAAW,EAAE,EAAE;MAAE;MACjBC,UAAU,EAAE,IAAI;MAChBC,mBAAmB,EAAE,EAAE;MACvBC,iBAAiB,EAAE,EAAE;MACrBC,mBAAmB,EAAE,KAAK;MAC1BC,cAAc,EAAE,KAAK;MAAE;MACvBC,aAAa,EAAE,KAAK;MACpBC,gBAAgB,EAAE,CAAC,CAAC;MAAE;MACtBC,sBAAsB,EAAE,IAAI;MAAE;MAC9BC,gBAAgB,EAAE,KAAK;MACvBC,oBAAoB,EAAE,KAAK;MAC3BC,UAAU,EAAE,EAAE;MACdC,gBAAgB,EAAE,EAAE;MACpBC,YAAY,EAAE,IAAI;MAClBC,iBAAiB,EAAE,KAAK;MACxBC,mBAAmB,EAAE,CAAC;MACtBC,iBAAiB,EAAE,EAAE;MACrBC,gBAAgB,EAAE,EAAE;MACpBC,gBAAgB,EAAE,EAAE;MACpB;MACAC,gBAAgB,EAAE,KAAK;MACvBC,aAAa,EAAE,IAAI;MACnBC,aAAa,EAAE,EAAE;MACjBC,eAAe,EAAE,IAAI;MAAE;MACvBC,UAAU,EAAE,KAAK;MAAE;MACnBC,YAAY,EAAE,IAAI;MAAE;MACpBC,YAAY,EAAE;QACZC,eAAe,EAAE,EAAE;QACnBC,WAAW,EAAE,EAAE;QACfC,eAAe,EAAE,EAAE;QACnBC,KAAK,EAAE,EAAE;QACTC,OAAO,EAAE;MACX,CAAC;MACDC,eAAe,EAAE,EAAE;MACnBC,aAAa,EAAE;IACjB,CAAC;EACH,CAAC;EACDC,QAAQ,EAAE;IACR;IACAC,cAAcA,CAAA,EAAG;MACf,IAAI,CAAC,IAAI,CAAClC,WAAW,EAAE;QACrB,OAAO,IAAI,CAACP,MAAM;MACpB;MACA,OAAO,IAAI,CAACA,MAAM,CAAC0C,MAAM,CAACC,KAAI,IAAK;QACjC,MAAMC,oBAAmB,GAAI,IAAI,CAACrC,WAAW,CAACsC,WAAW,CAAC,CAAC;QAC3D,OACEF,KAAK,CAACG,EAAE,CAACC,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAACJ,oBAAoB;QAAK;QACtDD,KAAK,CAACM,aAAa,CAACJ,WAAW,CAAC,CAAC,CAACG,QAAQ,CAACJ,oBAAoB,EAAE;QAAA;MAErE,CAAC,CAAC;IACJ,CAAC;IACDM,kBAAkBA,CAAA,EAAG;MACnB,OAAO,IAAI,CAAChC,UAAU,CAACwB,MAAM,CAACS,IAAG,IAAK;QACpC,IAAI,CAACA,IAAG,IAAK,CAACA,IAAI,CAACC,IAAI,EAAE,OAAO,KAAK;QACrC,MAAMC,aAAY,GAAIF,IAAI,CAACC,IAAI,CAACP,WAAW,CAAC,CAAC,CAACG,QAAQ,CAAC,CAAC,IAAI,CAAC7B,gBAAe,IAAK,EAAE,EAAE0B,WAAW,CAAC,CAAC,CAAC;QACnG,MAAMS,eAAc,GAAI,CAAC,IAAI,CAAC9B,gBAAe,IAAK2B,IAAI,CAACI,QAAO,KAAM,IAAI,CAAC/B,gBAAgB;QACzF,OAAO6B,aAAY,IAAKC,eAAe;MACzC,CAAC,CAAC;IACJ;EACF,CAAC;EAEDE,OAAO,EAAE;IACPC,gBAAgBA,CAAA,EAAG;MACnB,IAAI,CAACjD,UAAS,GAAI,CAAC,IAAI,CAACA,UAAU,EAAE;MACpCkD,YAAY,CAACC,OAAO,CAAC,YAAY,EAAE,IAAI,CAACnD,UAAU,CAAC,EAAE;;MAErD;MACA,IAAI,IAAI,CAACA,UAAU,EAAE;QACnB,IAAI,CAACC,mBAAkB,GAAI,yBAAyB;QACpD,IAAI,CAACC,iBAAgB,GAAI,mBAAmB,EAAE;MAChD,OAAO;QACL,IAAI,CAACD,mBAAkB,GAAI,2BAA2B;QACtD,IAAI,CAACC,iBAAgB,GAAI,qBAAqB,EAAE;MAClD;MAEA,IAAI,CAACkD,gBAAgB,CAAC,CAAC,EAAG;IAC5B,CAAC;IAEAA,gBAAgBA,CAAA,EAAG;MAClB;MACA,IAAI,CAACjD,mBAAkB,GAAI,IAAI;MAE/BkD,UAAU,CAAC,MAAM;QACf,IAAI,CAAClD,mBAAkB,GAAI,KAAK;MAClC,CAAC,EAAE,IAAI,CAAC,EAAG;IACb,CAAC;IAGCmD,OAAOA,CAACC,SAAS,EAAE;MACnB;MACA,IAAI,OAAOA,SAAQ,KAAM,QAAQ,EAAE;QACjCA,SAAQ,GAAIA,SAAS,CAACC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE;MAC3C;MAEA,MAAMC,GAAE,GAAI,IAAIC,IAAI,CAAC,CAAC;MACtB,MAAMC,SAAQ,GAAI,IAAID,IAAI,CAACH,SAAS,CAAC,EAAE;;MAEvC;MACA,IAAIK,KAAK,CAACD,SAAS,CAAC,EAAE;QACpB,OAAO,cAAc,EAAE;MACzB;MAEA,MAAME,mBAAkB,GAAIC,IAAI,CAACC,KAAK,CAAC,CAACN,GAAE,GAAIE,SAAS,IAAI,IAAI,CAAC;MAEhE,IAAIE,mBAAkB,GAAI,EAAE,EAAE;QAC5B,OAAO,UAAU;MACnB,OAAO,IAAIA,mBAAkB,GAAI,IAAI,EAAE;QACrC,MAAMG,OAAM,GAAIF,IAAI,CAACC,KAAK,CAACF,mBAAkB,GAAI,EAAE,CAAC;QACpD,OAAO,GAAGG,OAAO,UAAUA,OAAM,GAAI,IAAI,GAAE,GAAI,EAAE,MAAM;MACzD,OAAO,IAAIH,mBAAkB,GAAI,KAAK,EAAE;QACtC,MAAMI,KAAI,GAAIH,IAAI,CAACC,KAAK,CAACF,mBAAkB,GAAI,IAAI,CAAC;QACpD,OAAO,GAAGI,KAAK,QAAQA,KAAI,GAAI,IAAI,GAAE,GAAI,EAAE,MAAM;MACnD,OAAO,IAAIJ,mBAAkB,GAAI,OAAO,EAAE;QACxC,MAAMK,IAAG,GAAIJ,IAAI,CAACC,KAAK,CAACF,mBAAkB,GAAI,KAAK,CAAC;QACpD,OAAO,GAAGK,IAAI,OAAOA,IAAG,GAAI,IAAI,GAAE,GAAI,EAAE,MAAM;MAChD,OAAO,IAAIL,mBAAkB,GAAI,QAAQ,EAAE;QACzC,MAAMM,MAAK,GAAIL,IAAI,CAACC,KAAK,CAACF,mBAAkB,GAAI,OAAO,CAAC;QACxD,OAAO,GAAGM,MAAM,SAASA,MAAK,GAAI,IAAI,GAAE,GAAI,EAAE,MAAM;MACtD,OAAO;QACL,MAAMC,KAAI,GAAIN,IAAI,CAACC,KAAK,CAACF,mBAAkB,GAAI,QAAQ,CAAC;QACxD,OAAO,GAAGO,KAAK,QAAQA,KAAI,GAAI,IAAI,GAAE,GAAI,EAAE,MAAM;MACnD;IACF,CAAC;IAIC;IACAC,UAAUA,CAACC,UAAU,EAAE;MACrB,MAAMC,IAAG,GAAI,IAAIb,IAAI,CAACY,UAAU,CAAC;MACjC,MAAME,KAAI,GAAI,CAACD,IAAI,CAACE,QAAQ,CAAC,IAAI,CAAC,EAAElC,QAAQ,CAAC,CAAC,CAACmC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;MAC/D,MAAMC,GAAE,GAAIJ,IAAI,CAACK,OAAO,CAAC,CAAC,CAACrC,QAAQ,CAAC,CAAC,CAACmC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;MACtD,MAAMG,IAAG,GAAIN,IAAI,CAACO,WAAW,CAAC,CAAC;MAC/B,MAAMb,KAAI,GAAIM,IAAI,CAACQ,QAAQ,CAAC,CAAC;MAC7B,MAAMf,OAAM,GAAIO,IAAI,CAACS,UAAU,CAAC,CAAC,CAACzC,QAAQ,CAAC,CAAC,CAACmC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;MAC7D,MAAMO,MAAK,GAAIhB,KAAI,IAAK,EAAC,GAAI,IAAG,GAAI,IAAI;MACxC,MAAMiB,MAAK,GAAI,CAACjB,KAAI,GAAI,EAAC,IAAK,EAAE,EAAE1B,QAAQ,CAAC,CAAC,CAACmC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;;MAE7D;MACA,MAAMS,aAAY,GAAI,GAAGX,KAAK,IAAIG,GAAG,IAAIE,IAAI,mCAAmCK,MAAM,IAAIlB,OAAO,IAAIiB,MAAM,SAAS;MACpH,OAAOE,aAAa;IACtB,CAAC;IAEDC,aAAaA,CAAA,EAAG;MACd,IAAI,CAACxF,oBAAmB,GAAI,IAAI,EAAE;MAClC,IAAI,CAACC,oBAAmB,GAAI,EAAE,EAAE;IAClC,CAAC;IAED;IACAwF,eAAeA,CAAA,EAAG;MAChB,IAAI,CAACC,OAAO,CAACC,IAAI,CAAC;QAAE3C,IAAI,EAAE;MAAc,CAAC,CAAC,EAAG;IAC/C,CAAC;IAED4C,MAAMA,CAAA,EAAG;MACP,IAAI,CAACF,OAAO,CAACC,IAAI,CAAC;QAAE3C,IAAI,EAAE;MAAQ,CAAC,CAAC,EAAG;IACzC,CAAC;IAED;IACA,MAAM6C,WAAWA,CAAA,EAAG;MAClB,IAAI,IAAI,CAAChG,SAAS,EAAE;MACpB,IAAI,CAACA,SAAQ,GAAI,IAAI;MAErB,IAAI;QACF,MAAMiG,QAAO,GAAI,MAAMC,KAAK,CAAC,8BAA8B,CAAC;QAC5D,MAAMpG,IAAG,GAAI,MAAMmG,QAAQ,CAACE,IAAI,CAAC,CAAC;QAClC,IAAIrG,IAAI,CAACC,MAAK,IAAKqG,KAAK,CAACC,OAAO,CAACvG,IAAI,CAACC,MAAM,CAAC,EAAE;UAC7C;UACA,MAAMuG,aAAY,GAAIxG,IAAI,CAACC,MAAK,CAC7B0C,MAAM,CAACC,KAAI,IAAKA,KAAK,CAAC6D,MAAK,KAAM,SAAS,EAC1CC,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK;YACd;YACA,MAAMC,GAAE,GAAIC,QAAQ,CAACH,CAAC,CAAC5D,EAAE,CAAC;YAC1B,MAAMgE,GAAE,GAAID,QAAQ,CAACF,CAAC,CAAC7D,EAAE,CAAC;YAC1B,OAAO8D,GAAE,GAAIE,GAAG,EAAE;UACpB,CAAC,CAAC;UAEJC,OAAO,CAACC,GAAG,CAAC,WAAWT,aAAa,CAACU,MAAM,iBAAiB,CAAC;;UAE7D;UACA,IAAI,CAACjH,MAAK,GAAI,CAAC,GAAGuG,aAAa,CAAC;;UAEhC;UACA;UACA,IAAI,CAACvG,MAAM,CAACkH,OAAO,CAACvE,KAAI,IAAK;YAC3B;YACA,IAAI,IAAI,CAAC7B,gBAAgB,CAAC6B,KAAK,CAACG,EAAE,CAAC,EAAE;cACnC;YACF;;YAEA;YACA,MAAMqE,oBAAmB,GAAI,sBAAsBxE,KAAK,CAACM,aAAa,EAAE;YACxE,MAAMmE,aAAY,GAAIC,IAAI,CAACC,KAAK,CAAC5D,YAAY,CAAC6D,OAAO,CAACJ,oBAAoB,CAAC,KAAK,EAAE;YAClF,MAAMK,oBAAmB,GAAIJ,aAAa,CAACK,IAAI,CAACC,CAAA,IAAKA,CAAC,CAACC,OAAM,KAAMhF,KAAK,CAACG,EAAE,CAAC;YAE5E,IAAI0E,oBAAoB,EAAE;cACxB,IAAI,CAAC1G,gBAAgB,CAAC6B,KAAK,CAACG,EAAE,IAAI,IAAI;YACxC;UACF,CAAC,CAAC;;UAEF;UACAY,YAAY,CAACC,OAAO,CAAC,kBAAkB,EAAE0D,IAAI,CAACO,SAAS,CAAC,IAAI,CAAC9G,gBAAgB,CAAC,CAAC;;UAE/E;UACA,IAAI,CAAC+G,YAAY,CAAC,CAAC;QACrB,OAAO;UACLd,OAAO,CAAC3E,KAAK,CAAC,qBAAqB,EAAErC,IAAI,CAAC;UAC1C,IAAI,CAACC,MAAK,GAAI,EAAE;QAClB;MACF,EAAE,OAAOoC,KAAK,EAAE;QACd2E,OAAO,CAAC3E,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAChD,UAAU;QACR,IAAI,CAACnC,SAAQ,GAAI,KAAK;MACxB;IACF,CAAC;IAED;IACA6H,WAAWA,CAACC,KAAK,EAAE;MACjB,IAAI,CAAC1B,KAAK,CAACC,OAAO,CAACyB,KAAK,CAAC,EAAE;QACzBhB,OAAO,CAAC3E,KAAK,CAAC,sBAAsB,EAAE2F,KAAK,CAAC;QAC5C,OAAO,mBAAmB;MAC5B;MACA,OAAOA,KAAK,CAACC,GAAG,CAAC7E,IAAG,IAAK,GAAGA,IAAI,CAACC,IAAI,KAAKD,IAAI,CAAC8E,QAAQ,EAAE,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;IACvE,CAAC;IAED;IACAC,mBAAmBA,CAACJ,KAAK,EAAE;MACzB,IAAI,CAAC1B,KAAK,CAACC,OAAO,CAACyB,KAAK,CAAC,EAAE,OAAO,IAAI;MACtC,OAAOA,KAAK,CAACK,MAAM,CAAC,CAACC,GAAG,EAAElF,IAAI,KAAKkF,GAAE,GAAIlF,IAAI,CAACmF,KAAI,GAAInF,IAAI,CAAC8E,QAAQ,EAAE,CAAC,CAAC,CAACM,OAAO,CAAC,CAAC,CAAC;IACpF,CAAC;IAED;IACAC,eAAeA,CAACb,OAAO,EAAEc,YAAY,EAAEV,KAAK,EAAE;MAC5C;MACAhB,OAAO,CAACC,GAAG,CAAC,iBAAiBW,OAAO,kBAAkB,CAAC;;MAEvD;MACA,IAAIe,cAAa,GAAIX,KAAK;MAC1B,IAAI,OAAOA,KAAI,KAAM,QAAQ,EAAE;QAC7B,IAAI;UACFW,cAAa,GAAIrB,IAAI,CAACC,KAAK,CAACS,KAAK,CAAC;QACpC,EAAE,OAAOY,CAAC,EAAE;UACV5B,OAAO,CAAC3E,KAAK,CAAC,wBAAwB,EAAEuG,CAAC,CAAC;UAC1CC,KAAK,CAAC,iDAAiD,CAAC;UACxD;QACF;MACF;MAEAzC,KAAK,CAAC,gCAAgCwB,OAAO,EAAE,EAAE;QAC/CkB,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/CC,IAAI,EAAE1B,IAAI,CAACO,SAAS,CAAC;UAAEpB,MAAM,EAAE;QAAY,CAAC;MAC9C,CAAC,EACEwC,IAAI,CAAC9C,QAAO,IAAK;QAChB;QACA,IAAI,CAACA,QAAQ,EAAE;UACb,MAAM,IAAI+C,KAAK,CAAC,kCAAkC,CAAC;QACrD;;QAEA;QACA,IAAI,CAAC/C,QAAQ,CAACgD,EAAE,EAAE;UAChB,OAAOhD,QAAQ,CAACiD,IAAI,CAAC,CAAC,CAACH,IAAI,CAACG,IAAG,IAAK;YAClC,IAAI;cACF;cACA,MAAMpJ,IAAG,GAAIsH,IAAI,CAACC,KAAK,CAAC6B,IAAI,CAAC;cAC7B,MAAM,IAAIF,KAAK,CAAClJ,IAAI,CAACqJ,MAAK,IAAK,iBAAiBlD,QAAQ,CAACM,MAAM,EAAE,CAAC;YACpE,EAAE,OAAOmC,CAAC,EAAE;cACV;cACA,MAAM,IAAIM,KAAK,CAAC,iBAAiB/C,QAAQ,CAACM,MAAM,MAAM2C,IAAG,IAAK,eAAe,EAAE,CAAC;YAClF;UACF,CAAC,CAAC;QACJ;QACA,OAAOjD,QAAQ,CAACE,IAAI,CAAC,CAAC;MACxB,CAAC,EACA4C,IAAI,CAAEjJ,IAAI,IAAK;QACdgH,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAEjH,IAAI,CAAC;;QAElD;QACA,IAAI,CAACC,MAAK,GAAI,IAAI,CAACA,MAAM,CAAC0C,MAAM,CAACC,KAAI,IAAKA,KAAK,CAACG,EAAC,KAAM6E,OAAO,CAAC;;QAE/D;QACA,OAAO,IAAI,CAAC7G,gBAAgB,CAAC6G,OAAO,CAAC;QACrC;QACAjE,YAAY,CAACC,OAAO,CAAC,kBAAkB,EAAE0D,IAAI,CAACO,SAAS,CAAC,IAAI,CAAC9G,gBAAgB,CAAC,CAAC;;QAE/E;QACA,MAAMuI,KAAI,GAAIX,cAAc,CAACN,MAAM,CAAC,CAACC,GAAG,EAAElF,IAAI,KAAKkF,GAAE,GAAIlF,IAAI,CAACmF,KAAI,GAAInF,IAAI,CAAC8E,QAAQ,EAAE,CAAC,CAAC,CAACM,OAAO,CAAC,CAAC,CAAC;;QAElG;QACA,MAAMe,YAAW,GAAI;UACnB3B,OAAO;UACPc,YAAY;UACZc,OAAO,EAAE,yJAAyJ,IAAI,CAACzB,WAAW,CAACY,cAAc,CAAC,aAAaW,KAAK,SAAS;UAC7NtF,SAAS,EAAE,IAAIG,IAAI,CAAC,CAAC,CAACsF,WAAW,CAAC,CAAC;UACnCzB,KAAK,EAAEW,cAAc;UACrBW;QACF,CAAC;;QAED;QACA,MAAMlC,oBAAmB,GAAI,sBAAsBsB,YAAY,EAAE;QACjE,IAAIrB,aAAY,GAAIC,IAAI,CAACC,KAAK,CAAC5D,YAAY,CAAC6D,OAAO,CAACJ,oBAAoB,CAAC,KAAK,EAAE;QAChFC,aAAa,CAACrB,IAAI,CAACuD,YAAY,CAAC;QAChC5F,YAAY,CAACC,OAAO,CAACwD,oBAAoB,EAAEE,IAAI,CAACO,SAAS,CAACR,aAAa,CAAC,CAAC;;QAEzE;QACA,IAAI,IAAI,CAAClH,EAAC,IAAK,IAAI,CAACA,EAAE,CAACuJ,UAAS,KAAMC,SAAS,CAACC,IAAI,EAAE;UACpD,IAAI,CAACzJ,EAAE,CAAC0J,IAAI,CAACvC,IAAI,CAACO,SAAS,CAAC;YAC1BiC,IAAI,EAAE,mBAAmB;YACzBC,MAAM,EAAE,iBAAiB;YACzBR,YAAY,EAAEA,YAAY;YAC1BS,WAAW,EAAEtB;UACf,CAAC,CAAC,CAAC;QACL;;QAEA;QACAuB,MAAM,CAACC,aAAa,CAAC,IAAIC,KAAK,CAAC,qBAAqB,CAAC,CAAC;QAEtDtB,KAAK,CAAC,4BAA4B,CAAC;MACrC,CAAC,EACAuB,KAAK,CAAC/H,KAAI,IAAK;QACd2E,OAAO,CAAC3E,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;QACzDwG,KAAK,CAACxG,KAAK,CAACmH,OAAM,IAAK,2CAA2C,CAAC;QACnE;QACA,IAAI,CAACtD,WAAW,CAAC,CAAC;MACpB,CAAC,CAAC;IACN,CAAC;IAED;IACAmE,iBAAiBA,CAACzH,KAAK,EAAE;MACvB,IAAI,CAACvC,oBAAmB,GAAIuC,KAAK,CAACG,EAAE;MACpC,IAAI,CAACnB,aAAY,GAAIgB,KAAK;MAC1B,IAAI,CAACtC,oBAAmB,GAAIqD,YAAY,CAAC6D,OAAO,CAAC,wBAAwB5E,KAAK,CAACG,EAAE,EAAE,KAAK,0DAA0D;;MAElJ;MACA,IAAI,CAAClB,aAAY,GAAIyF,IAAI,CAACC,KAAK,CAACD,IAAI,CAACO,SAAS,CAACjF,KAAK,CAACoF,KAAK,CAAC,CAAC;;MAE5D;MACA,IAAI,CAACrG,gBAAe,GAAI,IAAI;IAC9B,CAAC;IAED;IACA2I,iBAAiBA,CAAA,EAAG;MAClB,IAAI,CAAC3I,gBAAe,GAAI,KAAK;MAC7B,IAAI,CAACtB,oBAAmB,GAAI,IAAI;MAChC,IAAI,CAACuB,aAAY,GAAI,IAAI;IAC3B,CAAC;IAED;IACA2I,iBAAiBA,CAACC,KAAK,EAAE;MACvB,IAAI,CAAC3I,aAAa,CAAC2I,KAAK,CAAC,CAACtC,QAAQ,EAAE;IACtC,CAAC;IAED;IACAuC,iBAAiBA,CAACD,KAAK,EAAE;MACvB,IAAI,IAAI,CAAC3I,aAAa,CAAC2I,KAAK,CAAC,CAACtC,QAAO,GAAI,CAAC,EAAE;QAC1C,IAAI,CAACrG,aAAa,CAAC2I,KAAK,CAAC,CAACtC,QAAQ,EAAE;MACtC;IACF,CAAC;IAED;IACAwC,sBAAsBA,CAAA,EAAG;MACvB,OAAO,IAAI,CAAC7I,aAAa,CAACwG,MAAM,CAAC,CAACC,GAAG,EAAElF,IAAI,KAAKkF,GAAE,GAAKlF,IAAI,CAACmF,KAAI,GAAInF,IAAI,CAAC8E,QAAS,EAAE,CAAC,CAAC,CAACM,OAAO,CAAC,CAAC,CAAC;IACnG,CAAC;IAED;IACAmC,eAAeA,CAAA,EAAG;MAChB,IAAI,CAAC,IAAI,CAAC/I,aAAa,EAAE;MAEzB,MAAMgG,OAAM,GAAI,IAAI,CAAChG,aAAa,CAACmB,EAAE;MACrC,MAAM2F,YAAW,GAAI,IAAI,CAAC9G,aAAa,CAACsB,aAAa;;MAErD;MACA,MAAMoG,KAAI,GAAI,IAAI,CAACoB,sBAAsB,CAAC,CAAC;;MAE3C;MACA,MAAME,cAAa,GAAI,IAAI,CAAC7C,WAAW,CAAC,IAAI,CAAClG,aAAa,CAAC;;MAE3D;MACA,IAAIgJ,iBAAgB,GAAI,EAAE;MAC1B,IAAI,CAAChJ,aAAa,CAACsF,OAAO,CAAE/D,IAAI,IAAK;QACnC,MAAM0H,YAAW,GAAI,IAAI,CAAClJ,aAAa,CAACoG,KAAK,CAAC+C,IAAI,CAACC,CAAA,IAAKA,CAAC,CAAC3H,IAAG,KAAMD,IAAI,CAACC,IAAI,CAAC;QAC7E,IAAIyH,YAAW,IAAKA,YAAY,CAAC5C,QAAO,KAAM9E,IAAI,CAAC8E,QAAQ,EAAE;UAC3D2C,iBAAiB,CAAC7E,IAAI,CAAC,GAAG5C,IAAI,CAACC,IAAI,kBAAkByH,YAAY,CAAC5C,QAAQ,OAAO9E,IAAI,CAAC8E,QAAQ,8BAA8B,CAAC;QAC/H;MACF,CAAC,CAAC;;MAEF;MACA,MAAM+C,mBAAkB,GAAIJ,iBAAiB,CAAC3D,MAAK,GAAI,IACnD,wCAAwC2D,iBAAiB,CAAC1C,IAAI,CAAC,IAAI,CAAC,IAAG,GACvE,EAAE;;MAEN;MACA,MAAMqB,OAAM,GAAI,GAAG,IAAI,CAAClJ,oBAAoB,IAAI2K,mBAAmB,qCAAqCL,cAAc,aAAatB,KAAK,EAAE;;MAE1I;MACA,MAAMC,YAAW,GAAI;QACnB3B,OAAO;QACPc,YAAY;QACZc,OAAO;QACPxF,SAAS,EAAE,IAAIG,IAAI,CAAC,CAAC,CAACsF,WAAW,CAAC,CAAC;QACnCzB,KAAK,EAAE,IAAI,CAACnG,aAAa;QACzByH,KAAK;QACL4B,gBAAgB,EAAE,IAAI;QAAG;QACzBC,aAAa,EAAE,IAAI,CAACvJ,aAAa,CAACoG,KAAI,CAAG;MAC3C,CAAC;;MAED;MACA,IAAI,CAACjG,UAAS,GAAI,IAAI;;MAEtB;MACAqE,KAAK,CAAC,gCAAgCwB,OAAO,eAAe,EAAE;QAC5DkB,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/CC,IAAI,EAAE1B,IAAI,CAACO,SAAS,CAAC;UACnBG,KAAK,EAAE,IAAI,CAACnG,aAAa;UACzB4E,MAAM,EAAE,SAAS;UAAG;UACpB2E,iBAAiB,EAAE,IAAG,CAAE;QAC1B,CAAC;MACH,CAAC,EACAnC,IAAI,CAAC9C,QAAO,IAAK;QAChB,IAAI,CAACA,QAAQ,CAACgD,EAAE,EAAE;UAChB,OAAOhD,QAAQ,CAACiD,IAAI,CAAC,CAAC,CAACH,IAAI,CAACG,IAAG,IAAK;YAClCpC,OAAO,CAAC3E,KAAK,CAAC,iBAAiB8D,QAAQ,CAACM,MAAM,cAAc2C,IAAI,EAAE,CAAC;YACnE,MAAM,IAAIF,KAAK,CAAC,2BAA2B/C,QAAQ,CAACM,MAAM,MAAM2C,IAAI,EAAE,CAAC;UACzE,CAAC,CAAC;QACJ;QACA,OAAOjD,QAAQ,CAACE,IAAI,CAAC,CAAC;MACxB,CAAC,EACA4C,IAAI,CAAEjJ,IAAI,IAAK;QACdgH,OAAO,CAACC,GAAG,CAAC,8CAA8C,EAAEjH,IAAI,CAAC;;QAEjE;QACA,MAAMoH,oBAAmB,GAAI,sBAAsBsB,YAAY,EAAE;QACjE,IAAIrB,aAAY,GAAIC,IAAI,CAACC,KAAK,CAAC5D,YAAY,CAAC6D,OAAO,CAACJ,oBAAoB,CAAC,KAAK,EAAE;QAChFC,aAAa,CAACrB,IAAI,CAACuD,YAAY,CAAC;QAChC5F,YAAY,CAACC,OAAO,CAACwD,oBAAoB,EAAEE,IAAI,CAACO,SAAS,CAACR,aAAa,CAAC,CAAC;;QAEzE;QACA,IAAI,IAAI,CAAClH,EAAC,IAAK,IAAI,CAACA,EAAE,CAACuJ,UAAS,KAAMC,SAAS,CAACC,IAAI,EAAE;UACpD,IAAI,CAACzJ,EAAE,CAAC0J,IAAI,CAACvC,IAAI,CAACO,SAAS,CAAC;YAC1BiC,IAAI,EAAE,mBAAmB;YACzBC,MAAM,EAAE,kBAAkB;YAAG;YAC7BR,YAAY,EAAEA,YAAY;YAC1BS,WAAW,EAAEtB;UACf,CAAC,CAAC,CAAC;QACL;;QAEA;QACA,MAAM2C,UAAS,GAAI,IAAI,CAACpL,MAAM,CAACqL,SAAS,CAACC,CAAA,IAAKA,CAAC,CAACxI,EAAC,KAAM6E,OAAO,CAAC;QAC/D,IAAIyD,UAAS,KAAM,CAAC,CAAC,EAAE;UACrB;UACA,MAAMG,YAAW,GAAI;YACnB,GAAG,IAAI,CAACvL,MAAM,CAACoL,UAAU,CAAC;YAC1BrD,KAAK,EAAE,IAAI,CAACnG,aAAa;YACzBuJ,iBAAiB,EAAE,IAAG,CAAE;UAC1B,CAAC;;UAED;UACA,IAAI,CAACnL,MAAK,GAAI,CACZ,GAAG,IAAI,CAACA,MAAM,CAACwL,KAAK,CAAC,CAAC,EAAEJ,UAAU,CAAC,EACnCG,YAAY,EACZ,GAAG,IAAI,CAACvL,MAAM,CAACwL,KAAK,CAACJ,UAAS,GAAI,CAAC,EACpC;QACH;;QAEA;QACA,IAAI,CAAC3K,mBAAkB,GAAI,mDAAmD;QAC9E,IAAI,CAACC,iBAAgB,GAAI,sBAAsB;QAC/C,IAAI,CAACkD,gBAAgB,CAAC,CAAC;;QAEvB;QACA,IAAI,CAAC9B,UAAS,GAAI,KAAK;QACvB,IAAI,CAACuI,iBAAiB,CAAC,CAAC;MAC1B,CAAC,EACAF,KAAK,CAAC/H,KAAI,IAAK;QACd2E,OAAO,CAAC3E,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;;QAEnD;QACA,IAAI,CAACN,UAAS,GAAI,KAAK;;QAEvB;QACA,IAAI,CAACrB,mBAAkB,GAAI,UAAU2B,KAAK,CAACmH,OAAO,EAAE;QACpD,IAAI,CAAC7I,iBAAgB,GAAI,oBAAoB;QAC7C,IAAI,CAACkD,gBAAgB,CAAC,CAAC;;QAEvB;QACA,IAAI6H,OAAO,CAAC,2BAA2BrJ,KAAK,CAACmH,OAAO,yBAAyB,CAAC,EAAE;UAC9E;UACA,IAAI,CAACmB,eAAe,CAAC,CAAC;QACxB;MACF,CAAC,CAAC;IACJ,CAAC;IAED;IACAgB,cAAcA,CAAA,EAAG;MACf,IAAI,CAAC,IAAI,CAAC/J,aAAa,EAAE;;MAEzB;MACA,IAAI,CAACG,UAAS,GAAI,IAAI;MAEtB,MAAM6F,OAAM,GAAI,IAAI,CAAChG,aAAa,CAACmB,EAAE;MACrC,MAAM2F,YAAW,GAAI,IAAI,CAAC9G,aAAa,CAACsB,aAAa;MACrD,MAAM8E,KAAI,GAAI,IAAI,CAACpG,aAAa,CAACoG,KAAK;MACtC,MAAMwB,OAAM,GAAI,IAAI,CAAClJ,oBAAmB,IAAK,2HAA2H;MAExK8F,KAAK,CAAC,gCAAgCwB,OAAO,EAAE,EAAE;QAC/CkB,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/CC,IAAI,EAAE1B,IAAI,CAACO,SAAS,CAAC;UAAEpB,MAAM,EAAE;QAAW,CAAC;MAC7C,CAAC,EACAwC,IAAI,CAAC9C,QAAO,IAAK;QAChB,IAAI,CAACA,QAAQ,CAACgD,EAAE,EAAE;UAChB,MAAM,IAAID,KAAK,CAAC,uBAAuB/C,QAAQ,CAACM,MAAM,EAAE,CAAC;QAC3D;QACA,OAAON,QAAQ,CAACE,IAAI,CAAC,CAAC;MACxB,CAAC,EACA4C,IAAI,CAAC,MAAM;QACV;QACA,IAAI,CAAChJ,MAAK,GAAI,IAAI,CAACA,MAAM,CAAC0C,MAAM,CAACC,KAAI,IAAKA,KAAK,CAACG,EAAC,KAAM6E,OAAO,CAAC;;QAE/D;QACA,IAAI,IAAI,CAAC7G,gBAAgB,CAAC6G,OAAO,CAAC,EAAE;UAClC,OAAO,IAAI,CAAC7G,gBAAgB,CAAC6G,OAAO,CAAC;UACrCjE,YAAY,CAACC,OAAO,CAAC,kBAAkB,EAAE0D,IAAI,CAACO,SAAS,CAAC,IAAI,CAAC9G,gBAAgB,CAAC,CAAC;QACjF;;QAEA;QACA,MAAMuI,KAAI,GAAItB,KAAK,CAACK,MAAM,CAAC,CAACC,GAAG,EAAElF,IAAI,KAAKkF,GAAE,GAAIlF,IAAI,CAACmF,KAAI,GAAInF,IAAI,CAAC8E,QAAQ,EAAE,CAAC,CAAC,CAACM,OAAO,CAAC,CAAC,CAAC;;QAEzF;QACA,MAAMe,YAAW,GAAI;UACnB3B,OAAO;UACPc,YAAY;UACZc,OAAO,EAAE,GAAGA,OAAO,mBAAmB,IAAI,CAACzB,WAAW,CAACC,KAAK,CAAC,aAAasB,KAAK,EAAE;UACjFtF,SAAS,EAAE,IAAIG,IAAI,CAAC,CAAC,CAACsF,WAAW,CAAC,CAAC;UACnCzB,KAAK;UACLsB;QACF,CAAC;;QAED;QACA,MAAMlC,oBAAmB,GAAI,sBAAsBsB,YAAY,EAAE;QACjE,IAAIrB,aAAY,GAAIC,IAAI,CAACC,KAAK,CAAC5D,YAAY,CAAC6D,OAAO,CAACJ,oBAAoB,CAAC,KAAK,EAAE;QAChFC,aAAa,CAACrB,IAAI,CAACuD,YAAY,CAAC;QAChC5F,YAAY,CAACC,OAAO,CAACwD,oBAAoB,EAAEE,IAAI,CAACO,SAAS,CAACR,aAAa,CAAC,CAAC;;QAEzE;QACA,IAAI,IAAI,CAAClH,EAAC,IAAK,IAAI,CAACA,EAAE,CAACuJ,UAAS,KAAMC,SAAS,CAACC,IAAI,EAAE;UACpD5C,OAAO,CAACC,GAAG,CAAC,oDAAoD,EAAEW,OAAO,CAAC;;UAE1E;UACA,IAAI,CAACzH,EAAE,CAAC0J,IAAI,CAACvC,IAAI,CAACO,SAAS,CAAC;YAC1BiC,IAAI,EAAE,mBAAmB;YACzBC,MAAM,EAAE,gBAAgB;YACxBR,YAAY,EAAEA,YAAY;YAC1BS,WAAW,EAAEtB;UACf,CAAC,CAAC,CAAC;;UAEH;UACA,IAAI,CAACvI,EAAE,CAAC0J,IAAI,CAACvC,IAAI,CAACO,SAAS,CAAC;YAC1BiC,IAAI,EAAE,gBAAgB;YACtB8B,QAAQ,EAAEhE,OAAO;YACjB1E,aAAa,EAAEwF,YAAY;YAC3BmD,MAAM,EAAErC,OAAO;YACfxF,SAAS,EAAE,IAAIG,IAAI,CAAC,CAAC,CAACsF,WAAW,CAAC;UACpC,CAAC,CAAC,CAAC;QACL;;QAEA;QACA,IAAI,CAAC1H,UAAS,GAAI,KAAK;;QAEvB;QACA,IAAI,CAACuI,iBAAiB,CAAC,CAAC;;QAExB;QACA,IAAI,CAAC5J,mBAAkB,GAAI,UAAUkH,OAAO,oBAAoB;QAChE,IAAI,CAACjH,iBAAgB,GAAI,qBAAqB;QAC9C,IAAI,CAACkD,gBAAgB,CAAC,CAAC;MAEzB,CAAC,EACAuG,KAAK,CAAC/H,KAAI,IAAK;QACd2E,OAAO,CAAC3E,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;QAC9C,IAAI,CAACN,UAAS,GAAI,KAAK;QACvB8G,KAAK,CAAC,0CAA0C,CAAC;MACnD,CAAC,CAAC;IACJ,CAAC;IAED;IACAiD,YAAYA,CAAClE,OAAO,EAAEc,YAAY,EAAEV,KAAK,EAAE;MACzC,MAAMwB,OAAM,GAAI,IAAI,CAAClJ,oBAAmB,IAAK,2HAA2H;MAExK8F,KAAK,CAAC,gCAAgCwB,OAAO,EAAE,EAAE;QAC/CkB,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/CC,IAAI,EAAE1B,IAAI,CAACO,SAAS,CAAC;UAAEpB,MAAM,EAAE;QAAW,CAAC,EAAE;MAC/C,CAAC,EACEwC,IAAI,CAAC9C,QAAO,IAAK;QAChB,IAAI,CAACA,QAAQ,CAACgD,EAAE,EAAE;UAChB,MAAM,IAAID,KAAK,CAAC,uBAAuB/C,QAAQ,CAACM,MAAM,EAAE,CAAC;QAC3D;QACA,OAAON,QAAQ,CAACE,IAAI,CAAC,CAAC;MACxB,CAAC,EACA4C,IAAI,CAAC,MAAM;QACV;QACA,IAAI,CAAChJ,MAAK,GAAI,IAAI,CAACA,MAAM,CAAC0C,MAAM,CAACC,KAAI,IAAKA,KAAK,CAACG,EAAC,KAAM6E,OAAO,CAAC;;QAE/D;QACA,IAAI,IAAI,CAAC7G,gBAAgB,CAAC6G,OAAO,CAAC,EAAE;UAClC,OAAO,IAAI,CAAC7G,gBAAgB,CAAC6G,OAAO,CAAC;UACrC;UACAjE,YAAY,CAACC,OAAO,CAAC,kBAAkB,EAAE0D,IAAI,CAACO,SAAS,CAAC,IAAI,CAAC9G,gBAAgB,CAAC,CAAC;QACjF;;QAEA;QACA,MAAMuI,KAAI,GAAItB,KAAK,CAACK,MAAM,CAAC,CAACC,GAAG,EAAElF,IAAI,KAAKkF,GAAE,GAAIlF,IAAI,CAACmF,KAAI,GAAInF,IAAI,CAAC8E,QAAQ,EAAE,CAAC,CAAC,CAACM,OAAO,CAAC,CAAC,CAAC;;QAEzF;QACA,MAAMe,YAAW,GAAI;UACnB3B,OAAO;UACPc,YAAY;UACZc,OAAO,EAAE,GAAGA,OAAO,mBAAmB,IAAI,CAACzB,WAAW,CAACC,KAAK,CAAC,aAAasB,KAAK,EAAE;UACjFtF,SAAS,EAAE,IAAIG,IAAI,CAAC,CAAC,CAACsF,WAAW,CAAC,CAAC;UACnCzB,KAAK;UAAG;UACRsB,KAAK,CAAG;QACV,CAAC;;QAED;QACA,MAAMlC,oBAAmB,GAAI,sBAAsBsB,YAAY,EAAE;QACjE,IAAIrB,aAAY,GAAIC,IAAI,CAACC,KAAK,CAAC5D,YAAY,CAAC6D,OAAO,CAACJ,oBAAoB,CAAC,KAAK,EAAE;QAChFC,aAAa,CAACrB,IAAI,CAACuD,YAAY,CAAC;QAChC5F,YAAY,CAACC,OAAO,CAACwD,oBAAoB,EAAEE,IAAI,CAACO,SAAS,CAACR,aAAa,CAAC,CAAC;;QAEzE;QACA,IAAI,IAAI,CAAClH,EAAC,IAAK,IAAI,CAACA,EAAE,CAACuJ,UAAS,KAAMC,SAAS,CAACC,IAAI,EAAE;UACpD5C,OAAO,CAACC,GAAG,CAAC,oDAAoD,EAAEW,OAAO,CAAC;;UAE1E;UACA,IAAI,CAACzH,EAAE,CAAC0J,IAAI,CAACvC,IAAI,CAACO,SAAS,CAAC;YAC1BiC,IAAI,EAAE,mBAAmB;YACzBC,MAAM,EAAE,gBAAgB;YACxBR,YAAY,EAAEA,YAAY;YAC1BS,WAAW,EAAEtB;UACf,CAAC,CAAC,CAAC;;UAEH;UACA,IAAI,CAACvI,EAAE,CAAC0J,IAAI,CAACvC,IAAI,CAACO,SAAS,CAAC;YAC1BiC,IAAI,EAAE,gBAAgB;YACtB8B,QAAQ,EAAEhE,OAAO;YACjB1E,aAAa,EAAEwF,YAAY;YAC3BmD,MAAM,EAAErC,OAAO;YACfxF,SAAS,EAAE,IAAIG,IAAI,CAAC,CAAC,CAACsF,WAAW,CAAC;UACpC,CAAC,CAAC,CAAC;QACL;;QAEA;QACAQ,MAAM,CAACC,aAAa,CAAC,IAAIC,KAAK,CAAC,eAAe,CAAC,CAAC;;QAEhD;QACA,IAAI,CAACzJ,mBAAkB,GAAI,UAAUkH,OAAO,oBAAoB;QAChE,IAAI,CAACjH,iBAAgB,GAAI,qBAAqB;QAC9C,IAAI,CAACkD,gBAAgB,CAAC,CAAC;MACzB,CAAC,EACAuG,KAAK,CAAC/H,KAAI,IAAK;QACd2E,OAAO,CAAC3E,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;QAC9C,IAAI,CAACN,UAAS,GAAI,KAAK;QACvB8G,KAAK,CAAC,0CAA0C,CAAC;MACnD,CAAC,CAAC;IACN,CAAC;IAED;IACAkD,oBAAoBA,CAAA,EAAG;MACrB,IAAI,IAAI,CAAC1L,oBAAmB,KAAM,IAAI,EAAE;QACtCsD,YAAY,CAACC,OAAO,CAAC,wBAAwB,IAAI,CAACvD,oBAAoB,EAAE,EAAE,IAAI,CAACC,oBAAoB,CAAC;MACtG;IACF,CAAC;IAED;IACA0L,0BAA0BA,CAACpE,OAAO,EAAEc,YAAY,EAAEV,KAAK,EAAE;MACvD,MAAMsB,KAAI,GAAItB,KAAK,CAACK,MAAM,CAAC,CAACC,GAAG,EAAElF,IAAI,KAAKkF,GAAE,GAAIlF,IAAI,CAACmF,KAAI,GAAInF,IAAI,CAAC8E,QAAQ,EAAE,CAAC,CAAC,CAACM,OAAO,CAAC,CAAC,CAAC;MAEzF,MAAMe,YAAW,GAAI;QACnB3B,OAAO;QACPc,YAAY;QACZc,OAAO,EAAE,6FAA6F,IAAI,CAACzB,WAAW,CAACC,KAAK,CAAC,aAAasB,KAAK,EAAE;QACjJtF,SAAS,EAAE,IAAIG,IAAI,CAAC,CAAC,CAACsF,WAAW,CAAC,CAAC;QACnCzB,KAAK;QACLsB;MACF,CAAC;;MAED;MACA,MAAMlC,oBAAmB,GAAI,sBAAsBsB,YAAY,EAAE;MACjE,IAAIrB,aAAY,GAAIC,IAAI,CAACC,KAAK,CAAC5D,YAAY,CAAC6D,OAAO,CAACJ,oBAAoB,CAAC,KAAK,EAAE;;MAEhF;MACAC,aAAa,CAACrB,IAAI,CAACuD,YAAY,CAAC;;MAEhC;MACAlC,aAAa,CAACX,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK;QAC3B,MAAMqF,KAAI,GAAI,IAAI9H,IAAI,CAACwC,CAAC,CAAC3C,SAAS,CAAC;QACnC,MAAMkI,KAAI,GAAI,IAAI/H,IAAI,CAACyC,CAAC,CAAC5C,SAAS,CAAC;QACnC,OAAOkI,KAAI,GAAID,KAAK;MACtB,CAAC,CAAC;MAEFtI,YAAY,CAACC,OAAO,CAACwD,oBAAoB,EAAEE,IAAI,CAACO,SAAS,CAACR,aAAa,CAAC,CAAC;;MAEzE;MACA,IAAI,CAACtG,gBAAgB,CAAC6G,OAAO,IAAI,IAAI;MACrC;MACA,IAAI,CAAC7G,gBAAe,GAAI;QAAE,GAAG,IAAI,CAACA;MAAiB,CAAC;;MAEpD;MACA4C,YAAY,CAACC,OAAO,CAAC,kBAAkB,EAAE0D,IAAI,CAACO,SAAS,CAAC,IAAI,CAAC9G,gBAAgB,CAAC,CAAC;;MAE/E;MACA,IAAI,IAAI,CAACZ,EAAC,IAAK,IAAI,CAACA,EAAE,CAACuJ,UAAS,KAAMC,SAAS,CAACC,IAAI,EAAE;QACpD,IAAI,CAACzJ,EAAE,CAAC0J,IAAI,CAACvC,IAAI,CAACO,SAAS,CAAC;UAC1BiC,IAAI,EAAE,mBAAmB;UACzBC,MAAM,EAAE,aAAa;UACrBR,YAAY,EAAEA,YAAY;UAC1BS,WAAW,EAAEtB;QACf,CAAC,CAAC,CAAC;MACL;;MAEA;MACA,IAAI,CAACnI,gBAAe,GAAI,IAAI;MAC5BuD,UAAU,CAAC,MAAM;QACf,IAAI,CAACvD,gBAAe,GAAI,KAAK;MAC/B,CAAC,EAAE,IAAI,CAAC;IACV,CAAC;IAED;IACA4L,gBAAgBA,CAAA,EAAG;MACjB,IAAI,CAACtL,cAAa,GAAI,CAAC,IAAI,CAACA,cAAc;IAC5C,CAAC;IAED;IACAuL,aAAaA,CAAA,EAAG;MACd,IAAI,CAACtL,aAAY,GAAI,CAAC,IAAI,CAACA,aAAa;MACxC;MACA,IAAI,IAAI,CAACA,aAAa,EAAE;QACtBuL,QAAQ,CAACrD,IAAI,CAACsD,KAAK,CAACC,QAAO,GAAI,QAAQ;MACzC,OAAO;QACLF,QAAQ,CAACrD,IAAI,CAACsD,KAAK,CAACC,QAAO,GAAI,EAAE;MACnC;IACF,CAAC;IAED;IACAC,YAAYA,CAAA,EAAG;MACb,IAAI,CAAC1L,aAAY,GAAI,KAAK;MAC1BuL,QAAQ,CAACrD,IAAI,CAACsD,KAAK,CAACC,QAAO,GAAI,EAAE;IACnC,CAAC;IAED;IACAE,kBAAkBA,CAAA,EAAG;MACnB;IAAA,CACD;IAED;IACAC,0BAA0BA,CAAC9E,OAAO,EAAE;MAClC,IAAI,CAAC5G,sBAAqB,GAAI4G,OAAO;IACvC,CAAC;IAED+E,iBAAiBA,CAAA,EAAG;MAClB,MAAM/J,KAAI,GAAI,IAAI,CAAC3C,MAAM,CAAC8K,IAAI,CAACQ,CAAA,IAAKA,CAAC,CAACxI,EAAC,KAAM,IAAI,CAAC/B,sBAAsB,CAAC;MACzE,IAAI4B,KAAK,EAAE;QACT,IAAI,CAAC6F,eAAe,CAAC7F,KAAK,CAACG,EAAE,EAAEH,KAAK,CAACM,aAAa,EAAEN,KAAK,CAACoF,KAAK,CAAC;MAClE;MACA,IAAI,CAAChH,sBAAqB,GAAI,IAAI;IACpC,CAAC;IAED4L,gBAAgBA,CAAA,EAAG;MACjB,IAAI,CAAC5L,sBAAqB,GAAI,IAAI;IACpC,CAAC;IAED6L,kBAAkBA,CAAA,EAAG;MACnB,IAAI,CAAC5L,gBAAe,GAAI,CAAC,IAAI,CAACA,gBAAgB;IAChD,CAAC;IAED6L,cAAcA,CAAA,EAAG;MACf,IAAI,CAACC,YAAW,GAAI,CAAC,IAAI,CAACA,YAAY;MACtC;MACA,IAAI,IAAI,CAACA,YAAY,EAAE;QACrB,IAAI,CAAC9K,YAAW,GAAI;UAClBC,eAAe,EAAE,EAAE;UACnBC,WAAW,EAAE,EAAE;UACfC,eAAe,EAAE,EAAE;UACnBC,KAAK,EAAE,EAAE;UACTC,OAAO,EAAE;QACX,CAAC;MACH;IACF,CAAC;IAED0K,mBAAmBA,CAAA,EAAG;MACpB;MACA,IAAI,CAAC/K,YAAY,CAACI,KAAI,GAAI,EAAE;MAC5B,IAAI,CAACJ,YAAY,CAACK,OAAM,GAAI,EAAE;;MAE9B;MACA,MAAM2K,cAAa,GAAI,UAAU,EAAE;;MAEnC,IAAI,IAAI,CAAChL,YAAY,CAACC,eAAc,KAAM+K,cAAc,EAAE;QACxD,IAAI,CAAChL,YAAY,CAACI,KAAI,GAAI,+BAA+B;QACzD;MACF;;MAEA;MACA,IAAI,IAAI,CAACJ,YAAY,CAACE,WAAW,CAAC+E,MAAK,GAAI,CAAC,EAAE;QAC5C,IAAI,CAACjF,YAAY,CAACI,KAAI,GAAI,4CAA4C;QACtE;MACF;;MAEA;MACA,IAAI,IAAI,CAACJ,YAAY,CAACE,WAAU,KAAM,IAAI,CAACF,YAAY,CAACG,eAAe,EAAE;QACvE,IAAI,CAACH,YAAY,CAACI,KAAI,GAAI,4BAA4B;QACtD;MACF;;MAEA;MACAsB,YAAY,CAACC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC3B,YAAY,CAACE,WAAW,CAAC;;MAEpE;MACA,IAAI,CAACF,YAAY,CAACK,OAAM,GAAI,gCAAgC;;MAE5D;MACAwB,UAAU,CAAC,MAAM;QACf,IAAI,CAAC7B,YAAY,CAACC,eAAc,GAAI,EAAE;QACtC,IAAI,CAACD,YAAY,CAACE,WAAU,GAAI,EAAE;QAClC,IAAI,CAACF,YAAY,CAACG,eAAc,GAAI,EAAE;MACxC,CAAC,EAAE,IAAI,CAAC;IACV,CAAC;IAED,MAAM8K,eAAeA,CAAA,EAAG;MACtB,IAAI;QACF,MAAM/G,QAAO,GAAI,MAAMC,KAAK,CAAC,kCAAkC,CAAC;QAChE,MAAMpG,IAAG,GAAI,MAAMmG,QAAQ,CAACE,IAAI,CAAC,CAAC;QAClCW,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEjH,IAAI,CAAC,EAAE;;QAE1C,IAAIA,IAAI,CAACsC,OAAM,IAAKgE,KAAK,CAACC,OAAO,CAACvG,IAAI,CAACgI,KAAK,CAAC,EAAE;UAC7C;UACA,IAAI,CAAC7G,UAAS,GAAInB,IAAI,CAACgI,KAAK,CAACC,GAAG,CAAC7E,IAAG,KAAM;YACxCL,EAAE,EAAEK,IAAI,CAAC+J,OAAO;YAAE;YAClB9J,IAAI,EAAED,IAAI,CAACgK,SAAS;YACpB5J,QAAQ,EAAEJ,IAAI,CAACI,QAAQ;YACvB0E,QAAQ,EAAE9E,IAAI,CAAC8E,QAAQ;YACvBmF,eAAe,EAAEjK,IAAI,CAACiK;UACxB,CAAC,CAAC,CAAC;;UAEH;UACA,IAAI,CAAC3L,gBAAe,GAAI,CAAC,GAAG,IAAI4L,GAAG,CAAC,IAAI,CAACnM,UAAU,CAAC8G,GAAG,CAAC7E,IAAG,IAAKA,IAAI,CAACI,QAAQ,CAAC,CAAC,CAAC;UAChFwD,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAE,IAAI,CAAC9F,UAAU,CAAC,EAAE;QAC1D,OAAO;UACL6F,OAAO,CAAC3E,KAAK,CAAC,+BAA+B,EAAErC,IAAI,CAAC;QACtD;MACF,EAAE,OAAOqC,KAAK,EAAE;QACd2E,OAAO,CAAC3E,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACrD;IACF,CAAC;IAEDkL,cAAcA,CAACnK,IAAI,EAAE;MACnB,IAAIA,IAAI,CAAC8E,QAAO,KAAM,CAAC,EAAE,OAAO,yBAAyB;MACzD,IAAI9E,IAAI,CAAC8E,QAAO,IAAK,MAAM,EAAE,OAAO,qBAAqB;MACzD,IAAI9E,IAAI,CAAC8E,QAAO,IAAK9E,IAAI,CAACiK,eAAe,EAAE,OAAO,WAAW;MAC7D,OAAO,UAAU;IACnB,CAAC;IAEDG,mBAAmBA,CAACpK,IAAI,EAAE;MACxB,IAAIA,IAAI,CAAC8E,QAAO,KAAM,CAAC,EAAE,OAAO,iBAAiB;MACjD,IAAI9E,IAAI,CAAC8E,QAAO,IAAK,MAAM,EAAE,OAAO,gBAAgB;MACpD,IAAI9E,IAAI,CAAC8E,QAAO,IAAK9E,IAAI,CAACiK,eAAe,EAAE,OAAO,YAAY;MAC9D,OAAO,WAAW;IACpB,CAAC;IAEDI,oBAAoBA,CAACrK,IAAI,EAAE;MACzB4D,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAE7D,IAAI,CAAC,EAAE;MAC9C,IAAI,CAAC/B,YAAW,GAAI+B,IAAI;MACxB,IAAI,CAAClC,oBAAmB,GAAI,IAAI;MAChC,IAAI,CAACK,mBAAkB,GAAI,CAAC;MAC5B,IAAI,CAACD,iBAAgB,GAAI,KAAK;MAC9B,IAAI,CAACE,iBAAgB,GAAI,EAAE;IAC7B,CAAC;IAEDkM,qBAAqBA,CAAA,EAAG;MACtB,IAAI,CAACxM,oBAAmB,GAAI,KAAK;MACjC,IAAI,CAACG,YAAW,GAAI,IAAI;MACxB,IAAI,CAACE,mBAAkB,GAAI,CAAC;MAC5B,IAAI,CAACC,iBAAgB,GAAI,EAAE;IAC7B,CAAC;IAED,MAAMmM,iBAAiBA,CAAA,EAAG;MACxB;MACA,IAAI,CAAC,IAAI,CAACtM,YAAW,IAAK,CAAC,IAAI,CAACA,YAAY,CAAC0B,EAAE,EAAE;QAC/C8F,KAAK,CAAC,kBAAkB,CAAC;QACzB;MACF;MAEA,IAAI,CAAC,IAAI,CAACvH,iBAAiB,EAAE;QAC3BuH,KAAK,CAAC,yBAAyB,CAAC;QAChC;MACF;MAEA,IAAI;QACF,IAAI+E,WAAU,GAAI,CAAC,CAAC;;QAEpB;QACA,IAAI,IAAI,CAACtM,iBAAgB,KAAM,UAAU,EAAE;UACzC;UACAsM,WAAU,GAAI;YACZ7D,MAAM,EAAE,KAAK;YACb7B,QAAQ,EAAE,CAAC;YACX2D,MAAM,EAAE,IAAI,CAACrK,iBAAgB,IAAK;UACpC,CAAC;QACH,OAAO,IAAI,IAAI,CAACF,iBAAgB,KAAM,SAAS,EAAE;UAC/C;UACAsM,WAAU,GAAI;YACZ7D,MAAM,EAAE,KAAK;YACb7B,QAAQ,EAAE,MAAM;YAAE;YAClB2D,MAAM,EAAE,IAAI,CAACrK,iBAAgB,IAAK;UACpC,CAAC;QACH,OAAO;UACL;UACA,IAAI,CAAC,IAAI,CAACD,mBAAkB,IAAK,IAAI,CAACA,mBAAkB,IAAK,CAAC,EAAE;YAC9DsH,KAAK,CAAC,gDAAgD,CAAC;YACvD;UACF;;UAEA;UACA,IAAI,IAAI,CAACvH,iBAAgB,KAAM,UAAS,IAAK,IAAI,CAACC,mBAAkB,GAAI,IAAI,CAACF,YAAY,CAAC6G,QAAQ,EAAE;YAClGW,KAAK,CAAC,uCAAuC,CAAC;YAC9C;UACF;UAEA+E,WAAU,GAAI;YACZ7D,MAAM,EAAE,IAAI,CAACzI,iBAAiB;YAC9B4G,QAAQ,EAAEpB,QAAQ,CAAC,IAAI,CAACvF,mBAAmB,CAAC;YAC5CsK,MAAM,EAAE,IAAI,CAACrK,iBAAgB,IAAK;UACpC,CAAC;QACH;QAEAwF,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAE2G,WAAW,CAAC;QAE5C,MAAMzH,QAAO,GAAI,MAAMC,KAAK,CAAC,oCAAoC,IAAI,CAAC/E,YAAY,CAAC0B,EAAE,SAAS,EAAE;UAC9F+F,MAAM,EAAE,KAAK;UACbC,OAAO,EAAE;YACP,cAAc,EAAE;UAClB,CAAC;UACDC,IAAI,EAAE1B,IAAI,CAACO,SAAS,CAAC+F,WAAW;QAClC,CAAC,CAAC;QAEF,MAAM5N,IAAG,GAAI,MAAMmG,QAAQ,CAACE,IAAI,CAAC,CAAC;QAElC,IAAI,CAACF,QAAQ,CAACgD,EAAE,EAAE;UAChB,MAAM,IAAID,KAAK,CAAClJ,IAAI,CAACqJ,MAAK,IAAK,wBAAwB,CAAC;QAC1D;QAEA,IAAIrJ,IAAI,CAACsC,OAAO,EAAE;UAChBuG,KAAK,CAAC,6BAA6B,CAAC;UACpC,IAAI,CAAC6E,qBAAqB,CAAC,CAAC;UAC5B,MAAM,IAAI,CAACR,eAAe,CAAC,CAAC,EAAE;QAChC,OAAO;UACL,MAAM,IAAIhE,KAAK,CAAClJ,IAAI,CAACwJ,OAAM,IAAK,wBAAwB,CAAC;QAC3D;MACF,EAAE,OAAOnH,KAAK,EAAE;QACd2E,OAAO,CAAC3E,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;QAC7CwG,KAAK,CAACxG,KAAK,CAACmH,OAAM,IAAK,2CAA2C,CAAC;MACrE;IACF,CAAC;IAEDqE,aAAaA,CAAA,EAAG;MACd;MACA,MAAMC,KAAI,GAAI,QAAQ7D,MAAM,CAAC8D,QAAQ,CAACC,QAAQ,iBAAiB;;MAE/D;MACA,IAAI,IAAI,CAAC7N,EAAE,EAAE;QACX,IAAI;UACF,IAAI,CAACA,EAAE,CAAC8N,KAAK,CAAC,CAAC;QACjB,EAAE,OAAOrF,CAAC,EAAE;UACV5B,OAAO,CAAC3E,KAAK,CAAC,mCAAmC,EAAEuG,CAAC,CAAC;QACvD;MACF;MAEA5B,OAAO,CAACC,GAAG,CAAC,sCAAsC,CAAC;MACnD,IAAI,CAAC9G,EAAC,GAAI,IAAIwJ,SAAS,CAACmE,KAAK,CAAC;MAE9B,IAAI,CAAC3N,EAAE,CAAC+N,MAAK,GAAI,MAAM;QACrBlH,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC;QAClC,IAAI,CAAC7G,WAAU,GAAI,IAAI;;QAEvB;QACA,IAAI,IAAI,CAAC4B,YAAY,EAAEmM,aAAa,CAAC,IAAI,CAACnM,YAAY,CAAC;QACvD,IAAI,CAACA,YAAW,GAAIoM,WAAW,CAAC,MAAM;UACpC,IAAI,IAAI,CAACjO,EAAC,IAAK,IAAI,CAACA,EAAE,CAACuJ,UAAS,KAAMC,SAAS,CAACC,IAAI,EAAE;YACpD,IAAI,CAACzJ,EAAE,CAAC0J,IAAI,CAACvC,IAAI,CAACO,SAAS,CAAC;cAAEiC,IAAI,EAAE;YAAO,CAAC,CAAC,CAAC;UAChD;QACF,CAAC,EAAE,KAAK,CAAC,EAAE;MACb,CAAC;MAED,IAAI,CAAC3J,EAAE,CAACkO,SAAQ,GAAI,MAAOC,KAAK,IAAK;QACnC,IAAI;UACF,MAAMtO,IAAG,GAAIsH,IAAI,CAACC,KAAK,CAAC+G,KAAK,CAACtO,IAAI,CAAC;UACnCgH,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAEjH,IAAI,CAAC;UAEhD,IAAIA,IAAI,CAAC8J,IAAG,KAAM,WAAW,EAAE;YAC7B;YACA,IAAI9J,IAAI,CAAC4C,KAAK,CAAC6D,MAAK,KAAM,SAAS,EAAE;cACnC;cACA,IAAI,CAACxG,MAAM,CAAC+F,IAAI,CAAChG,IAAI,CAAC4C,KAAK,CAAC;;cAE5B;cACA,IAAI,CAAC3C,MAAM,CAACyG,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK;gBACzB,MAAMC,GAAE,GAAIC,QAAQ,CAACH,CAAC,CAAC5D,EAAE,CAAC;gBAC1B,MAAMgE,GAAE,GAAID,QAAQ,CAACF,CAAC,CAAC7D,EAAE,CAAC;gBAC1B,OAAO8D,GAAE,GAAIE,GAAG,EAAE;cACpB,CAAC,CAAC;YACJ;UACF,OAAO,IAAI/G,IAAI,CAAC8J,IAAG,KAAM,qBAAqB,EAAE;YAC9C;YACA,IAAI9J,IAAI,CAACyG,MAAK,KAAM,SAAS,EAAE;cAC7B,IAAI,CAACxG,MAAK,GAAI,IAAI,CAACA,MAAM,CAAC0C,MAAM,CAACC,KAAI,IAAKA,KAAK,CAACG,EAAC,KAAM/C,IAAI,CAAC4L,QAAQ,CAAC;;cAErE;cACA,IAAI,IAAI,CAAC7K,gBAAgB,CAACf,IAAI,CAAC4L,QAAQ,CAAC,EAAE;gBACxC,OAAO,IAAI,CAAC7K,gBAAgB,CAACf,IAAI,CAAC4L,QAAQ,CAAC;gBAC3C;gBACAjI,YAAY,CAACC,OAAO,CAAC,kBAAkB,EAAE0D,IAAI,CAACO,SAAS,CAAC,IAAI,CAAC9G,gBAAgB,CAAC,CAAC;cACjF;YACF;UACF,OAAO,IAAIf,IAAI,CAAC8J,IAAG,KAAM,oBAAoB,EAAE;YAC7C;YACA,IAAI9J,IAAI,CAAC+J,MAAK,KAAM,qBAAqB,EAAE;cACzC;cACA,MAAMR,YAAW,GAAIvJ,IAAI,CAACuJ,YAAY;cACtC,MAAM3B,OAAM,GAAI2B,YAAY,CAAC3B,OAAO;cAEpC,IAAI2B,YAAY,CAACC,OAAO,CAACvG,QAAQ,CAAC,UAAU,CAAC,EAAE;gBAC7C;gBACA,MAAMoI,UAAS,GAAI,IAAI,CAACpL,MAAM,CAACqL,SAAS,CAACC,CAAA,IAAKA,CAAC,CAACxI,EAAC,KAAM6E,OAAO,CAAC;gBAC/D,IAAIyD,UAAS,KAAM,CAAC,CAAC,EAAE;kBACrB;kBACA,MAAMG,YAAW,GAAI;oBACnB,GAAG,IAAI,CAACvL,MAAM,CAACoL,UAAU,CAAC;oBAC1BrD,KAAK,EAAEuB,YAAY,CAACvB,KAAK;oBACzBoD,iBAAiB,EAAE,KAAI,CAAE;kBAC3B,CAAC;;kBAED;kBACA,IAAI,CAACnL,MAAK,GAAI,CACZ,GAAG,IAAI,CAACA,MAAM,CAACwL,KAAK,CAAC,CAAC,EAAEJ,UAAU,CAAC,EACnCG,YAAY,EACZ,GAAG,IAAI,CAACvL,MAAM,CAACwL,KAAK,CAACJ,UAAS,GAAI,CAAC,EACpC;;kBAED;kBACA,IAAI,CAAC3K,mBAAkB,GAAI,sDAAsDkH,OAAO,EAAE;kBAC1F,IAAI,CAACjH,iBAAgB,GAAI,mBAAmB;kBAC5C,IAAI,CAACkD,gBAAgB,CAAC,CAAC;gBACzB;cACF,OAAO,IAAI0F,YAAY,CAACC,OAAO,CAACvG,QAAQ,CAAC,UAAU,CAAC,EAAE;gBACpD;gBACA,IAAI,CAAChD,MAAK,GAAI,IAAI,CAACA,MAAM,CAAC0C,MAAM,CAAC4I,CAAA,IAAKA,CAAC,CAACxI,EAAC,KAAM6E,OAAO,CAAC;;gBAEvD;gBACA,IAAI,CAAClH,mBAAkB,GAAI,sDAAsDkH,OAAO,EAAE;gBAC1F,IAAI,CAACjH,iBAAgB,GAAI,qBAAqB;gBAC9C,IAAI,CAACkD,gBAAgB,CAAC,CAAC;cACzB;;cAEA;cACA0F,YAAY,CAACgF,SAAQ,GAAI,IAAI;;cAE7B;cACA,MAAMC,qBAAoB,GAAI,0BAA0B;cACxD,IAAIC,kBAAiB,GAAInH,IAAI,CAACC,KAAK,CAAC5D,YAAY,CAAC6D,OAAO,CAACgH,qBAAqB,CAAC,KAAK,EAAE;;cAEtF;cACA,MAAME,iBAAgB,GAAID,kBAAkB,CAACnD,SAAS,CAAC3D,CAAA,IACrDA,CAAC,CAACgH,mBAAkB,IAAKhH,CAAC,CAACC,OAAM,KAAMA,OAAM,IAAK,CAACD,CAAC,CAAC4G,SACvD,CAAC;cAED,IAAIG,iBAAgB,KAAM,CAAC,CAAC,EAAE;gBAC5BD,kBAAkB,CAACC,iBAAiB,CAAC,CAACH,SAAQ,GAAI,IAAI;gBACtD5K,YAAY,CAACC,OAAO,CAAC4K,qBAAqB,EAAElH,IAAI,CAACO,SAAS,CAAC4G,kBAAkB,CAAC,CAAC;cACjF;YACF;UACF,OAAO,IAAIzO,IAAI,CAAC8J,IAAG,KAAM,mBAAmB,EAAE;YAC5C;YACA,MAAM;cAAElC,OAAO;cAAEgH;YAAS,IAAI5O,IAAI;YAElC,IAAI4O,QAAQ,EAAE;cACZ5H,OAAO,CAACC,GAAG,CAAC,0CAA0CW,OAAO,6CAA6C,CAAC;;cAE3G;cACA,MAAMiH,aAAY,GAAI,IAAI,CAAC5O,MAAM,CAACiH,MAAK,KAAM,CAAC;;cAE9C;cACA,IAAI;gBACF,MAAM4H,YAAW,GAAIzC,QAAQ,CAAC0C,aAAa,CAAC,8BAA8BnH,OAAO,IAAI,CAAC;gBACtF,IAAIkH,YAAY,EAAE;kBAChB9H,OAAO,CAACC,GAAG,CAAC,yDAAyD,CAAC;;kBAEtE;kBACA6H,YAAY,CAACE,SAAS,CAACC,MAAM,CAAC,wBAAwB,CAAC;kBACvDH,YAAY,CAACxC,KAAK,CAAC4C,eAAc,GAAI,SAAS;kBAC9CJ,YAAY,CAACxC,KAAK,CAAC6C,MAAK,GAAI,gBAAgB;kBAC5CL,YAAY,CAACxC,KAAK,CAAC8C,SAAQ,GAAI,8BAA8B;;kBAE7D;kBACA,MAAM9C,KAAI,GAAID,QAAQ,CAACgD,aAAa,CAAC,OAAO,CAAC;kBAC7C/C,KAAK,CAACvJ,EAAC,GAAI,aAAa6E,OAAO,EAAE;kBACjC0E,KAAK,CAACgD,WAAU,GAAI;iDACW1H,OAAO;;;iDAGPA,OAAO;;;iDAGPA,OAAO;;;mBAGrC;kBACDyE,QAAQ,CAACkD,IAAI,CAACC,WAAW,CAAClD,KAAK,CAAC;;kBAEhC;kBACA,MAAMmD,gBAAe,GAAIX,YAAY,CAACY,gBAAgB,CAAC,GAAG,CAAC;kBAC3D,KAAK,MAAMC,SAAQ,IAAKF,gBAAgB,EAAE;oBACxC,IAAIE,SAAS,CAACC,SAAS,CAAC3M,QAAQ,CAAC,SAAS,CAAC,EAAE;sBAC3C0M,SAAS,CAACC,SAAQ,GAAI,kCAAkC;sBACxD;oBACF;kBACF;gBACF;;gBAEA;gBACA,IAAIf,aAAa,EAAE;kBACjB7H,OAAO,CAACC,GAAG,CAAC,gDAAgD,CAAC;;kBAE7D;kBACA,MAAM4I,eAAc,GAAIxD,QAAQ,CAAC0C,aAAa,CAAC,mBAAmB,CAAC;kBACnE,IAAI,CAACc,eAAe,EAAE;oBACpB7I,OAAO,CAAC3E,KAAK,CAAC,4BAA4B,CAAC;oBAC3C;kBACF;;kBAEA;kBACA,MAAMO,KAAI,GAAI,IAAI,CAAC3C,MAAM,CAAC8K,IAAI,CAACQ,CAAA,IAAKA,CAAC,CAACxI,EAAC,KAAM6E,OAAO,CAAC;kBACrD,IAAI,CAAChF,KAAK,EAAE;oBACVoE,OAAO,CAAC3E,KAAK,CAAC,yBAAyB,CAAC;oBACxC;kBACF;;kBAEA;kBACA,MAAMmJ,YAAW,GAAI;oBAAE,GAAG5I,KAAK;oBAAEwI,iBAAiB,EAAE;kBAAM,CAAC;;kBAE3D;kBACA,MAAM0E,UAAS,GAAID,eAAe,CAACd,aAAa,CAAC,cAAc,CAAC;kBAChE,IAAI,CAACe,UAAU,EAAE;oBACf9I,OAAO,CAAC3E,KAAK,CAAC,uBAAuB,CAAC;oBACtC;kBACF;;kBAEA;kBACA,MAAM0N,gBAAe,GAAI;6DACkBvE,YAAY,CAACzI,EAAE;;wCAEpCyI,YAAY,CAACzI,EAAE;wDACCyI,YAAY,CAACtI,aAAa;sDAC5BsI,YAAY,CAAC/E,MAAM;0DACf,IAAI,CAAC1C,OAAO,CAACyH,YAAY,CAACwE,UAAU,CAAC;;;;;8BAKjExE,YAAY,CAACxD,KAAK,CAACC,GAAG,CAAC7E,IAAG,IAC1B,OAAOA,IAAI,CAACC,IAAI,OAAOD,IAAI,CAACmF,KAAK,MAAMnF,IAAI,CAAC8E,QAAQ,OACtD,CAAC,CAACC,IAAI,CAAC,EAAE,CAAC;;;;;sDAKgB,IAAI,CAACC,mBAAmB,CAACoD,YAAY,CAACxD,KAAK,CAAC;;;;;;0HAMwBwD,YAAY,CAACzI,EAAE;gEACzE,CAAC,IAAI,CAAChC,gBAAgB,CAACyK,YAAY,CAACzI,EAAE,IAAI,UAAS,GAAI,EAAE;4BAC7F,CAAC,IAAI,CAAChC,gBAAgB,CAACyK,YAAY,CAACzI,EAAE,IAAI,UAAS,GAAI,EAAE;;;;;;8GAMyByI,YAAY,CAACzI,EAAE,oBAAoByI,YAAY,CAACtI,aAAa;;;;;;;iHAO1DsI,YAAY,CAACzI,EAAE;;;;;;;mBAO7G;;kBAED;kBACA+M,UAAU,CAACF,SAAQ,GAAIG,gBAAgB;;kBAEvC;kBACA,IAAI,CAAC,IAAI,CAACE,qBAAqB,EAAE;oBAC/B5D,QAAQ,CAAC6D,gBAAgB,CAAC,yBAAyB,EAAGtH,CAAC,IAAK;sBAC1D,IAAI,CAAC8D,0BAA0B,CAAC9D,CAAC,CAACS,MAAM,CAACzB,OAAO,CAAC;oBACnD,CAAC,CAAC;oBAEFyE,QAAQ,CAAC6D,gBAAgB,CAAC,aAAa,EAAGtH,CAAC,IAAK;sBAC9C,IAAI,CAACoD,0BAA0B,CAACpD,CAAC,CAACS,MAAM,CAACzB,OAAO,EAAEgB,CAAC,CAACS,MAAM,CAACX,YAAY,EAAE8C,YAAY,CAACxD,KAAK,CAAC;oBAC9F,CAAC,CAAC;oBAEFqE,QAAQ,CAAC6D,gBAAgB,CAAC,gBAAgB,EAAGtH,CAAC,IAAK;sBACjD;sBACA,MAAMhG,KAAI,GAAI,IAAI,CAAC3C,MAAM,CAAC8K,IAAI,CAACQ,CAAA,IAAKA,CAAC,CAACxI,EAAC,KAAM6F,CAAC,CAACS,MAAM,CAACzB,OAAO,CAAC;sBAC9D,IAAIhF,KAAK,EAAE;wBACT,IAAI,CAACyH,iBAAiB,CAACzH,KAAK,CAAC;sBAC/B;oBACF,CAAC,CAAC;oBAEF,IAAI,CAACqN,qBAAoB,GAAI,IAAI;kBACnC;;kBAEA;kBACA,IAAI,CAAChQ,MAAK,GAAI,CAACuL,YAAY,CAAC;gBAC9B;cACF,EAAE,OAAOnJ,KAAK,EAAE;gBACd2E,OAAO,CAAC3E,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;cAC/D;;cAEA;cACA,IAAI,CAAC3B,mBAAkB,GAAI,8DAA8DkH,OAAO,EAAE;cAClG,IAAI,CAACjH,iBAAgB,GAAI,mBAAmB;cAC5C,IAAI,CAACkD,gBAAgB,CAAC,CAAC;;cAEvB;cACAuC,KAAK,CAAC,gCAAgCwB,OAAO,eAAe,EAAE;gBAC5DkB,MAAM,EAAE,KAAK;gBACbC,OAAO,EAAE;kBAAE,cAAc,EAAE;gBAAmB,CAAC;gBAC/CC,IAAI,EAAE1B,IAAI,CAACO,SAAS,CAAC;kBACnBpB,MAAM,EAAE,SAAS;kBACjB2E,iBAAiB,EAAE;gBACrB,CAAC;cACH,CAAC,EACAnC,IAAI,CAAC9C,QAAO,IAAKA,QAAQ,CAACE,IAAI,CAAC,CAAC,EAChC4C,IAAI,CAACjJ,IAAG,IAAK;gBACZgH,OAAO,CAACC,GAAG,CAAC,gDAAgD,EAAEjH,IAAI,CAAC;;gBAEnE;gBACA8D,UAAU,CAAC,MAAM;kBACf,IAAI,CAACqM,kBAAkB,CAAC,CAAC;gBAC3B,CAAC,EAAE,IAAI,CAAC;cACV,CAAC,EACA/F,KAAK,CAACgG,GAAE,IAAK;gBACZpJ,OAAO,CAAC3E,KAAK,CAAC,kDAAkD,EAAE+N,GAAG,CAAC;;gBAEtE;gBACA,IAAIvB,aAAa,EAAE;kBACjB/K,UAAU,CAAC,MAAMiK,QAAQ,CAACsC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC;gBAC3C;cACF,CAAC,CAAC;YACJ,OAAO;cACL;cACA,IAAI,CAACpQ,MAAK,GAAI,IAAI,CAACA,MAAM,CAAC0C,MAAM,CAAC4I,CAAA,IAAKA,CAAC,CAACxI,EAAC,KAAM6E,OAAO,CAAC;;cAEvD;cACA,IAAI,CAAClH,mBAAkB,GAAI,sDAAsDkH,OAAO,EAAE;cAC1F,IAAI,CAACjH,iBAAgB,GAAI,qBAAqB;cAC9C,IAAI,CAACkD,gBAAgB,CAAC,CAAC;YACzB;UACF,OAAO,IAAI7D,IAAI,CAAC8J,IAAG,KAAM,cAAc,EAAE;YACvC;YACA,MAAMwG,SAAQ,GAAI,IAAI,CAACnP,UAAU,CAAC4J,IAAI,CAAC3H,IAAG,IAAKA,IAAI,CAACL,EAAC,KAAM/C,IAAI,CAACmN,OAAO,CAAC;YACxE,IAAImD,SAAS,EAAE;cACbA,SAAS,CAACpI,QAAO,GAAIlI,IAAI,CAACuQ,YAAY;cACtCD,SAAS,CAACjD,eAAc,GAAIrN,IAAI,CAACqN,eAAe;;cAEhD;cACA,IAAI,CAAC,IAAI,CAAC3L,gBAAgB,CAACuB,QAAQ,CAACjD,IAAI,CAACwD,QAAQ,CAAC,EAAE;gBAClD,IAAI,CAAC9B,gBAAgB,CAACsE,IAAI,CAAChG,IAAI,CAACwD,QAAQ,CAAC;cAC3C;YACF;YACA;YACA,MAAM,IAAI,CAAC0J,eAAe,CAAC,CAAC;UAC9B,OAAO,IAAIlN,IAAI,CAAC8J,IAAG,KAAM,aAAa,EAAE;YACtC;YACA,MAAM,IAAI,CAACoD,eAAe,CAAC,CAAC,EAAE;UAChC,OAAO,IAAIlN,IAAI,CAAC8J,IAAG,KAAM,iBAAiB,EAAE;YAC1C;YACA,MAAM,IAAI,CAACoD,eAAe,CAAC,CAAC,EAAE;;YAE9B;YACA,IAAIlN,IAAI,CAAC+J,MAAK,KAAM,KAAI,IAAK/J,IAAI,CAACwD,QAAO,IAAKxD,IAAI,CAACwD,QAAQ,CAACH,IAAI,EAAE;cAChE,IAAI,CAAC,IAAI,CAAC3B,gBAAgB,CAACuB,QAAQ,CAACjD,IAAI,CAACwD,QAAQ,CAACH,IAAI,CAAC,EAAE;gBACvD,IAAI,CAAC3B,gBAAgB,CAACsE,IAAI,CAAChG,IAAI,CAACwD,QAAQ,CAACH,IAAI,CAAC;cAChD;YACF,OAAO,IAAIrD,IAAI,CAAC+J,MAAK,KAAM,QAAO,IAAK/J,IAAI,CAACwD,QAAQ,EAAE;cACpD;cACA,MAAMgH,KAAI,GAAI,IAAI,CAAC9I,gBAAgB,CAAC8O,OAAO,CAACxQ,IAAI,CAACwD,QAAQ,CAACiN,QAAQ,CAAC;cACnE,IAAIjG,KAAI,KAAM,CAAC,CAAC,EAAE;gBAChB,IAAI,CAAC9I,gBAAgB,CAAC8I,KAAK,IAAIxK,IAAI,CAACwD,QAAQ,CAACH,IAAI;cACnD,OAAO,IAAI,CAAC,IAAI,CAAC3B,gBAAgB,CAACuB,QAAQ,CAACjD,IAAI,CAACwD,QAAQ,CAACH,IAAI,CAAC,EAAE;gBAC9D,IAAI,CAAC3B,gBAAgB,CAACsE,IAAI,CAAChG,IAAI,CAACwD,QAAQ,CAACH,IAAI,CAAC;cAChD;;cAEA;cACA,IAAI,IAAI,CAAC5B,gBAAe,KAAMzB,IAAI,CAACwD,QAAQ,CAACiN,QAAQ,EAAE;gBACpD,IAAI,CAAChP,gBAAe,GAAIzB,IAAI,CAACwD,QAAQ,CAACH,IAAI;cAC5C;YACF,OAAO,IAAIrD,IAAI,CAAC+J,MAAK,KAAM,QAAO,IAAK/J,IAAI,CAAC0Q,aAAa,EAAE;cACzD;cACA,IAAI,CAAChP,gBAAe,GAAI,IAAI,CAACA,gBAAgB,CAACiB,MAAM,CAACgO,GAAE,IAAKA,GAAE,KAAM3Q,IAAI,CAAC0Q,aAAa,CAAC;;cAEvF;cACA,IAAI,IAAI,CAACjP,gBAAe,KAAMzB,IAAI,CAAC0Q,aAAa,EAAE;gBAChD,IAAI,CAACjP,gBAAe,GAAI,EAAE;cAC5B;YACF;UACF;QACF,EAAE,OAAOY,KAAK,EAAE;UACd2E,OAAO,CAAC3E,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;QAC7D;MACF,CAAC;MAED,IAAI,CAAClC,EAAE,CAACyQ,OAAM,GAAI,MAAM;QACtB5J,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAC;QACrC,IAAI,CAAC7G,WAAU,GAAI,KAAK;QACxB;QACA0D,UAAU,CAAC,MAAM;UACf,IAAI,CAAC+J,aAAa,CAAC,CAAC;QACtB,CAAC,EAAE,IAAI,CAAC;MACV,CAAC;MAED,IAAI,CAAC1N,EAAE,CAAC0Q,OAAM,GAAKxO,KAAK,IAAK;QAC3B2E,OAAO,CAAC3E,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;QACxC,IAAI,CAACjC,WAAU,GAAI,KAAK;MAC1B,CAAC;IACH,CAAC;IAED;IACA0Q,kBAAkBA,CAACxC,KAAK,EAAE;MACxB;MACA,IAAIA,KAAK,CAACyC,GAAE,KAAM,0BAA0B,EAAE;QAC5C;QACA,IAAI,CAACC,yBAAyB,CAAC,CAAC;MAClC;IACF,CAAC;IAED;IACAA,yBAAyBA,CAAA,EAAG;MAC1B;MACA,MAAMxC,qBAAoB,GAAI,0BAA0B;MACxD,MAAMC,kBAAiB,GAAInH,IAAI,CAACC,KAAK,CAAC5D,YAAY,CAAC6D,OAAO,CAACgH,qBAAqB,CAAC,KAAK,EAAE;;MAExF;MACA,MAAMyC,wBAAuB,GAAIxC,kBAAkB,CAAC9L,MAAM,CAACgF,CAAA,IACzDA,CAAC,CAACgH,mBAAkB,KACnBhH,CAAC,CAAC6B,OAAO,CAACvG,QAAQ,CAAC,UAAU,KAAK0E,CAAC,CAAC6B,OAAO,CAACvG,QAAQ,CAAC,UAAU,CAAC,KACjE,CAAC0E,CAAC,CAAC4G,SACL,CAAC;;MAED;MACA0C,wBAAwB,CAAC9J,OAAO,CAACoC,YAAW,IAAK;QAC/C,MAAM3B,OAAM,GAAI2B,YAAY,CAAC3B,OAAO;QAEpC,IAAI2B,YAAY,CAACC,OAAO,CAACvG,QAAQ,CAAC,UAAU,CAAC,EAAE;UAC7C;UACA;UACA,MAAMoI,UAAS,GAAI,IAAI,CAACpL,MAAM,CAACqL,SAAS,CAACC,CAAA,IAAKA,CAAC,CAACxI,EAAC,KAAM6E,OAAO,CAAC;UAE/D,IAAIyD,UAAS,KAAM,CAAC,CAAC,EAAE;YACrB;YACA,IAAI,CAACpL,MAAM,CAACoL,UAAU,CAAC,CAACrD,KAAI,GAAIuB,YAAY,CAACvB,KAAK;;YAElD;YACAuB,YAAY,CAACgF,SAAQ,GAAI,IAAI;UAC/B;QACF,OAAO,IAAIhF,YAAY,CAACC,OAAO,CAACvG,QAAQ,CAAC,UAAU,CAAC,EAAE;UACpD;UACA,IAAI,CAAChD,MAAK,GAAI,IAAI,CAACA,MAAM,CAAC0C,MAAM,CAAC4I,CAAA,IAAKA,CAAC,CAACxI,EAAC,KAAM6E,OAAO,CAAC;;UAEvD;UACA2B,YAAY,CAACgF,SAAQ,GAAI,IAAI;QAC/B;MACF,CAAC,CAAC;;MAEF;MACA5K,YAAY,CAACC,OAAO,CAAC4K,qBAAqB,EAAElH,IAAI,CAACO,SAAS,CAAC4G,kBAAkB,CAAC,CAAC;;MAE/E;MACA,IAAIwC,wBAAwB,CAAC/J,MAAK,GAAI,CAAC,EAAE;QACvC,MAAMgK,gBAAe,GAAID,wBAAwB,CAACA,wBAAwB,CAAC/J,MAAK,GAAI,CAAC,CAAC;QACtF,IAAI,CAACxG,mBAAkB,GAAIwQ,gBAAgB,CAAC1H,OAAO;QACnD,IAAI,CAAC7I,iBAAgB,GAAIuQ,gBAAgB,CAAC1H,OAAO,CAACvG,QAAQ,CAAC,UAAU,IACnE,mBAAkB,GAAI,qBAAqB;QAC7C,IAAI,CAACY,gBAAgB,CAAC,CAAC;MACzB;IACF,CAAC;IAED;IACAsM,kBAAkBA,CAAA,EAAG;MACnB,IAAI,CAACjK,WAAW,CAAC,CAAC;IACpB,CAAC;IAED;IACAiL,gBAAgBA,CAAA,EAAG;MACjB,IAAI,CAACtD,aAAa,CAAC,CAAC;IACtB,CAAC;IAED;IACAuD,iBAAiBA,CAACxJ,OAAO,EAAE;MACzBZ,OAAO,CAACC,GAAG,CAAC,8BAA8BW,OAAO,2BAA2B,IAAI,CAAC3H,MAAM,CAACiH,MAAM,EAAE,CAAC;;MAEjG;MACA,MAAMmE,UAAS,GAAI,IAAI,CAACpL,MAAM,CAACqL,SAAS,CAACC,CAAA,IAAKA,CAAC,CAACxI,EAAC,KAAM6E,OAAO,CAAC;MAE/D,IAAIyD,UAAS,KAAM,CAAC,CAAC,EAAE;QACrB;QACAjF,KAAK,CAAC,gCAAgCwB,OAAO,EAAE,EAC5CqB,IAAI,CAAC9C,QAAO,IAAKA,QAAQ,CAACE,IAAI,CAAC,CAAC,EAChC4C,IAAI,CAACjJ,IAAG,IAAK;UACZ,IAAIA,IAAI,EAAE;YACRgH,OAAO,CAACC,GAAG,CAAC,gDAAgD,EAAEjH,IAAI,CAAC;;YAEnE;YACA,MAAMwL,YAAW,GAAI;cACnB,GAAGxL,IAAI;cACPoL,iBAAiB,EAAEpL,IAAI,CAACoL,iBAAgB,IAAK,KAAI,CAAE;YACrD,CAAC;;YAED;YACA,IAAI,IAAI,CAACnL,MAAM,CAACiH,MAAK,KAAM,CAAC,EAAE;cAC5B,IAAI,CAACjH,MAAK,GAAI,CAACuL,YAAY,CAAC;YAC9B,OAAO;cACL;cACA,IAAI,CAACvL,MAAK,GAAI,CACZ,GAAG,IAAI,CAACA,MAAM,CAACwL,KAAK,CAAC,CAAC,EAAEJ,UAAU,CAAC,EACnCG,YAAY,EACZ,GAAG,IAAI,CAACvL,MAAM,CAACwL,KAAK,CAACJ,UAAS,GAAI,CAAC,EACpC;YACH;;YAEA;YACA,IAAI,CAACvD,YAAY,CAAC,CAAC;YAEnBd,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAEuE,YAAY,CAAC;;YAE9D;YACA,IAAI,CAACA,YAAY,CAACJ,iBAAiB,EAAE;cACnCtH,UAAU,CAAC,MAAM;gBACf,IAAI,CAACqM,kBAAkB,CAAC,CAAC;cAC3B,CAAC,EAAE,GAAG,CAAC;YACT;UACF;QACF,CAAC,EACA/F,KAAK,CAAC/H,KAAI,IAAK;UACd2E,OAAO,CAAC3E,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;UAC/C;UACA,IAAI,CAAC8N,kBAAkB,CAAC,CAAC;QAC3B,CAAC,CAAC;MACN,OAAO;QACLnJ,OAAO,CAACC,GAAG,CAAC,UAAUW,OAAO,qDAAqD,CAAC;QACnF;QACA,IAAI,CAACuI,kBAAkB,CAAC,CAAC;MAC3B;IACF,CAAC;IAED;IACAkB,iBAAiBA,CAACzJ,OAAO,EAAE;MACzBZ,OAAO,CAACC,GAAG,CAAC,oEAAoEW,OAAO,EAAE,CAAC;MAE1F,IAAI;QACF;QACA,MAAMkH,YAAW,GAAIzC,QAAQ,CAAC0C,aAAa,CAAC,8BAA8BnH,OAAO,IAAI,CAAC;QACtF,IAAI,CAACkH,YAAY,EAAE;UACjB9H,OAAO,CAACC,GAAG,CAAC,wCAAwC,CAAC;UACrD,OAAO,KAAK;QACd;;QAEA;QACA6H,YAAY,CAACE,SAAS,CAACC,MAAM,CAAC,wBAAwB,CAAC;;QAEvD;QACAH,YAAY,CAACE,SAAS,CAACsC,GAAG,CAAC,wBAAwB,CAAC;;QAEpD;QACA,MAAM7B,gBAAe,GAAIX,YAAY,CAACY,gBAAgB,CAAC,GAAG,CAAC;QAC3D,KAAK,MAAMC,SAAQ,IAAKF,gBAAgB,EAAE;UACxC,IAAIE,SAAS,CAACL,WAAW,CAACrM,QAAQ,CAAC,SAAS,CAAC,EAAE;YAC7C0M,SAAS,CAACC,SAAQ,GAAI,kCAAkC;YACxD5I,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC;UACpC;QACF;;QAEA;QACA;QACA,MAAMsK,OAAM,GAAI,SAAS3J,OAAO,MAAM;QACtC,IAAI4J,YAAW,GAAInF,QAAQ,CAACoF,cAAc,CAACF,OAAO,CAAC;QAEnD,IAAI,CAACC,YAAY,EAAE;UACjBA,YAAW,GAAInF,QAAQ,CAACgD,aAAa,CAAC,OAAO,CAAC;UAC9CmC,YAAY,CAACzO,EAAC,GAAIwO,OAAO;UACzBlF,QAAQ,CAACkD,IAAI,CAACC,WAAW,CAACgC,YAAY,CAAC;QACzC;QAEAA,YAAY,CAAClC,WAAU,GAAI;uCACI1H,OAAO;;;uCAGPA,OAAO;;;;;uCAKPA,OAAO;;;uCAGPA,OAAO;;;;;;;;;;;SAWrC;QAEDZ,OAAO,CAACC,GAAG,CAAC,kEAAkE,CAAC;QAC/E,OAAO,IAAI;MACb,EAAE,OAAO5E,KAAK,EAAE;QACd2E,OAAO,CAAC3E,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;QAC7D,OAAO,KAAK;MACd;IACF,CAAC;IAED;IACAqP,uBAAuBA,CAAC9J,OAAO,EAAE;MAC/B;MACA,MAAM+J,KAAI,GAAI,IAAI,CAACN,iBAAiB,CAACzJ,OAAO,CAAC;;MAE7C;MACA,IAAI+J,KAAK,EAAE;QACT;QACA,MAAMC,WAAU,GAAItK,IAAI,CAACC,KAAK,CAAC5D,YAAY,CAAC6D,OAAO,CAAC,qBAAqB,KAAK,IAAI,CAAC;QACnF,IAAI,CAACoK,WAAW,CAAC3O,QAAQ,CAAC2E,OAAO,CAAC,EAAE;UAClCgK,WAAW,CAAC5L,IAAI,CAAC4B,OAAO,CAAC;UACzBjE,YAAY,CAACC,OAAO,CAAC,qBAAqB,EAAE0D,IAAI,CAACO,SAAS,CAAC+J,WAAW,CAAC,CAAC;QAC1E;;QAEA;QACA,IAAI,CAAClR,mBAAkB,GAAI,8DAA8DkH,OAAO,EAAE;QAClG,IAAI,CAACjH,iBAAgB,GAAI,mBAAmB;QAC5C,IAAI,CAACkD,gBAAgB,CAAC,CAAC;MACzB;;MAEA;MACAC,UAAU,CAAC,MAAM;QACf,IAAI,CAACqM,kBAAkB,CAAC,CAAC;MAC3B,CAAC,EAAE,IAAI,CAAC;IACV;EACF,CAAC;EAED0B,OAAOA,CAAA,EAAG;IACR,IAAI,CAAC1B,kBAAkB,CAAC,CAAC;IACzB;IACA,IAAI,CAACrO,eAAc,GAAIsM,WAAW,CAAC,MAAM;MACvC,IAAI,CAAC+B,kBAAkB,CAAC,CAAC;IAC3B,CAAC,EAAE,KAAK,CAAC;;IAET;IACA,MAAM2B,gBAAe,GAAInO,YAAY,CAAC6D,OAAO,CAAC,YAAY,CAAC;IAC3D,IAAIsK,gBAAe,KAAM,IAAI,EAAE;MAC7B,IAAI,CAACrR,UAAS,GAAIqR,gBAAe,KAAM,MAAM;IAC/C;;IAEA;IACA,MAAMC,qBAAoB,GAAIpO,YAAY,CAAC6D,OAAO,CAAC,kBAAkB,CAAC;IACtE,IAAIuK,qBAAqB,EAAE;MACzB,IAAI,CAAChR,gBAAe,GAAIuG,IAAI,CAACC,KAAK,CAACwK,qBAAqB,CAAC;IAC3D;;IAEA;IACA9H,MAAM,CAACiG,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAACY,kBAAkB,CAAC;;IAE3D;IACA,IAAI,CAACK,gBAAgB,CAAC,CAAC;;IAEvB;IACA9E,QAAQ,CAAC6D,gBAAgB,CAAC,mBAAmB,EAAG5B,KAAK,IAAK;MACxD,IAAIA,KAAK,CAACjF,MAAK,IAAKiF,KAAK,CAACjF,MAAM,CAACzB,OAAO,EAAE;QACxCZ,OAAO,CAACC,GAAG,CAAC,gDAAgD,EAAEqH,KAAK,CAACjF,MAAM,CAAC;QAC3E,IAAI,CAACqI,uBAAuB,CAACpD,KAAK,CAACjF,MAAM,CAACzB,OAAO,CAAC;MACpD;IACF,CAAC,CAAC;;IAEF;IACA;IACA,MAAMgK,WAAU,GAAItK,IAAI,CAACC,KAAK,CAAC5D,YAAY,CAAC6D,OAAO,CAAC,qBAAqB,KAAK,IAAI,CAAC;IACnFoK,WAAW,CAACzK,OAAO,CAACS,OAAM,IAAK;MAC7B9D,UAAU,CAAC,MAAM;QACf,MAAMgL,YAAW,GAAIzC,QAAQ,CAAC0C,aAAa,CAAC,8BAA8BnH,OAAO,2BAA2B,CAAC;QAC7G,IAAIkH,YAAY,EAAE;UAChB9H,OAAO,CAACC,GAAG,CAAC,iCAAiCW,OAAO,mCAAmC,CAAC;UACxF,IAAI,CAACyJ,iBAAiB,CAACzJ,OAAO,CAAC;QACjC;MACF,CAAC,EAAE,IAAI,CAAC;IACV,CAAC,CAAC;EACJ,CAAC;EAEDoK,aAAaA,CAAA,EAAG;IACd,IAAI,IAAI,CAAClQ,eAAe,EAAE;MACxBqM,aAAa,CAAC,IAAI,CAACrM,eAAe,CAAC;IACrC;IAEA,IAAI,IAAI,CAACE,YAAY,EAAE;MACrBmM,aAAa,CAAC,IAAI,CAACnM,YAAY,CAAC;IAClC;IAEA,IAAI,IAAI,CAAC7B,EAAE,EAAE;MACX,IAAI,CAACA,EAAE,CAAC8N,KAAK,CAAC,CAAC;IACjB;;IAEA;IACAhE,MAAM,CAACgI,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAACnB,kBAAkB,CAAC;IAC9DzE,QAAQ,CAAC4F,mBAAmB,CAAC,mBAAmB,EAAE,IAAI,CAACP,uBAAuB,CAAC;EACjF;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}